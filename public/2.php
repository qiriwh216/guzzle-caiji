<?php
array (
  0 => 
  array (
    'title' => '新课程发布：《Laravel 性能优化入门》',
    'review' => ' 18585',
    'comment' => ' 53',
    'content' => '<p><img src="https://cdn.learnku.com/uploads/images/201906/20/1/yX3EKiAot2.png!large" alt="序言"></p>
<blockquote>
<p>课程链接：<a href="https://learnku.com/courses/laravel-performance" target="_blank">《LX3 Laravel 性能优化入门》</a></p>
</blockquote>
<h2>为什么会有此课程？</h2>
<p>Laravel 因 <strong>开发便捷</strong> 而为人喜爱，可<strong>运行效率</strong>上却经常为人诟病。</p>
<p>Laravel 开发者如果不懂得一些性能优化技巧的话，项目响应时间很容易就超过 1 秒。响应时间 1 秒，这在 Web 程序中是属于很慢的速度。作为全世界最大的搜索引擎谷歌，其 <strong>推荐页面响应速度</strong> 是 200 毫秒（1000毫秒 == 1 秒）。</p>
<p>Laravel 官方为了解决此问题，还专门定制了精简加速版的 <a href="https://learnku.com/docs/lumen">Lumen</a>  ，可见社区对 Laravel 性能的重视。</p>
<p>本课程设计的初衷是：</p>
<blockquote>
<p>制作一套你希望团队新成员能知道的 Laravel 性能优化知识。</p>
</blockquote>
<p>把性能优化当做 Laravel 开发的基本功，从而让更多人构建响应速度更快的 Laravel 应用。</p>
<h2>课程讲了什么？</h2>
<p>本课程作为 Laravel 性能优化的入门课程，将会系统性讲解 Laravel 应用程序优化的一些基础知识。这些知识允许你在遇到 <strong>Laravel 性能问题</strong> 时，知道从哪些方面来优化和思考。</p>
<p>性能优化是一个系统性工程，本课程从讲解 Laravel 项目的优化技巧出发，不仅讲解 Laravel 专属的性能优化技巧，还发散讲解到 PHP、 MySQL、缓存系统、前端加载等话题。具体列表请见 <a href="https://learnku.com/index.php/courses/laravel-performance/6.x/checklist/">上线清单</a>。</p>
<p>性能优化同时又是个持续优化的过程，我们希望通过这里涉及的话题，可以作为你的项目优化的引子，带你打开持续优化的大门。</p>
<h2>适用于哪些读者？</h2>
<p><strong>学生：</strong></p>
<p>如果你是 Laravel 初学者或者是大学生，学了 Laravel 准备以后从事这个职业的。知晓 Laravel 程序的局限性，知道如何系统性考虑问题，本课程将为你奠定良好的基础，使你在面试或以后工作中，更加自信。</p>
<p><strong>从业者：</strong></p>
<p>如果你是 Laravel 开发者，有一定的 Laravel 开发经验，本教程也可以作为性能优化手册，帮助你解决将会遇到或者正在面临的 Laravel 运行速度慢的问题。</p>
<p><strong>技术合伙人或架构师：</strong></p>
<p>如果你需要回复雇主或用户的「页面响应慢」的问题，这本书就是为你设计的。一步步照着本课程优化，你的程序响应速度将不再会是问题。</p>
<h2>课程链接</h2>
<p><a href="https://learnku.com/courses/laravel-performance" target="_blank">《LX3 Laravel 性能优化入门》</a></p>

                        
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" target="_blank" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <hr>
<p>Practice makes perfect.</p>
                                </span>
                            </div>',
    'created_at' => '2019-09-25 14:33:23',
    'updated_at' => '2019-09-25 14:39:54',
  ),
  1 => 
  array (
    'title' => '实例讲解 PHP 中的 Clean Code 和 Code Smells',
    'review' => ' 436',
    'comment' => ' 0',
    'content' => '<div class="markdown-body article-content-big-font" id="emojify">

            <blockquote style="margin-top: 0px!important;">
            <p>这是一篇协同翻译的文章，你可以点击『我来翻译』按钮来参与翻译。</p>
                    </blockquote>
        <hr>
<div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="1" id="SectionIndex_1" name="SectionIndex_1">
                <p>代码坏味道是很常见的标志，这表明你的代码还不够好，需要重构才能最终得到整洁的代码。在本文中，我将用来自 GitHub 上真实项目的真实示例来解释代码坏味道，并向您展示重构这些坏味道代码以及使之整洁的最佳方法。我还建议你之后能读下这篇文章。 “<a href="https://learnku.com/php/t/37900"><strong>高级 PHP 工程师必备的编码技巧及思维 </strong></a>”</p>

                <div class="right ui rail" style="min-height: 262.531px;">

    
        <div class="ui translate-box sticky">

            <div class="ui card">

                <div class="text-center">
                    <a href="https://learnku.com/users/16936">
                      <img class="img-thumbnail avatar emoji" src="https://cdn.learnku.com/uploads/avatars/16936_1497341678.jpeg!/both/100x100" style="width:52px; height:52px;margin:5px;border: 1px solid #ddd;"></a>
                    <div class="media-body padding-top-sm">
                        <span class="introduction">
                              MasterShu 翻译于 <span class="ui popover" data-content="2019-12-13 16:29:56">1天前</span>
                        </span>
                    </div>
                </div>

                <div class="ui divider"></div>

                <div class="translation-operation-wrap">
                    <div class="index text-center">
                        <a class="section-vote ui popover label basic tiny btn-default " data-variation="inverted" data-content="多个翻译的情况下，赞数会影响排序" data-url="https://learnku.com/sections/13829/vote">
                            <i class="icon thumbs up" aria-hidden="true"></i> <span class="vote-count">0</span>
                        </a>

                        
                                                <a class="ui popover label basic tiny" data-variation="inverted" data-content="提交你的译文" href="https://learnku.com/sections/13829">
                                                            重译
                                                    </a>

                                            </div>

                                            <div class="text-center" style="font-size:0.9em;margin-top:12px;color:#a5a5a5;">
                            <i class="icon checkmark green" aria-hidden="true"></i> 由 <a href="https://learnku.com/users/1" style="color:#a5a5a5;">Summer</a> 审阅
                        </div>
                                    </div>
            </div>


                    </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="2" id="SectionIndex_2" name="SectionIndex_2">
                <p>- <strong>重复代码及逻辑代码坏味道</strong>\\<br>
开发人员有点懒惰是很常见的，这在很多方面都很好；但是，懒惰和复杂/粘贴大量代码行并不是一种正确的行为。它可能会导致最常见的代码坏味道，即逻辑重复，如下面的示例所示。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/fRfIkaXKDq.png!large" alt=""></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/tQlmJJ92WU.png!large" alt=""></p>
<p>因此，为避免代码坏味道，我们需要将红色部分提取到一个单独的方法中，这将有助于我们在有需要的情况下重用它。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/H4NemIcDzy.png!large" alt=""></p>
<p>- <strong>冗长方法及类代码坏味道\\<br></strong>我相信，当我们需要给一个现有方法添加更多的if()或for()语句，以验证用户输入或确认用户是否已登录时，我们都犯了这个错误(单一方法或类代码过长)。简而言之，你不应该那样做。如果你需要这样的验证，那么创建它自己单独的方法。完美的方法应该做4-20行之间。如果超过了20行，你也许可以将几行代码提取到一个新的方法中去。同样的规则在这里也适用于类，(代码量)更小的则更好，尤其是如果你在应用单一责任原则时。</p>

                <div class="right ui rail" style="min-height: 262.531px;">

    
        <div class="ui translate-box sticky">

            <div class="ui card">

                <div class="text-center">
                    <a href="https://learnku.com/users/39434">
                      <img class="img-thumbnail avatar emoji" src="https://cdn.learnku.com/uploads/images/201801/03/1/ow6ZdlsdS2.jpg" style="width:52px; height:52px;margin:5px;border: 1px solid #ddd;"></a>
                    <div class="media-body padding-top-sm">
                        <span class="introduction">
                              milksoul 翻译于 <span class="ui popover" data-content="2019-12-14 19:32:59">4小时前</span>
                        </span>
                    </div>
                </div>

                <div class="ui divider"></div>

                <div class="translation-operation-wrap">
                    <div class="index text-center">
                        <a class="section-vote ui popover label basic tiny btn-default " data-variation="inverted" data-content="多个翻译的情况下，赞数会影响排序" data-url="https://learnku.com/sections/13845/vote">
                            <i class="icon thumbs up" aria-hidden="true"></i> <span class="vote-count">0</span>
                        </a>

                        
                                                <a class="ui popover label basic tiny" data-variation="inverted" data-content="提交你的译文" href="https://learnku.com/sections/13845">
                                                            重译
                                                    </a>

                                            </div>

                                            <div class="text-center" style="font-size:0.9em;margin-top:12px;color:#a5a5a5;">
                            <i class="icon checkmark green" aria-hidden="true"></i> 由 <a href="https://learnku.com/users/1" style="color:#a5a5a5;">Summer</a> 审阅
                        </div>
                                    </div>
            </div>


                    </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="3" id="SectionIndex_3" name="SectionIndex_3">
                <p>- <strong>Duplicated Methods in the Same or Different Class Code Smell</strong>\\<br>
Another code smell that needs to be taken into consideration is when you have two methods that do the same functionality. The following image should make it clear.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/yLdmp4qTpS.png!large" alt=""></p>
<p>- <strong>Class Divergent Change Code Smell</strong>\\<br>
If you ever read about the SOLID principles before, especially the Single Responsibility, then you know that one class should have only one reason to change. This means a User class shouldn’t have a function related to products or file conversion. You can easily fix this code smell by extracting the unrelated method to a new class like Product class or FileSystem class.</p>
<p>- <strong>Shotgun Surgery Code Smell</strong>\\<br>
It is the exact opposite of divergent change. This code smell will make you change many classes for one single reason which means that many classes have the same reason to change in order to apply one behaviour. For example, you need to create a new user rule such as ‘Supper-Admin’ then you found yourself must edit some methods in Profile, Products and Employees classes. In that case, consider grouping these methods in one single class so this new class will have a single reason to change.</p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13816">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="4" id="SectionIndex_4" name="SectionIndex_4">
                <p>- <strong>Feature Envy Code Smell</strong>\\<br>
Sometimes you found a method in your class that extensively makes use of another class. In that case, you may consider moving this method to the other class it uses. Have a look at the next image. Wouldn’t it be better if the getFullAddress() becomes a part of ContactInfo class instead of User class since all it does is to use ContactInfo methods.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/7vxjb5o4vB.png!large" alt=""></p>
<p>- <strong>Data Clumps Code Smell</strong>\\<br>
Sometimes you find so many functions that almost take the same parameters list. This kind of parameters, that is always used together, causes the data clumps code smell. Take a look at the next example; you will find that almost all kinds of reservation require the passport information.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/VtGyTWLaka.png!large" alt=""></p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13817">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="5" id="SectionIndex_5" name="SectionIndex_5">
                <p>In that case, it would be much better to move the passport information into its own class then pass the PassportInfo object to the reservation methods. This is an excellent example of code reuse and remember that long parameters list can lead to code failure, conflict and difficult unit testing.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/t0liw8mlv4.png!large" alt=""></p>
<p>- <strong>Primitive Obsession Code Smell</strong>\\<br>
This coding smell appears when you start using primitive data-Types everywhere in your application. For example, using the integer for phone numbers and string for currency sign. If that is the case with you, take a look at the following class.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/RBR9jtuoVZ.png!large" alt=""></p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13818">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="6" id="SectionIndex_6" name="SectionIndex_6">
                <p>As you can see, the address here is defined as an array. This approach mainly will cause two problems, such as every time we need the address we will have to hard code it. So, why not we create a new class called Address.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/zcdNswY4Qt.png!large" alt=""></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/VjlbV4MwQG.png!large" alt=""></p>
<p>Now, every time we need to add/edit an address we hit the Address class. Also, any time we need to add a new “contact us” method we hit ContactUs class. So, each class has a single responsibility.</p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13819">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="7" id="SectionIndex_7" name="SectionIndex_7">
                <p>- <strong>Switch Statement Code Smell</strong>\\<br>
Maybe you wonder why the switch statement is terrible. Well, it is not always bad, but if you can notice in the next example, the switch statement is big and unextractable by its nature. So when it becomes huge, you can’t divide it into smaller methods.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/fUB0g6qlXf.png!large" alt=""></p>
<p>Just remember! if your switch statement is not big, then you can leave it. An excellent example of switch statement is within the Factory design pattern.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/lwpYjeGyV7.png!large" alt=""></p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13820">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="8" id="SectionIndex_8" name="SectionIndex_8">
                <p>- <strong>Parallel Inheritance Hierarchies Code Smell</strong>\\<br>
Sometimes I wonder whether the Parallel Inheritance Hierarchies is really a bad practice. Well, let’s first explain what Parallel Inheritance Hierarchies is. Then decide if it is a bad thing or not.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/xZDwSaMRov.png!large" alt=""></p>
<p>So, as you noticed from the image above that every time we create a new department class we also need to create a privilege class which leads us to the “Shotgun Surgery” code smell.</p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13821">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="9" id="SectionIndex_9" name="SectionIndex_9">
                <p>- <strong>Lazy Class Code Smell</strong>\\<br>
A Lazy Class is the one that doesn’t do so much. Do you remember this image from above?</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/RBR9jtuoVZ.png!large" alt=""></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/VjlbV4MwQG.png!large" alt=""></p>
<p>We decided to move the address to a separate class, but we didn’t do the same with the hot-line because it would be a class with 3 lines only. So, whenever you found these lazy classes, you should eliminate them.</p>
<p>- <strong>Temporary Fields Code Smell</strong>\\<br>
Temporary Fields code smell happens when you have a class instance variables that have been used only sometimes. Have a look in the next example; you will notice that $name and $contactDetails are only used in the notify() method.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/1a62BBbOBb.png!large" alt=""></p>
<p>So why not passing them as a method parameters.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/JF0r0HZCTg.png!large" alt=""></p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13822">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="10" id="SectionIndex_10" name="SectionIndex_10">
                <p>- <strong>Message Chains Code Smell</strong>\\<br>
Message chains is the code smell when you have a class that uses another class which uses another class and so on. In the following image, you can see the following chain, Employee-&gt;EmployeeConfig-&gt;Config</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/xX7kYbO2r8.png!large" alt=""></p>
<p>So you can make your code cleaner by shortening the chain to,\\<br>
Employee-&gt;Config</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/Kg4WwZ7CCo.png!large" alt=""></p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13823">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="11" id="SectionIndex_11" name="SectionIndex_11">
                <p>- <strong>Inappropriate Intimacy Code Smell</strong>\\<br>
Sometimes you find a method in a class that needs to know too much about the inner workings or internal data of another class. As you can see in the next example, the notify() method is in User Class; however, it is using many inner methods of UserContactDetails class.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/R5aGLJ6531.png!large" alt=""></p>
<p>In that case, it would be better to move this logic from User class to UserContactDetails class and create getWelcomeMessage($userName).</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/L5mnGfp9nQ.png!large" alt=""></p>
<p>- <strong>Middle Man Code Smell</strong>\\<br>
Sometimes you find many methods in one class do nothing but delegating to another method in a different class. In that case, the first class is considered as a middle-man class, and most of the time it would be better to get rid of it.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/aWH5pYdXTM.png!large" alt=""></p>
<p><strong>Note</strong>: Middle Man classes could be helpful in some cases as in the Facade design pattern.</p>
<p>- <strong>Alternative Classes with Different Interfaces Code Smell</strong>\\<br>
Usually, it happens because of the lack of communication between the team as two different classes are created which do the same thing which means code duplication.</p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13824">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="12" id="SectionIndex_12" name="SectionIndex_12">
                <p>- <strong>Incomplete Library Class Code Smell</strong>\\<br>
Third-party libraries do not always provide you with all the functionalities you need in your application. In the next example, a library that handles documents can retrieve one document by its ID or retrieve all the documents at once.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/Sjaq9X8gku.png!large" alt=""></p>
<p>So, what happens if you need to retrieve all documents of a particular user? Remember that it is horrible if you tried to edit third-party classes on your own. In this case, you need to extend the functionality of the Document class without editing the original class. Well, the decorator design pattern can be helpful here as you can see in the next image.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/1/otHKUeRfjM.png!large" alt=""></p>
<p>Now, you should start using DocumentsDecorator class instead of Documents class.</p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13825">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="13" id="SectionIndex_13" name="SectionIndex_13">
                <p>- <strong>关于注释</strong><br>
我知道你可能会感到惊讶，是的，如果注释被用错了地方，那注释就是坏的代码，所以这里是我的一些提示:</p>
<ul>
<li>删除不必要的注释。</li>
<li>如果代码很容易理解，就不要写注释。</li>
<li>不要留下注释过的旧代码。<br>
*删除注释调试 var_dump,echo ....etc等。</li>
</ul>
<div class="right ui rail" style="min-height: 262.531px;">

    
        <div class="ui translate-box sticky">

            <div class="ui card">

                <div class="text-center">
                    <a href="https://learnku.com/users/26855">
                      <img class="img-thumbnail avatar emoji" src="https://cdn.learnku.com/uploads/avatars/26855_1530498539.jpeg!/both/100x100" style="width:52px; height:52px;margin:5px;border: 1px solid #ddd;"></a>
                    <div class="media-body padding-top-sm">
                        <span class="introduction">
                              Remember 翻译于 <span class="ui popover" data-content="2019-12-14 20:19:40">3小时前</span>
                        </span>
                    </div>
                </div>

                <div class="ui divider"></div>

                <div class="translation-operation-wrap">
                    <div class="index text-center">
                        <a class="section-vote ui popover label basic tiny btn-default " data-variation="inverted" data-content="多个翻译的情况下，赞数会影响排序" data-url="https://learnku.com/sections/13846/vote">
                            <i class="icon thumbs up" aria-hidden="true"></i> <span class="vote-count">0</span>
                        </a>

                        
                                                <a class="ui popover label basic tiny" data-variation="inverted" data-content="提交你的译文" href="https://learnku.com/sections/13846">
                                                            重译
                                                    </a>

                                            </div>

                                            <div class="text-center" style="font-size:0.9em;margin-top:12px;color:#a5a5a5;">
                            <i class="icon checkmark green" aria-hidden="true"></i> 由 <a href="https://learnku.com/users/1" style="color:#a5a5a5;">Summer</a> 审阅
                        </div>
                                    </div>
            </div>


                    </div>
    </div>            </div>
                <div class="ui divider"></div>
                        <div class="translation-item ui segment px-0 py-0 border-0 shadow-none active " style="display: block;" index="14" id="SectionIndex_14" name="SectionIndex_14">
                <p>- <strong>Speculative Generality Code Smell</strong><br>
This code smell is about premature optimization, many developers fail to see this one. Some notes to be considered during planning are:</p>
<ul>
<li>Don’t over plan your code.</li>
<li>Don’t try to cover a case that likely has 1% chance to happen in the future.</li>
<li>Sacrifice some speed in order to make your algorithm simpler, especially if you don’t need a real-time result from your application.</li>
<li>Optimize for speed when your application is actually slow not when you only have 100 users.</li>
</ul>
<p>Now we have covered the code smells and the best ways to clean them up, so you are more than ready to write very clean code and refactor your old classes. Wish you all the best!</p>

                <div class="right ui rail" style="min-height: 262.531px;">

            <div class="ui card translate-box sticky">
            <div class="text-center">

                
                                                            <button class="login_required ui button primary" data-url="https://learnku.com/sections/13827">
                            <i class="tripadvisor icon"></i> 我来翻译
                        </button>
                                    
                

                            </div>
        </div>
    </div>            </div>
                <div class="ui divider"></div>
    
        <p></p>
<div style="position: absolute!important;height: 1px;width: 1px;overflow: hidden;clip: rect(1px,1px,1px,1px);">本文章首发在 <a href="https://learnku.com/">LearnKu.com</a> 网站上。</div>
        <blockquote style="font-size: 0.9em;">
            本文中的所有译文仅用于学习和交流目的，转载请务必注明文章译者、出处、和本文链接 <br>
            我们的翻译工作遵照 <a href="http://zh.wikipedia.org/wiki/Wikipedia:CC">CC 协议</a>，如果我们的工作有侵犯到您的权益，请及时联系我们。
        </blockquote>
    <hr>
</div>

                        

                                                    <blockquote style="font-size: 0.9em;border: 1px dashed #dce0e4;border-radius: 5px;padding: 13px 25px;">
                                <p style="margin-bottom: 0px;">原文地址：<a href="https://codeburst.io/write-clean-code-and-get-rid-of-code-smells-aea271f30318">https://codeburst.io/write-clean-code-an...</a></p>
                                <p>译文地址：<a href="https://learnku.com/laravel/t/38035">https://learnku.com/laravel/t/38035</a></p>
                            </blockquote>',
    'created_at' => '2019-12-13 16:03:25',
    'updated_at' => '2019-12-13 16:03:25',
  ),
  2 => 
  array (
    'title' => '成长，就是不断向自己妥协的过程',
    'review' => ' 329',
    'comment' => ' 9',
    'content' => '<h2>引言</h2>
<p>​       在新东家实习已经快一个月了，环境还可以，工作也相对轻松。</p>
<p>​       公司主要业务是电商SAS平台，开发部门算上我有5个人，3个后端两个前端，我负责后端，算一个比较正规的小团队吧。</p>
<p>​       实习期间呢，我全力负责SAS平台的三个模块后台的业务开发，分别是素材库、社区（帖子）、商学院（课程）。</p>
<p>​       这些需求对久经沙场的我来说，自然不在话下，没到一个月就完成了初步的开发，接下来只需要与前端对接完就可以了。</p>
<h2>事情经过</h2>
<p><strong>但是这几天与leader发生了一些摩擦和争执，百般无奈下，我也只好向他妥协。</strong></p>
<p><strong>主要两个件事：</strong></p>
<ol>
<li>
<p><strong>字段必填</strong></p>
<p>​        起初的时候我给课程设计了两个字段，一个是课程的开课和结束时间。（后面我仔细看了下需求，并不需要这两个字段）我数据库给这两个字段约束了”必填“ 就是 不能为null。</p>
<p>​        他可能迁移数据的时候，报了这两个字段没有默认值导致错误了吧~  于是截图给了我，什么也不说。然后我就解释说，这两个字段设置必填才合理，不应该设置默认值。</p>
<p>​        然后他给我的回应是：必填也要有默认值       （我一头雾水...） </p>
</li>
<li>
<p><strong>代码冗余</strong></p>
<p>​        继 ”字段“ 事件后，他也对我写的一个接口进行了审查。 我写的一个 推荐产品的Api接口，可以根据不同的分类，筛选出可选的产品。</p>
<p>​        举个例子：</p>
<p>​        产品类型有：商品 和课程</p>
<p>​        我需要根据这个类型 去对应的表拿可选的数据。后台添加数据的时候也有这个需求，于是我就写在了一个Api，前端和后台都可以共用这个接口。</p>
<p>​        于是，他就觉得这样不行，要求我拆分开来。 我问他原因呢，他又说不出来，我以为他不了解需求，就不断的向他讲述，最后没有用，结果自然闹得很僵。</p>
<p>​        我们就这样僵了两三天吧，他就找我谈话了，说要我适应环境，把业务都写在一个Function 里，因为昨天同事看了我的代码，跳来跳去的，看不懂~ ，</p>
<p>​        我说我可以对我这块业务写个详细的文档，这也不行，无奈下，我也只好妥协。刚来不久，很多东西都不能硬性的去改变，也只能去适应他们的开发方式。</p>
<p>​        接着，他对我的接口设计又有意见了。社区下的帖子和商学院里的课程都能评论，回复，点赞。</p>
<p>于是我把这些各自写成一个接口，只需要传参数识别是课程还是帖子就行了。他要求我把这些拆分出来，就是说课程的评论和帖子的评论不能一个接口。百般的解析下,无用，我也只好再一次妥协。</p>
</li>
</ol>
<h2>修改后的对比</h2>
<blockquote>
<p>修改后的代码我真的不想看~ 感觉要被后面的人挖祖坟~~</p>
</blockquote>
<p>就简单帖一个创建评论操作的对比吧~</p>
<h3>修改前：</h3>
<ol>
<li>
<h6>创建评论操作入口</h6>
</li>
</ol>
<pre><code class="language-php">    /**
     * 创建评论
     * @param CommentRequest $request
     * @param $id
     * @return mixed
     */
    public function createComment(CommentRequest $request, $id)
    {
      //获取type，根据typpe 获取对应的query
        $type = $request-&gt;input(\'type\');
        $query = BaseModel::getQuery($type);
        $data = $request-&gt;except(\'type\');

      //检查对象是否存在
        try {
            $object = $query-&gt;findOrFail($id);
        } catch (ModelNotFoundException $exception) {
            return $this-&gt;failed(\'对象不存在\');
        }

        try {
          //把对象和数据传到创建评论操作 createCommentHandle
            NewRetailCommonComment::createCommentHandle($object, $data);
            return $this-&gt;success(\'评论成功\');
        } catch (\\Exception $exception) {
            return $this-&gt;failed($exception-&gt;getMessage());
        }
    }</code></pre>
<ol start="2">
<li>CommentRequest.php</li>
</ol>
<blockquote>
<p>Request 中传个类型和内容</p>
</blockquote>
<pre><code class="language-php">&lt;?php

namespace App\\Http\\Requests\\Api;

use Illuminate\\Foundation\\Http\\FormRequest;

class CommentRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     *
     * @return bool
     */
    public function authorize()
    {
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array
     */
    public function rules()
    {
        return [
            \'type\' =&gt; \'required|in:post,course\',
            \'content\' =&gt; \'required|min:1\'
        ];
    }
}
</code></pre>
<ol start="3">
<li>BaseModel.php</li>
</ol>
<blockquote>
<p>根据类型获取不同的实例</p>
</blockquote>
<pre><code class="language-php">    /**
     * 获取不同的$Query
     * @param $type
     * @return bool|\\Illuminate\\Database\\Eloquent\\Builder
     */
    public static function getQuery($type)
    {
        switch ($type):
            case \'post\':
                return NewRetailCommunityPost::query();
                break;
            case \'course\':
                return NewRetailCourse::query();
                break;
            case \'comment\':
                return NewRetailCommonComment::query();
                break;
            case \'replies\':
                return NewRetailCommonCommentReplies::query();
                break;
            default:
                return false;
        endswitch;
    }</code></pre>
<ol start="4">
<li>NewRetailCommonComment.php</li>
</ol>
<pre><code class="language-php">/**
 * 添加评论处理操作
 * @param $object
 * @param $data
 * @return bool
 * @throws \\Exception
 */
public static function createCommentHandle($object, $data): bool
{
  //判断对象的类型 获取实例
    if ($object instanceof NewretailCommunityPost) {
        $model = new NewretailCommunityPost();
    } elseif ($object instanceof NewRetailCourse) {
        $model = new NewRetailCourse();
    }

  //判断对象是否有效
    $model::isEffective($object);

  //评论功能是否开启
    if (!$model::isComment()) {
        throw new \\Exception(\'评论功能还没有开启哦~~\');
    }

  //是否需要审核
    if (!$model::commentIsReview()) {
        $data[\'status\'] = CommunityPostEnum::ONE;
    }

  //返回创建所需的共用数据
    $uuidAndCustomer = BaseModel::getCustomerAndUuid();
  //数组合并
    $data = array_merge($data, $uuidAndCustomer);
  //创建评论
    $object-&gt;comment()-&gt;save(new NewRetailCommonComment($data));
    return true;
}</code></pre>
<h3>修改后：</h3>
<blockquote>
<p>修改后的话，就是全部放一个Function里。实在没眼看~~</p>
</blockquote>
<ol>
<li>入口（创建文章评论）</li>
</ol>
<pre><code class="language-php">    /**
     * 创建评论
     * @param CommentRequest $request
     * @param NewRetailCommunityPost $post
     * @return mixed
     */
    public function createComment(CommentRequest $request, NewRetailCommunityPost $post)
    {
        $data = $request-&gt;all();
        try {
            NewRetailCommonComment::createPostComment($data, $post);
           return $this&gt;success(ErrorCodeEnum::RETURN_ERROR_CODE_MSG[ErrorCodeEnum::ACTION_SUCCESS]);
        } catch (\\Exception $exception) {
            return $this-&gt;failed($exception-&gt;getMessage());
        }
    }</code></pre>
<ol start="2">
<li>NewRetailCommonComment.php</li>
</ol>
<pre><code class="language-php">    /**
     * 创建文章评论
     * @param $data
     * @param $post
     * @return bool
     * @throws \\Exception
     */
    public static function createPostComment($data, $post): bool
    {
        $model = new NewretailCommunityPost();

        if ($post-&gt;is_del
            || $post-&gt;status != CommunityPostEnum::ONE
            || Auth::user()-&gt;customer_code != $post-&gt;customer_code) {
            throw new \\Exception(ErrorCodeEnum::RETURN_ERROR_CODE_MSG[ErrorCodeEnum::POST_NO_FOUND]);
        }

        /**
         * 判断是否可以评论
         */
        if (!$model::isComment()) {
            throw new \\Exception(ErrorCodeEnum::RETURN_ERROR_CODE_MSG[ErrorCodeEnum::NO_OPEN_COMMENT_PERMISSION]);
        }

        /**
         * 判断是否需要审核
         */
        if (!$model::commentIsReview()) {
            $data[\'status\'] = CommunityPostEnum::ONE;
        }

        $user = Auth::user();
        $data = array_merge($data, [
            \'customer_code\' =&gt; $user-&gt;customer_code,
            \'uuid\' =&gt; $user-&gt;uuid
        ]);
        $post-&gt;comment()-&gt;save(new NewRetailCommonComment($data));
        return true;
    }</code></pre>
<blockquote>
<p>创建课程评论 又需要 重新差不多的代码~~~</p>
</blockquote>
<h2>总结</h2>
<p>​   我发这篇文章的本意并不是如何的抬高自己，贬低别人，我也不认为自己写得有多好，写一些业务代码，没什么值得骄傲的。通过这件事，我领悟到了，有时候有些事情，就算你很不喜欢，很不乐意，为了生活，也得适当的妥协。成长，就是不断向自己妥协的过程。</p>
<blockquote>
<p>这种环境并不是我向往的，但是生活所迫，暂时任性不了，我还是会保持我的个性。</p>
</blockquote>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/gl115124/tags/laravel_58">laravel</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/gl115124/tags/php_28">php</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/gl115124/tags/laravel-5_1713">laravel-5</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/gl115124/tags/model_159">model</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/gl115124/tags/database_79">database</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/gl115124/tags/lumen_745">lumen</a>
    </div>',
    'created_at' => '2019-12-14 00:01:52',
    'updated_at' => '2019-12-14 00:01:52',
  ),
  3 => 
  array (
    'title' => '在框架中如何使用 config () 来进行访问数据库中的数据？',
    'review' => ' 196',
    'comment' => ' 4',
    'content' => '<ul>
<li>我在查看其他人的代码时，发现他使用config()来调用数据库中的配置。<br>
代码如下：<br><code>$withdrawMoney=config(\'APP_WITH_DRAW_MUST_HAVE_MONEY\',1);</code>
</li>
<li>最终返回的数据为表<code>admin_config</code>中的一条记录的 ‘value’值，该条记录为
<pre><code class=" language-php">[
\'id\'=&gt;7,
\'name\'=&gt;\'APP_WITH_DRAW_MUST_HAVE_MONEY\',
\'value\'=&gt;3,
\'description\'=&gt;\'\'，
...
]</code></pre>
<p>这是如何通过 config() 来获取到该值，希望能得到解答，谢谢</p>
</li>
</ul>',
    'created_at' => '2019-12-13 22:07:30',
    'updated_at' => NULL,
  ),
  4 => 
  array (
    'title' => '从零开始搭建一个 demo 项目',
    'review' => ' 658',
    'comment' => ' 6',
    'content' => '<ul>
<li><a href="#Introduction">简介</a></li>
<li>
<a href="#preparation-before-development">开发前的准备</a>
<ul>
<li><a href="#applicable-items">适用项目</a></li>
<li><a href="#version-dependent">版本相关</a></li>
<li><a href="#environment-setup">环境搭建</a></li>
</ul>
</li>
<li><a href="#create-project">创建项目</a></li>
<li><a href="#api-login">API 登录</a></li>
<li><a href="#response-processing">统一Restful API 响应处理</a></li>
<li><a href="#return-value">处理接口返回值</a></li>
<li>
<a href="#enumerate">实现枚举的三种方式</a>
<ul>
<li><a href="#enumerate-one">单独的枚举目录(一对一)</a></li>
<li><a href="#enumerate-two">配置文件(一对多)</a></li>
<li><a href="#enumerate-three">嵌套太模型中(一对一)</a></li>
</ul>
</li>
<li><a href="#Interface-filtering">接口筛选</a></li>
<li>
<a href="#other">其他配置</a>
<ul>
<li><a href="#lang">语言包安装</a></li>
<li><a href="#debug">debug调试工具栏</a></li>
<li><a href="#helper">laravel-ide-helper</a></li>
<li><a href="#ask">解决跨域问题</a></li>
</ul>
</li>
<li>
<p><a href="#over">总结</a></p>
<p><a name="Introduction"></a></p>
</li>
</ul>
<h3>简介</h3>
<p>我之前遇到这样一个问题，平时都是对已有的项目进行维护或者添加一些新功能，偶尔有一天，需要我自己独立负责一个项目的时候，就有点“无从下手”，对，就是无从下手！零碎的知识点不知道该怎么把它们拼到一起，当最终完成时又会感慨：“哎呀，当时我为什么不那样做呢？我那时候没考虑到这个情况，我应该这样做的，等等”。</p>
<p>于是，我就想，为什么不做一个demo项目方便我或者他人使用呢？ 因为需求是不同的，所以这个demo项目封装的只是一些通用的，常用到的内容，如有做的不对的地方，请点击右下方的纠正按钮，我们一起来完善它。</p>
<p><a name="preparation-before-development"></a></p>
<h2>开发前的准备</h2>
<p><a name="applicable-items"></a></p>
<h3>适用项目范围</h3>
<p>适用于小、中型项目，不涉及到高并发等情况，只是作为新手入门使用。</p>
<blockquote>
<p>项目偏重点为api接口部分。</p>
</blockquote>
<p><a name="version-dependent"></a></p>
<h3>版本相关</h3>
<div class="content-list">
<ul>
<li>barryvdh/laravel-cors: "^0.11.4",</li>
<li>laravel/framework: "^6.2",</li>
<li>laravel/passport: "^8.0",</li>
<li>spatie/laravel-query-builder: "^2.3"</li>
</ul>
</div>
<p><a name="environment-setup"></a></p>
<h3>环境搭建</h3>
<p>我们默认您已经安装好了所需的 lnmp环境，环境搭建请看<a href="https://learnku.com/docs/laravel-development-environment/6.x">Laravel 开发环境部署</a></p>
<blockquote>
<p>如果您喜欢使用集成环境，推荐<a href="http://www.laragon.com.cn/">Laragon</a>、<a href="https://www.xp.cn/">PHPStudy</a></p>
</blockquote>
<p><a name="create-project"></a></p>
<h2>创建项目</h2>
<h3>通过Laravel安装器</h3>
<pre><code class=" language-php"> composer global  require laravel/installer</code></pre>
<p>确保将 Composer\'s system-wide vendor 目录放置在你的系统环境变量 $PATH 中，如果ok，您可以使用<code>laravel new 项目名</code> 创建一个新的项目。</p>
<h3>通过composer</h3>
<pre><code class=" language-php"> composer create-project --prefer-dist laravel/laravel 项目名</code></pre>
<h3>从github拉取项目</h3>
<p>您可以通过下面命令直接拉取本项目：</p>
<pre><code class=" language-php"> git clone https://github.com/Jouzeyu/api-demo.git</code></pre>
<h3>相关配置</h3>
<p>您可以在<code>.env</code>文件中配置您的数据库连接，然后运行<code>php artisan migrate</code>命令迁移数据库。</p>
<p><a name="api-login"></a></p>
<h2>API 登录</h2>
<h3>说明</h3>
<p>我们这里使用官方给推荐的Passport OAuth 认证，当然你也可以使用<a href="https://learnku.com/docs/dingo-api/2.0.0">Dingo API</a>。如果你的项目只是几个人使用且不需要刷新令牌的话，也可以尝试使用Laravel的 <a href="https://learnku.com/docs/laravel/6.x/api-authentication/5429">API 认证</a>。</p>
<h3>安装</h3>
<pre><code class=" language-php">composer require laravel/passport</code></pre>
<h3>运行迁移</h3>
<pre><code class=" language-php">php artisan migrate</code></pre>
<blockquote>
<p>运行迁移后将在数据库中自动创建相关表，如果提示错误，请优先查看您的<code>.env</code>文件中的数据库连接是否正确。</p>
</blockquote>
<h3>生成秘钥和客户端</h3>
<p>接下来，运行 <code>passport:install</code> 命令来创建生成安全访问令牌时所需的加密密钥，同时，这条命令也会创建用于生成访问令牌的「个人访问」客户端和「密码授权」客户端：</p>
<pre><code class=" language-php">php artisan passport:install</code></pre>
<h3>配置及使用</h3>
<p>第一步：在User模型中引用 <code>HasApiTokens</code>：</p>
<pre><code class=" language-php">&lt;?php

namespace App;

use Illuminate\\Contracts\\Auth\\MustVerifyEmail;
use Illuminate\\Notifications\\Notifiable;
use Illuminate\\Foundation\\Auth\\User as Authenticatable;
use Laravel\\Passport\\HasApiTokens;

class User extends Authenticatable
{
    use Notifiable, HasApiTokens;
}</code></pre>
<p>第二步：在 <code>app/Providers/AuthServiceProvider</code> 中的 <code>boot</code> 方法中调用 <code>Passport::routes</code> 方法。</p>
<pre><code class=" language-php">&lt;?php

namespace App\\Providers;

use Laravel\\Passport\\Passport;
use Illuminate\\Support\\Facades\\Gate;
use Illuminate\\Foundation\\Support\\Providers\\AuthServiceProvider as ServiceProvider;

class AuthServiceProvider extends ServiceProvider
{
    /**
     * The policy mappings for the application.
     *
     * @var array
     */
    protected $policies = [
        //\'App\\Model\' =&gt; \'App\\Policies\\ModelPolicy\'
    ];

    /**
     * Register any authentication / authorization services.
     *
     * @return void
     */
    public function boot()
    {
        $this-&gt;registerPolicies();

        Passport::routes();
    }
}</code></pre>
<p>最后一步：在 <code>config/auth.php</code> 配置文件中，将 api 的 <code>driver</code> 选项替换为 <code>passport</code>：</p>
<pre><code class=" language-php">\'guards\' =&gt; [
    \'web\' =&gt; [
        \'driver\' =&gt; \'session\',
        \'provider\' =&gt; \'users\',
    ],
    \'api\' =&gt; [
        \'driver\' =&gt; \'passport\',
        \'provider\' =&gt; \'users\',
    ],
],</code></pre>
<blockquote>
<p>推荐文章：<a href="https://learnku.com/laravel/t/22586">使用 Laravel Passport 处理 API 认证<br></a></p>
</blockquote>
<h3>项目相关：完成API登录（其他部分）</h3>
<p>1. 在<code>app/Http/Controllers/Api</code>下创建<code>Controller.php</code>，内容许下：</p>
<pre><code class=" language-php">&lt;?php

namespace App\\Http\\Controllers\\Api;

use Illuminate\\Routing\\Controller as BaseController;

class Controller extends BaseController
{

}
</code></pre>
<p>2. 创建 Auth控制器并修改如下：</p>
<pre><code class=" language-php">&lt;?php

namespace App\\Http\\Controllers\\Api;

use Illuminate\\Http\\Request;
use Illuminate\\Support\\Facades\\Auth;
use Carbon\\Carbon;
use App\\User;
use Illuminate\\Support\\Facades\\Hash;

class AuthController extends Controller
{
    /**
     * Create user
     *
     * @param  [string] name
     * @param  [string] email
     * @param  [string] password
     * @return [string] message
     */
    public function register(Request $request)
    {
        $request-&gt;validate([
            \'name\' =&gt; \'required|string\',
            \'email\' =&gt; \'required|string|email|unique:users\',
            \'password\' =&gt; \'required|string\'
        ]);

        $user = new User([
            \'name\' =&gt; $request-&gt;name,
            \'email\' =&gt; $request-&gt;email,
            \'password\' =&gt; Hash::make($request-&gt;password)
        ]);

        $user-&gt;save();

        return response()-&gt;json([
            \'message\' =&gt; \'用户创建成功\'
        ], 201);
    }

    /**
     * Login user and create token
     *
     * @param  [string] email
     * @param  [string] password
     * @param  [boolean] remember_me
     * @return [string] access_token
     * @return [string] token_type
     * @return [string] expires_at
     */
    public function login(Request $request)
    {
        $request-&gt;validate([
            \'email\' =&gt; \'required|string|email\',
            \'password\' =&gt; \'required|string\',
            \'remember_me\' =&gt; \'boolean\'
        ]);

        $credentials = request([\'email\', \'password\']);

        if(!Auth::attempt($credentials))
            return response()-&gt;json([
                \'message\' =&gt; \'用户名或者密码错误\'
            ], 401);

        $user = $request-&gt;user();

        $tokenResult = $user-&gt;createToken(\'Personal Access Token\');
        $token = $tokenResult-&gt;token;

        if ($request-&gt;remember_me)
            $token-&gt;expires_at = Carbon::now()-&gt;addWeeks(1);

        $token-&gt;save();

        return response()-&gt;json([
            \'access_token\' =&gt; $tokenResult-&gt;accessToken,
            \'token_type\' =&gt; \'Bearer\',
            \'expires_at\' =&gt; Carbon::parse(
                $tokenResult-&gt;token-&gt;expires_at
            )-&gt;toDateTimeString()
        ]);
    }

    /**
     * Get the authenticated User
     *
     * @return [json] user object
     */
    public function userInfo(Request $request)
    {
        return response()-&gt;json($request-&gt;user());
    }
}</code></pre>
<p>3. api路由部分：</p>
<pre><code class=" language-php">Route::group([
    \'prefix\' =&gt; \'v1\'
], function () {
    Route::post(\'login\', \'Api\\AuthController@login\');
    Route::post(\'register\', \'Api\\AuthController@register\');

    Route::group([
      \'middleware\' =&gt; \'auth:api\'
    ], function() {
        Route::get(\'user_info\', \'Api\\AuthController@userInfo\');
    });
});</code></pre>
<h3>项目相关：测试结果</h3>
<p>注册结果：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/74jInocJZf.png!large" alt="从 0 开始搭建一个 demo 项目"></p>
<p>登录结果：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/3HEi1N93dl.png!large" alt="从 0 开始搭建一个 demo 项目"></p>
<p>置换详细信息结果:</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/B9oRGQ6FL6.png!large" alt="从 0 开始搭建一个 demo 项目"></p>
<p><a name="response-processing"></a></p>
<h2>统一 Restful API 响应处理</h2>
<h3>说明</h3>
<p>私下和公司前端聊过，怎样的Restful API 响应对他们调用起来更加友好，前端说只要统一就好，但是经过尝试，对接，我发现后端捕获所有异常，并添加到返回数据中更加适合前后端分离项目。所以我们这里采用的也是这种方式。</p>
<h3>封装统一返回信息</h3>
<p>首先我们在<code>app/Api</code>文件夹下新建一个<code>Helpers</code>文件夹并创建一个名为<code>ApiResponse.php</code>的文件来存放我们要封装的内容:</p>
<pre><code class=" language-php">&lt;?php
namespace App\\Api\\Helpers;
use Symfony\\Component\\HttpFoundation\\Response as FoundationResponse;
use Response;

trait ApiResponse
{
    /**
     * @var int
     */
    protected $statusCode = FoundationResponse::HTTP_OK;

    /**
     * @return mixed
     */
    public function getStatusCode()
    {
        return $this-&gt;statusCode;
    }

    /**
     * @param $statusCode
     * @return $this
     */
    public function setStatusCode($statusCode,$httpCode=null)
    {
        $httpCode = $httpCode ?? $statusCode;
        $this-&gt;statusCode = $statusCode;
        return $this;
    }

    /**
     * @param $data
     * @param array $header
     * @return mixed
     */
    public function respond($data, $header = [])
    {

        return Response::json($data,$this-&gt;getStatusCode(),$header);
    }

    /**
     * @param $status
     * @param array $data
     * @param null $code
     * @return mixed
     */
    public function status($status, array $data, $code = null){

        if ($code){
            $this-&gt;setStatusCode($code);
        }
        $status = [
            \'status\' =&gt; $status,
            \'code\' =&gt; $this-&gt;statusCode
        ];

        $data = array_merge($status,$data);
        return $this-&gt;respond($data);

    }

    /**
     * @param $message
     * @param int $code
     * @param string $status
     * @return mixed
     */
    /*
     * 格式
     * data:
     *  code:422
     *  message:xxx
     *  status:\'error\'
     */
    public function error($message, $code = FoundationResponse::HTTP_BAD_REQUEST,$status = \'error\'){

        return $this-&gt;setStatusCode($code)-&gt;message($message,$status);
    }

    /**
     * @param $message
     * @param string $status
     * @return mixed
     */
    public function message($message, $status = "success"){

        return $this-&gt;status($status,[
            \'message\' =&gt; $message
        ]);
    }

    /**
     * @param string $message
     * @return mixed
     */
    public function internalError($message = "Internal Error!"){

        return $this-&gt;error($message,FoundationResponse::HTTP_INTERNAL_SERVER_ERROR);
    }

    /**
     * @param string $message
     * @return mixed
     */
    public function created($message = "created")
    {
        return $this-&gt;setStatusCode(FoundationResponse::HTTP_CREATED)
            -&gt;message($message);

    }

    /**
     * @param $data
     * @param string $status
     * @return mixed
     */
    public function success($data, $status = "success"){

        return $this-&gt;status($status,compact(\'data\'));
    }

    /**
     * @param string $message
     * @return mixed
     */
    public function notFond($message = \'Not Fond!\')
    {
        return $this-&gt;error($message,Foundationresponse::HTTP_NOT_FOUND);
    }
}</code></pre>
<h3>如何使用</h3>
<h4>修改基类</h4>
<pre><code class=" language-php">&lt;?php

namespace App\\Http\\Controllers\\Api;

use App\\Api\\Helpers\\ApiResponse;
use App\\Http\\Controllers\\Controller as BaseController;

class Controller extends BaseController
{

    use ApiResponse;
    // 引用封装好的错误提示模板
}</code></pre>
<h4>其他控制器调用</h4>
<p>1. 返回正确资源信息</p>
<pre><code class=" language-php">return $this-&gt;success($users);</code></pre>
<p>2. 返回自定义 http 状态码的正确信息</p>
<pre><code class=" language-php">return $this-&gt;setStatusCode(201)-&gt;success($users);</code></pre>
<p>3. 返回错误信息</p>
<pre><code class=" language-php">return $this-&gt;error(\'用户注册失败\');</code></pre>
<p>5. 返回自定义 http 状态码的错误信息</p>
<pre><code class=" language-php">return $this-&gt;error(\'用户登录失败\',401);</code></pre>
<blockquote>
<p>声明：这块部分参考自<a href="https://learnku.com/articles/25947">手摸手教你让 Laravel 开发 API 更得心应手</a></p>
</blockquote>
<h3>项目相关：完善其他部分</h3>
<p>1. 创建Users控制器，方便测试：</p>
<pre><code class=" language-php">&lt;?php

namespace App\\Http\\Controllers\\Api;

use App\\User;
use Illuminate\\Http\\Request;

class UsersController extends Controller
{
   public function test(Request $request){
       $user=User::where(\'id\',1)-&gt;first();
       return $this-&gt;success($user);
   }
}
</code></pre>
<p>2. 注册路由</p>
<pre><code class=" language-php">Route::group([
    \'prefix\' =&gt; \'v1\'
], function () {
    Route::get(\'test\', \'Api\\UsersController@test\');//这里，不需要登录认证

   ……

});</code></pre>
<h3>项目相关：测试结果</h3>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/N52EUNfdZS.png!large" alt="从 0 开始搭建一个 demo 项目"></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/QnMu1uTpUX.png!large" alt="从 0 开始搭建一个 demo 项目"></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/Vuw0fwEVg9.png!large" alt="从 0 开始搭建一个 demo 项目"></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/ZXOj0kdpgo.png!large" alt="从 0 开始搭建一个 demo 项目"></p>
<p><a name="return-value"></a></p>
<h2>处理接口返回值</h2>
<h3>问题抛出</h3>
<p>为了安全等原因，我们都会限制其返回值。如你所见，在上一块中返回User信息时，返回的是所有的数据，其中就包含了敏感信息<code>password</code>，常见的敏感信息还包括微信的<code>openid</code>等，如何避免就是这一块的主要内容。</p>
<h3>API资源</h3>
<h4>简介</h4>
<p>你往往需要一个转换层来联结你的 Eloquent 模型和实际返回给用户的 JSON 响应，也就是我们常说的<code>ViewModel</code>层。</p>
<h4>创建用户资源</h4>
<pre><code class=" language-php">php artisan make:resource Api/UserResource</code></pre>
<p>ok，我们可以看到在http目录下多了一个resource目录，展开后编辑<code>UserResource.php</code>如下：</p>
<pre><code class=" language-php">&lt;?php

namespace App\\Http\\Resources\\Api;

use Illuminate\\Http\\Resources\\Json\\JsonResource;

class UserResource extends JsonResource
{
    /**
     * 这里指定了返回值
     *
     * @param  \\Illuminate\\Http\\Request  $request
     * @return array
     */
    public function toArray($request)
    {
        return [
            \'id\'=&gt;$this-&gt;id,
            \'name\' =&gt; $this-&gt;name,
            \'email\' =&gt; $this-&gt;email,
            \'created_at\'=&gt;(string)$this-&gt;created_at,
            \'updated_at\'=&gt;(string)$this-&gt;updated_at
        ];
    }
}</code></pre>
<h4>如何使用</h4>
<p>打开我们的User测试控制器，将：</p>
<pre><code class=" language-php">  return $this-&gt;success($user);</code></pre>
<p>替换为：</p>
<pre><code class=" language-php">return $this-&gt;success(new UserResource($user));</code></pre>
<blockquote>
<p>注意：该方法只适合返回单一用户，否则将无法使用分页。如果是用户列表，你可以使用<code>return UserResource::collection($user);</code></p>
</blockquote>
<h3>项目相关：测试结果</h3>
<p><img src="https://cdn.learnku.com/uploads/images/201912/08/32858/dShG78iUPZ.png!large" alt="从零开始搭建一个 demo 项目"></p>
<p><a name="enumerate"></a></p>
<h2>实现枚举的三种方式</h2>
<p>现在有一个需求，给用户添加状态，比如冻结，正常。这是很普遍的需求，我们一般是在数据表中多一个status字段，用数字代表身份，但是短时间内我们知道数字所代表的含义，时间一长就忘记了，而且前端人员也不清楚。怎么办呢，我们就用到了枚举。</p>
<p><a name="enumerate-one"></a></p>
<h3>单独的枚举目录</h3>
<h4>创建Enum目录</h4>
<p>在<code>app</code>下创建一个 Enum 目录，里面存放我们的枚举文件，例如<code>UserEnum.php</code>：</p>
<pre><code class=" language-php">&lt;?php

namespace App\\Enum;
class UserEnum
{
    // 状态类别
    const NORMAL = 1; //正常
    const FREEZE = 2; //冻结

    public static function getStatusName($status){
        switch ($status){
            case self::NORMAL:
                return \'正常\';
            case self::FREEZE:
                return \'冻结\';
            default:
                return \'正常\';
        }
    }
}</code></pre>
<h4>使用</h4>
<p>修改 <code>UserResource.php</code>:</p>
<pre><code class=" language-php">return [
            \'id\'=&gt;$this-&gt;id,
            \'name\' =&gt; $this-&gt;name,
            \'email\' =&gt; $this-&gt;email,
            \'status\'  =&gt;  UserEnum::getStatusName($this-&gt;status),
            \'created_at\'=&gt;(string)$this-&gt;created_at,
            \'updated_at\'=&gt;(string)$this-&gt;updated_at
        ];</code></pre>
<blockquote>
<p>提示：冻结状态就不应该能够登陆了，这里的判断逻辑请自行编写</p>
</blockquote>
<p><a name="enumerate-two"></a></p>
<h3>配置文件</h3>
<blockquote>
<p>因为篇幅较长，大家可以看我之前的博客<a href="https://learnku.com/articles/35994">如何优雅地使用帮助类文件 helpers.php<br></a></p>
</blockquote>
<p><a name="enumerate-three"></a></p>
<h3>嵌套太模型中</h3>
<blockquote>
<p>同理，大家可以看我之前的博客<a href="https://learnku.com/articles/36335">为 type 等字段「保驾护航」</a></p>
</blockquote>
<p>由于每个人喜欢的方式不同，故枚举这块不计入demo项目中。</p>
<p><a name="Interface-filtering"></a></p>
<h2>接口筛选</h2>
<h3>说明</h3>
<p>前面我们已经完善的差不多了，但是还差一个重要的模块，那就是接口筛选。达到的目的就是前端通过不同的参数，来拿到相对应的筛选后的数据。我们这里用的是 <code>laravel-query-builder</code>拓展包。</p>
<h3>安装</h3>
<pre><code class=" language-php">composer require spatie/laravel-query-builder</code></pre>
<h3>发布配置</h3>
<pre><code class=" language-php">php artisan vendor:publish --provider="Spatie\\QueryBuilder\\QueryBuilderServiceProvider" --tag="config"</code></pre>
<h3>如何使用</h3>
<p>1. 首先确保模型中允许通过了所需字段,例如User模型中：</p>
<pre><code class=" language-php"> protected $fillable = [
        \'name\', \'email\', \'password\',
    ];</code></pre>
<p>2. 在控制器中使用：</p>
<pre><code class=" language-php">&lt;?php

namespace App\\Http\\Controllers\\Api;

use App\\Http\\Resources\\Api\\UserResource;
use App\\User;
use Illuminate\\Http\\Request;
use Spatie\\QueryBuilder\\QueryBuilder;

class UsersController extends Controller
{
   public function test(Request $request){
       $users = QueryBuilder::for(User::class)
           -&gt;allowedFilters([\'name\'])
           -&gt;get();
       return UserResource::collection($users);
   }
}</code></pre>
<p>3. 前端筛选</p>
<pre><code class=" language-php">http://api-demo.test/api/v1/test?filter[name]=jouzeyu</code></pre>
<blockquote>
<p>注意：引入的是<code>use Spatie\\QueryBuilder\\QueryBuilder;</code>，而不是其他。我们使用<code>allowedFilters</code>来声明允许筛选的字段。这里我们只是初步介绍一下，更多内容请看<a href="https://docs.spatie.be/laravel-query-builder/v2/introduction/">文档</a></p>
</blockquote>
<p><a name="other"></a></p>
<h2>其他配置</h2>
<p><a name="lang"></a></p>
<h3>语言包安装</h3>
<pre><code class=" language-php">composer require caouecs/laravel-lang:~4.0</code></pre>
<p><a name="debug"></a></p>
<h3>debug调试工具栏</h3>
<pre><code class=" language-php">composer require barryvdh/laravel-debugbar --dev</code></pre>
<blockquote>
<p>提示：<code>--dev</code>代表仅在本地安装</p>
</blockquote>
<p><a name="helper"></a></p>
<h3>laravel-ide-helper</h3>
<pre><code class=" language-php">composer require --dev barryvdh/laravel-ide-helper</code></pre>
<p><a name="ask"></a></p>
<h3>解决跨域问题</h3>
<h4>安装</h4>
<pre><code class=" language-php">composer require barryvdh/laravel-cors</code></pre>
<h4>配置</h4>
<p>在<code>app/Http/Kernel.php</code>中添加：</p>
<pre><code class=" language-php">protected $middleware = [
    // ...
    \\Barryvdh\\Cors\\HandleCors::class,
];</code></pre>
<p><a name="over"></a></p>
<h2>总结</h2>
<p>demo 项目暂时就告一段落了，也许他并不完美，但还是希望对刚刚入门的朋友有所启发。如果你有更好的方案，欢迎在下方评论，感谢。</p>
<blockquote>
<p>开源地址：<a href="https://github.com/Jouzeyu/api-demo" target="_blank">https://github.com/Jouzeyu/api-demo</a></p>
</blockquote>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/apeheng/tags/coding-correlation_52178">编码相关</a>
    </div>
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <p>一个有些偏执的人<br>
     ——Jouzeyu</p>
                                </span>
                            </div>',
    'created_at' => '2019-12-09 08:50:06',
    'updated_at' => '2019-12-09 08:50:06',
  ),
  5 => 
  array (
    'title' => '如何实现数据库版本管理',
    'review' => ' 102',
    'comment' => ' 1',
    'content' => '<h3>问题描述</h3>
<p>1.在项目开发中，由于没有使用到laravel自带的数据库迁移功能。采用的是手动记录更新数据表结构。例如，在新功能开发中，对某张表增加了一个字段或者删除了一个字段等操作，都是将对应的sql语句记录下来。然后将sql语句拿到生产环境中执行，以达到数据库结构保持一致。</p>
<p>2.在不使用laravel自带的数据库迁移功能的情况下，是否有其他的办法实现数据库结构一致，并且更加高效的方式(相对上面提高的记录sql语句方式)。</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/mysql/487">mysql</a>
    </div>',
    'created_at' => '2019-12-14 14:16:18',
    'updated_at' => NULL,
  ),
  6 => 
  array (
    'title' => '刷新 页面内容',
    'review' => ' 132',
    'comment' => ' 2',
    'content' => '<p>我有一个页面http://36.110.202.64:8080/finance_auth</p>
<p>用户名可以输入a1，密码为12345678</p>
<p>登录后会跳转到http://36.110.202.64:8080/finance_auth 页面。</p>
<p>这个finance_auth页面</p>
<pre><code class=" language-php">Route::get(\'/finance_auth\', \'FinanceController@article_auth\')-&gt;middleware(\'auth\')-&gt;name(\'finance_auth\');</code></pre>
<p>在控制器的article_auth方法里面返回了一个视图view（finance_test.blade.php）</p>
<pre><code class=" language-php">return view(\'finance_test\', [\'id\'=&gt; $article-&gt;id, \'title\' =&gt; $article-&gt;title, \'content\' =&gt; $article-&gt;content, \'username\' =&gt; $user_name, \'tag_name_arr\' =&gt; $result] );</code></pre>
<p>然后finance_test.blade.php的内容如下，里面用到了一个vue的组件：</p>
<pre><code class=" language-php">
@extends(\'layouts.app\')

@section(\'content\')
    &lt;div class="container"&gt;
        &lt;div class="row justify-content-center"&gt;
            &lt;div class="col-md-12"&gt;
                &lt;div class="card"&gt;
                    &lt;div class="card-header"&gt;Dashboard&lt;/div&gt;

                    &lt;div class="card-body"&gt;
                        @if (session(\'status\'))
                            &lt;div class="alert alert-success" role="alert"&gt;
                                {{ session(\'status\') }}
                            &lt;/div&gt;
                        @endif

                            &lt;h1&gt;&lt;center&gt;{{$id}}:{{$title}}&lt;/center&gt;&lt;/h1&gt;
                            &lt;br /&gt;

                            {!! $content !!}     #**此处显示正文内容**

                        @include(\'layouts.footer\', [\'my_title\' =&gt; \'aaaaaaaaaa\'])

                        &lt;elesos-component :article_id={{$id}} :my_data=\'@json($tag_name_arr)\'&gt;&lt;/elesos-component&gt;
                        # 这个是vue组件,代码见下

                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

    &lt;/div&gt;
@endsection
</code></pre>
<p>组件的代码如下：</p>
<pre><code class=" language-php">&lt;template&gt;
    &lt;div&gt;
        &lt;el-row&gt;
        #显示页面下方的按钮。
        &lt;el-button v-for="(value, name, index) in my_data" v-bind:value="name" @click="process_click(name)" type="success" plain&gt;{{name}}{{value}}&lt;/el-button&gt;
        &lt;/el-row&gt;

    &lt;/div&gt;

&lt;/template&gt;

&lt;script&gt;
    export default {
        mounted() {
            console.log(\'Component mounted.\')

        },
        props: [\'my_data\', \'article_id\'],

        methods:{
            process_click:function (name) {
                console.log(name);
                axios.get(\'http://36.110.202.64:8080/get_me/\'+name+\'/\'+this.article_id).then(response =&gt; console.log(response.data));
            }

        }

    }

&lt;/script&gt;
</code></pre>
<p>组件显示了页面下方的按钮，然后点击按钮会发http get请求到get_me路由上</p>
<p><img src="https://elesos.gitee.io/images/knowledge-graph-tool.png" alt=""></p>
<p>Route::get(\'/get_me/{name}/{article_id}\', \'FinanceController@get_me\');</p>
<p>现在我想在get_me方法里面将页面的内容刷新，然后将按钮的文字也更新。不知道如何做，麻烦朋友们提供一下思路。谢谢大家。</p>
<pre><code class=" language-php"> public function get_me(Request $request, $name, $article_id){
        //$user_id = Auth::id();
        $user = Auth::user();
        $user_name = $user-&gt;name;

        Finance::where(\'id\', $article_id)-&gt;update([\'state\' =&gt; 2, \'userid\' =&gt; $user_name, \'tag_type\' =&gt; $name]);

        //return redirect(\'/finance_auth\'); //能返回页面内容，但是本页面不刷新

    }</code></pre>',
    'created_at' => '2019-12-14 14:52:50',
    'updated_at' => NULL,
  ),
  7 => 
  array (
    'title' => '实战课程发布 —— 满满的干货《L06 Laravel 教程 - 电商进阶》',
    'review' => ' 47344',
    'comment' => ' 93',
    'content' => '<div class="text-center"><img src="https://cdn.learnku.com/uploads/images/201809/10/1/3ohnmTYjwf.jpg?imageView2/2/w/1240/h/0" width="300" alt="0"></div>
<h2>Laravel 电商进阶教程</h2>
<p>本书是 Laravel 教程系列的第六本，前五本分别是：</p>
<blockquote>
<p><strong> Laravel 实战系列教程</strong> 里的每一个课程都是一个不同的阶段，后面的课程依赖于前面的知识，独立学习的话却又自成体系，因为每一个课程就是一个实战的项目。核心设计理念是一步步把你从 Laravel 新手培养为 Laravel 高级工程师。</p>
</blockquote>
<ul>
<li>第一本 <a href="https://learnku.com/laravel/t/3383">《L01 Laravel 入门教程 - 从零到部署上线》</a>
</li>
<li>第二本 <a href="https://learnku.com/laravel/t/6592">《L02 Laravel 进阶课程 - 从零开始构建论坛系统》</a>
</li>
<li>第三本 <a href="https://learnku.com/laravel/t/7657">《L03 Laravel 教程 - 实战构架 API 服务器》</a>
</li>
<li>第四本 <a href="https://learnku.com/laravel/t/10318">《L04 Laravel 教程 - 微信小程序从零到发布》</a>
</li>
<li>第五本 <a href="https://learnku.com/laravel/t/13206/laravel-shop-course">《L05 Laravel 教程 - 电商实战》</a>
</li>
</ul>
<p>课程序号 L06，本书将在《L05 Laravel 教程 - 电商实战》课程项目 <a href="https://github.com/summerblue/laravel-shop">Laravel Shop</a> 基础上带你一步一步构建一个更加强大的电商系统，功能脑图如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201809/10/1/mypHJXRp2T.jpg?imageView2/2/w/1240/h/0" alt="file"></p>
<p>课程涉及开发的详细技术知识点如下：</p>
<ul>
<li>高性能无限级类目数据库结构；</li>
<li>Ngrok 内网穿透；</li>
<li>Laravel-Admin 下拉框异步加载数据；</li>
<li>面包屑导航的概念；</li>
<li>使用递归构建类目树；</li>
<li>使用 ViewComposer 剥离与控制器无关的逻辑；</li>
<li>众筹的业务逻辑；</li>
<li>众筹的数据库结构；</li>
<li>通过代码封装减少重复代码；</li>
<li>众筹的下单逻辑；</li>
<li>Carbon 类设置语言；</li>
<li>众筹的结束逻辑；</li>
<li>使用异步任务优化定时任务；</li>
<li>分期付款的业务逻辑；</li>
<li>分期付款的数据库结构；</li>
<li>涉及到金钱的数值计算方式</li>
<li>使用分期付款支付商品订单；</li>
<li>分期还款的逻辑；</li>
<li>逾期费计算逻辑；</li>
<li>使用 <code>chunkById()</code> 减少内存占用；</li>
<li>分期付款的退款逻辑；</li>
<li>商品添加属性和长标题；</li>
<li>Elasticsearch 的基础概念；</li>
<li>Elasticsearch 的 API 调用方式；</li>
<li>在 Laravel 中调用 Elasticsearch 接口；</li>
<li>通过 Elasticsearch API 创建索引；</li>
<li>使用 PHP 代码将数据库中的商品数据添加到 Elasticsearch 索引中；</li>
<li>Elasticsearch 查询语法入门；</li>
<li>将搜索功能改用 Elasticsearch 构建；</li>
<li>分面搜索的概念；</li>
<li>Elasticsearch 聚合查询；</li>
<li>Elasticsearch 对象数组数据存储方式；</li>
<li>Elasticsearch 分析器的概念；</li>
<li>自定义 Elasticsearch 分析器；</li>
<li>Elasticsearch 实现同义词搜索；</li>
<li>通过 Elasticsearch 的 <code>should</code> 条件实现相似商品的搜索；</li>
<li>Elasticsearch 索引别名的概念；</li>
<li>Elasticsearch 索引结构无缝迁移方案；</li>
<li>用 Laravel 实现Elasticsearch 索引结构无缝迁移；</li>
<li>在 Ubuntu 16.04 的服务器中安装 Laravel 项目的运行环境；</li>
<li>线上环境手动部署代码的具体步骤；</li>
<li>使用 Deployer 执行部署脚本；</li>
<li>Deployer 部署的项目目录结构；</li>
<li>使用 Horizon 管理异步队列；</li>
<li>使用 Supervisor 管理 Horizon 进程；</li>
<li>多机部署时 Mysql、Redis、Elasticsearch 的配置；</li>
<li>使用阿里云 SLB 实现多机负载均衡；</li>
<li>秒杀商品的数据库结构；</li>
<li>秒杀商品的抢购逻辑；</li>
<li>压力测试工具 JMeter 的使用；</li>
<li>记录 SQL 日志的姿势；</li>
<li>使用 Redis 代替 Mysql 以提高性能；</li>
<li>使用随机拒绝的方法线性提高秒杀接口吞吐量。</li>
</ul>
<h2>截图</h2>
<p><strong>高性能无限级分类：</strong></p>
<p>
<img class="rm-style" src="https://cdn.learnku.com/uploads/images/201809/10/1/MZlnBkklGP.png?imageView2/2/w/1240/h/0" alt="0"></p>

<p><strong>众筹商品</strong></p>
<p>
<img class="rm-style" src="https://cdn.learnku.com/uploads/images/201809/10/1/awwQRWguTZ.jpg?imageView2/2/w/1240/h/0" alt="0"></p>

<p><strong>分期付款支付</strong></p>
<p>
<img class="rm-style" src="https://cdn.learnku.com/uploads/images/201809/10/1/BUHmfa8QIM.png?imageView2/2/w/1240/h/0" alt="0"></p>

<p><strong>分面搜索：</strong></p>
<p>
<img class="rm-style" src="https://cdn.learnku.com/uploads/images/201809/10/1/U3TTeRJdOb.png?imageView2/2/w/1240/h/0" alt="0"></p>

<p><img src="https://cdn.learnku.com/uploads/images/201809/10/1/0NneW30g2u.gif?imageView2/2/w/1240/h/0" alt="file"></p>
<p><strong>商品推荐：</strong></p>
<p>
<img class="rm-style" src="https://cdn.learnku.com/uploads/images/201809/10/1/thFfqxfJNe.png?imageView2/2/w/1240/h/0" alt="0"></p>

<h2>源码</h2>
<p>按照传统，所有课程源代码基于 MIT 开源，托管于 GitHub ：<a href="https://github.com/summerblue/laravel-shop/tree/advanced" target="_blank">https://github.com/summerblue/laravel-shop...</a></p>
<h2>购买</h2>
<p>请前往：<a href="https://learnku.com/courses/ecommerce-advance" target="_blank">《L06 Laravel 教程 - 电商进阶 ( Laravel 5.8 ) 》</a></p>

                        
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" target="_blank" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <hr>
<p>Practice makes perfect.</p>
                                </span>
                            </div>',
    'created_at' => '2018-09-10 11:31:15',
    'updated_at' => '2018-09-10 11:59:09',
  ),
  8 => 
  array (
    'title' => '程序员的定位：『应用型工程师』或『科研型工程师』',
    'review' => ' 1310',
    'comment' => ' 12',
    'content' => '<p>社区里经常看到新人有类似的困惑：</p>
<blockquote>
<p><strong>做过一些项目，算入门了，现在找不到学习方向，该怎么办？</strong></p>
</blockquote>
<p>以上与下面这几个问题有相似之处：</p>
<blockquote>
<p><strong>怎么样才算熟练掌握了这一门技术？Laravel 开发怎么样我才会算学会了？</strong></p>
</blockquote>
<p>这些疑问属于我们程序员的焦虑。至少我之前也焦虑过很长的一段时间，后面随着工作中项目经验的积累，慢慢会变得从容点了。不过每到学习新的语言，或者新的技术时，就会再度陷入这个焦虑。思考的多了，偶尔也会总结下，在此分享此观点希望对同样困惑的你有所助益。</p>
<h2>两个方向</h2>
<p>我喜欢把编程的方向分为以下：</p>
<ul>
<li>应用型</li>
<li>科研型</li>
</ul>
<p><strong>应用型</strong> 关键词是『应用』，以 Web 开发为例如：博客、CMS、论坛、电商（B2C, C2C）、CRM、企业内部管理系统、视频、实时聊天、直播、外卖等。跟现实生活比较贴近的，能通过编程来实现产品功能，以此来改进社会生产效率的领域。</p>
<p><strong>科研型</strong> 例如在以 PHP + Laravel 为主的 Web 开发中，专注的话题有程序内部架构、设计模式、算法、编译原理、PHP 源码、PHP 原生 C 编写扩展等。这些比较抽象，相比应用来讲比较『抽象』，经常被我们称为『底层』的领域。</p>
<h2>关注点不同</h2>
<p><strong>应用型工程师</strong> 主观上把技术当做工具，重点放在如何利用技术去实现产品的商业逻辑上。不拘泥于技术细节，专注点在于要做出来的东西上。</p>
<p><strong>科研型工程师</strong> 对技术的态度是追本溯源，他们熟知 PHP 底层的运行机制、变量的底层实现、垃圾回收机制等，甚至接触 LAMP 常见技术堆栈的源码。关注的是代码执行效率和工程合理性。</p>
<h2>能力区分</h2>
<p><strong>应用型工程师能力</strong> 的衡量标准有两点，『<strong>一是项目的类型要泛，另一个是项目量要多</strong>』。当然这些项目最好是独立完成编码或者参与了大部分核心技术架构的设计与实施，如数据库设计、API 机制的设计、技术堆栈的选型等。</p>
<p>以过往经验来看，应用工程师需要经历 5 个以上不同类型，10 个以上的项目才能算毕业。这些项目大部分情况下是自己独立完成的，他们需要对这些项目的技术构架都了如指掌，这要求在接触每一个项目时有意识的去主动学习。</p>
<p><strong>科研型工程师能力</strong> 如果说应用型是『广』的话，科研型就是『深』。衡量标准是清楚知悉架构的缺陷，知道当现有架构出现问题时，如何优化。他们注重性能，深入研究各种周边技术。</p>
<p>例如 PHP 领域大拿鸟哥（博客 <a href="http://www.laruence.com/" target="_blank">http://www.laruence.com/</a>） 。鸟哥是 <a href="http://www.php.net/">PHP</a>开发组核心成员，PHP7主要开发者， <a href="http://pecl.php.net/yaf">Yaf（C 写的 PHP 框架）</a>， <a href="http://pecl.php.net/yar">Yar</a>， <a href="http://pecl.php.net/Yac">Yac</a> 等开源项目作者。</p>
<h2>舞台各异</h2>
<p><strong>应用型工程师</strong> 信条是『天下武功唯快不破』，擅长项目的快速开发和迭代。因此他们比较适合开疆扩土、快速推进商业项目上线的场景，创业公司尤其喜欢这类员工。他们也更能适应需求多变，技术堆栈灵活的工作状态。</p>
<p><strong>科研型工程师</strong> 相对比来讲比较稳扎稳打。他们比较适合大公司。大公司一般都有比较稳定的盈利模式，商业逻辑变动一般不会不大，也就是说产品稳定。技术部门本着『不求有功但求无过』的思路，底层技术架构很少做太大的变动，再加上用户基数大（大流量）带来的高压环境，为深入研究技术提供了需求和条件，大公司也是培养 <strong>科研型工程师</strong> 人才的沃土。</p>
<h2>如何选择方向？</h2>
<p>决策的因素会有很多，例如个人喜好、特长什么（例如有些人逻辑推理能力强，有些人数学好，有人产品意识高），这些我们就不展开了。</p>
<p>这里推荐从自己的目标出发，也就是 ：</p>
<blockquote>
<p>你学编程的终极目标是为了啥？</p>
</blockquote>
<p>如果你学编程就是为了以后某一天可以出来创业（你怎么这么想不开啊），做技术合伙人或者自己主导创业，然后走向人生巅峰 <code>~_~</code>。大部分初创的科技公司技术负责人必备技能是：组建技术团队，并带领他们推进产品上线和快速迭代，熟知各种互联网产品的功能，以及清楚地知道这些功能的开发难度，懂得在开发效率和商业机会上权衡，懂得如何避坑。那么推荐你从现在把自己定位为 <strong>应用型工程师</strong> ，然后开始积累项目经验。可以理解为打怪升级，不惜一切代价接触新项目，积累一个个的项目经验，10 个项目算毕业，30 个项目算资深。</p>
<p>如果你的目标是进大公司，也就是抱大腿走稳定路线，那么推荐你把自己定位为 <strong>科研型工程师</strong>。从今天开始死磕文档，把主要相关技术文档看很多遍，阅读各大开源项目的源码，可以尝试参与源码贡献和改进，或者写一些高性能的原生扩展。</p>
<h2>怎么样才算熟练掌握了这一门技术？</h2>
<p>方向选好后，就好办多了。</p>
<p>如果你是  <strong>应用型工程师</strong> ，那么在你做了几十个项目后，一般项目中经常用到的技术，你都很熟练了，并且随着每一个项目经验的累积，眼界的提高，你也会越来越自信。</p>
<p>如果是  <strong>科研型工程师</strong>，不断深入，穷源竟委，长此以往几年十来年后也会有所建树。届时你的深入细致的博文，或者技术文献，或者开源影响力，都会成为你骄傲的成本，自然也就不会有『算不算掌握了 XXX』的疑惑了。</p>
<h2>结语</h2>
<p>区分两个方向后，有所侧重，相比同时学习两个方向，学习难度和耗时都会有所降低。再加上舞台各异，精准定位后，能更快实现个人目标，也算是让自己的人生更高效。</p>
<p>这两个方向也不会有冲突，<strong>应用型工程师</strong> 偶尔学习一些底层的技术，对自己的技能精进会很有帮助，而  <strong>科研型工程师</strong> 偶尔关注当下流行的产品应用，也可以避免陷入闭门造车的困境。</p>
<p>以上就是我的一些见解，关于这个话题大家有啥思考也可以给我留言哈。</p>

                        
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <hr>
<p>Practice makes perfect.</p>
                                </span>
                            </div>',
    'created_at' => '2019-12-10 11:37:47',
    'updated_at' => '2019-12-10 11:37:47',
  ),
  9 => 
  array (
    'content' => '<div class="toc-wraper ui  card column author-box grid pt-2" style="display:none">
                        <a href="javascript:void(0);" class="close-toc pull-right" style="width: 20px;position: absolute;right: 7px;top: 3px;margin-bottom: 20px;">
                            <i class="icon remove text-mute "></i>
                        </a>
                        <div id="toc">
                        </div>
                    </div>

                    <h1>Laravel 的配置信息</h1>
<ul>
<li><a href="#introduction">介绍</a></li>
<li>
<a href="#environment-configuration">环境配置</a>
<ul>
<li><a href="#retrieving-environment-configuration">检索环境配置</a></li>
<li><a href="#determining-the-current-environment">确定当前环境</a></li>
</ul>
</li>
<li><a href="#accessing-configuration-values">访问配置值</a></li>
<li><a href="#configuration-caching">配置缓存</a></li>
<li><a href="#maintenance-mode">维护模式</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2>介绍</h2>
<p>Laravel 框架的所有配置文件都保存在 <code>config</code> 目录中。 每个选项都有说明，你可随时查看这些文件并熟悉都有哪些配置选项可供你使用。</p>
<p><a name="environment-configuration"></a></p>
<h2>环境配置</h2>
<p>对于应用程序运行的环境来说，不同的环境有不同的配置通常是很有用的。 例如，你可能希望在本地使用的缓存驱动不同于生产服务器所使用的缓存驱动。</p>
<p>Laravel 利用 Vance Lucas 的 PHP 库 <a href="https://github.com/vlucas/phpdotenv">DotEnv</a> 使得此项功能的实现变得非常简单。在新安装好的 Laravel 应用程序中，其根目录会包含一个 <code>.env.example</code> 文件。如果是通过 Composer 安装的 Laravel，该文件会自动更名为 <code>.env</code>。否则，需要你手动更改一下文件名。</p>
<p>你的 <code>.env</code> 文件不应该提交到应用程序的源代码控制系统中，因为每个使用你的应用程序的开发人员 / 服务器可能需要有一个不同的环境配置。此外，在入侵者获得你的源代码控制仓库的访问权的情况下，这会成为一个安全隐患，因为任何敏感的凭据都被暴露了。</p>
<p>如果是团队开发，则可能希望应用程序中仍包含 <code>.env.example</code> 文件。因为通过在示例配置文件中放置占位值，团队中的其他开发人员可以清楚地看到哪些环境变量是运行应用程序所必需的。你也可以创建一个 <code>.env.testing</code> 文件，当运行 PHPUnit 测试或以 <code>--env=testing</code> 为选项执行 Artisan 命令时，该文件将覆盖 <code>.env</code> 文件中的值。</p>
<blockquote>
<p>{tip} <code>.env</code> 文件中的所有变量都可被外部环境变量（比如服务器级或系统级环境变量）所覆盖。</p>
</blockquote>
<p><a name="retrieving-environment-configuration"></a></p>
<h3>检索环境配置</h3>
<p>当应用程序收到请求时，<code>.env</code> 文件中列出的所有变量将被加载到 PHP 的超级全局变量 <code>$ _ENV</code> 中。你可以使用 <code>env</code> 函数检索这些变量的值。事实上，如果你查看 Laravel 的配置文件，你就能注意到有数个选项已经使用了这个函数：</p>
<pre><code class=" language-php">\'debug\' =&gt; env(\'APP_DEBUG\', false),</code></pre>
<p>传递给 <code>env</code> 函数的第二个值是「默认值」。如果给定的键不存在环境变量，则会使用该值。</p>
<p><a name="determining-the-current-environment"></a></p>
<h3>确定当前环境</h3>
<p>应用程序当前所处环境是通过 <code>.env</code> 文件中的 <code>APP_ENV</code> 变量确定的。你可以通过 <code>App</code> <a href="/docs/laravel/5.5/facades">facade</a> 中的 <code>environment</code>  方法来访问此值：</p>
<pre><code class=" language-php">$environment = App::environment();</code></pre>
<p>你还可以传递参数给 <code>environment</code> 方法，以检查当前的环境配置是否与给定值匹配。 如果与给定值匹配，该方法将返回 <code>true</code>：</p>
<pre><code class=" language-php">if (App::environment(\'local\')) {
    // 环境为 local
}

if (App::environment([\'local\', \'staging\'])) {
    // 环境为 local 或 staging
}</code></pre>
<blockquote>
<p>{tip} 应用程序当前所处环境检测可以被服务器级的 <code>APP_ENV</code> 环境变量覆盖。这为相同的应用程序配置不同的环境时是非常有用的，这样你可以在你的服务器配置中为给定的主机设置与其匹配的给定的环境。</p>
</blockquote>
<p><a name="accessing-configuration-values"></a></p>
<h2>访问配置值</h2>
<p>你可以轻松地在应用程序的任何位置使用全局 <code>config</code> 函数来访问配置值。配置值的访问可以使用「点」语法，这其中包含了要访问的文件和选项的名称。还可以指定默认值，如果配置选项不存在，则返回默认值：</p>
<pre><code class=" language-php">$value = config(\'app.timezone\');</code></pre>
<p>要在运行时设置配置值，传递一个数组给 <code>config</code> 函数：</p>
<pre><code class=" language-php">config([\'app.timezone\' =&gt; \'America/Chicago\']);</code></pre>
<p><a name="configuration-caching"></a></p>
<h2>配置缓存</h2>
<p>为了给你的应用程序提升速度，你应该使用 Artisan 命令 <code>config:cache</code> 将所有的配置文件缓存到单个文件中。这会把你的应用程序中所有的配置选项合并成一个单一的文件，然后框架会快速加载这个文件。</p>
<p>通常来说，你应该把运行 <code>php artisan config:cache</code> 命令作为生产环境部署常规的一部分。这个命令不应在本地开发环境下运行，因为配置选项在应用程序开发过程中是经常需要被更改的。</p>
<blockquote>
<p>{note} 如果在部署过程中执行 <code>config:cache</code> 命令，那你应该确保只从配置文件内部调用 <code>env</code> 函数。</p>
</blockquote>
<p><a name="maintenance-mode"></a></p>
<h2>维护模式</h2>
<p>当应用程序处于维护模式时，所有对应用程序的请求都显示为一个自定义视图。这样可以在更新或执行维护时轻松地「关闭」你的应用程序。 维护模式检查包含在应用程序的默认中间件栈中。如果应用程序处于维护模式，则将抛出一个状态码为 503 的 <code>MaintenanceModeException</code> 异常。</p>
<p>要启用维护模式，只需执行下面的 Artisan 命令 <code>down</code>：</p>
<pre><code class=" language-php">php artisan down</code></pre>
<p>你还可以向 down 命令提供 <code>message</code> 和 <code>retry</code> 选项。其中 message 选项的值可用于显示或记录自定义消息，而 retry 值可用于设置 HTTP 请求头中 <code>Retry-After</code> 的值：</p>
<pre><code class=" language-php">php artisan down --message="Upgrading Database" --retry=60</code></pre>
<p>要关闭维护模式，请使用 <code>up</code> 命令：</p>
<pre><code class=" language-php">php artisan up</code></pre>
<blockquote>
<p>{tip} 你可以通过修改 <code>resources/views/errors/503.blade.php</code> 模板文件来自定义默认维护模式模板。</p>
</blockquote>
<h4>维护模式和队列</h4>
<p>当应用程序处于维护模式时，不会处理 <a href="/docs/laravel/5.5/queues">队列任务</a>。而这些任务会在应用程序退出维护模式后再继续处理。</p>
<h4>维护模式的替代方案</h4>
<p>维护模式会导致应用程序有数秒的停机（不响应）时间，因此你可以考虑使用像 <a href="https://envoyer.io">Envoyer</a> 这样的替代方案，以便与 Laravel 完成零停机时间部署。</p>
<h2>译者署名</h2>
<table>
<thead><tr>
<th>用户名</th>
<th>头像</th>
<th>职能</th>
<th>签名</th>
</tr></thead>
<tbody>
<tr>
<td><a href="https://learnku.com/users/7636">@痛饮狂歌</a></td>
<td><img class="avatar-66 rm-style" src="https://cdn.learnku.com/uploads/avatars/7636_1500076845.png?imageView2/1/w/100/h/100" alt="100"></td>
<td>翻译</td>
<td>独立开发者，全栈工程师</td>
</tr>
<tr>
<td><a href="https://learnku.com/users/5350">@JokerLinly</a></td>
<td><img class="avatar-66 rm-style" src="https://cdn.learnku.com/uploads/avatars/5350_1481857380.jpg" alt="5350_1481857380.jpg"></td>
<td>Review</td>
<td>Stay Hungry. Stay Foolish.</td>
</tr>
</tbody>
</table>
<hr>
<blockquote>
<p>{note} 欢迎任何形式的转载，但请务必注明出处，尊重他人劳动共创开源社区。</p>
<p>转载请注明：本文档由 Laravel China 社区 <a href="https://laravel-china.org">laravel-china.org</a> 组织翻译，详见 <a href="https://learnku.com/laravel/t/5756/laravel-55-document-translation-call-come-and-join-the-translation">翻译召集帖</a>。</p>
<p>文档永久地址： <a href="https://learnku.com/docs/laravel" target="_blank">《Laravel 中文文档》</a></p>
</blockquote>

                    
                    <p></p>
<div style="position: absolute!important;height: 1px;width: 1px;overflow: hidden;clip: rect(1px,1px,1px,1px);">本文章首发在 <a href="https://learnku.com/">LearnKu.com</a> 网站上。</div>',
    'updated_at' => NULL,
  ),
  10 => 
  array (
    'title' => '撸了快 3 年的 Laravel 了，尽量这周分享本人使用的多台服务器集群部署方案',
    'review' => ' 6665',
    'comment' => ' 44',
    'content' => '<p>1、rsync+sersync自动同步差异化文件<br><a href="https://learnku.com/articles/36210">CentOS7 下使用 rsync+sersync 配置文件自动同步</a><br>
2、docker下安装gogs<br><a href="https://learnku.com/articles/36255">使用 Docker 部署版本控制工具 Gogs</a></p>
<h1>序言</h1>
<p>大家看着图个乐就行，这段纯粹个人吐槽，可直接跳过<br>
本人所在的公司，后端就我一个人，前端一名（原本2名，后来离职1名），设计两名，策划1名。17年进入这家公司，维护公司官网，最初就我一人，18年下半年逐渐增加到6人，队伍也不算小了，本人负责整个后端架构和服务器部署维护。<br>
从15年出来工作到现在，陆陆续续也进过很多公司，最初的毛头小子，技术小白，一步一步成长到现在，技术、经验都有了很大的提升（自我感觉，请勿喷），从一开始的<code>echo "hello world";</code>,到现在的多语言版本<code>hello world</code>，只想说一句话，生命不息，代码不止！</p>
<p>最初的时候用的是<code>tp3.23</code>，干外包，大家都懂，追求效率。干了2年外包后，进入了一家本土稍微大一点论坛，主要做一些小专题，小项目和维护论坛，比之前外包难度稍高，还好有个老技术可以带（干外包的时候前期后端技术都跑了，就我一人，天天加班熬夜干活学习，自己一个人闭门造车），了解了很多项目流程，包括写代码需要注意的事项，代码安全、运行效率，redis队列、应付并发等等。</p>
<p>之后跳槽就进入现在这家公司，主做维护，因为可以学到很多敲代码除外的东西，最初的时候可以跟着领导全国出差，感谢领导，学到了很多很多，为人处世等等。</p>
<h2>框架选型</h2>
<p>刚进来的时候是接手外包做的网站，因为部门战略方向修改，所以整个项目相当于要推倒重来，因为外包用<code>yii2</code>做的，我不是很喜欢这个框架，<code>ci</code>和<code>tp</code>又不合适，遂直接用<code>laravel</code>开撸，前期真的是碰了很多很多壁，一度想放弃，但是还是坚持了下来。</p>
<h2>版本控制</h2>
<p>最初代码使用<code>ftp</code>管理，后来跟换到<code>svn</code>，再到现在的<code>git</code>，自己<code>docker</code>环境下搭建的<code>gogs</code>。服务器也从最初的1台，到现在多台，也部署了一台负载均衡器，同步代码使用<code>git</code>提交触发钩子，然后<code>rsync+sersync</code>监听文件变化，自动同步差异化文件，<code>CDN</code>隐藏服务器真实域名。</p>
<h2>API编写</h2>
<p>接口最初使用<code>laravel + dingo API</code>，到现在的<code>golang</code>的<code>gin</code>重写，爬虫项目也从最初的<code>php</code>的<code>guzzle</code>包到目前的<code>python</code>重写。最终，得到一个结论！就是 <code>想要快速进步，就要靠大量项目喂养</code>！</p>
<h1>目标与现状</h1>
<ul>
<li>目前在的公司较为安逸，主做维护，所以有很多空余时间。荒废时间对于技术人员是最可怕的，我们公司是存在编制的，不犯什么大错误基本可以干一辈子了，担忧技术停滞不前甚至倒退。</li>
<li>公司在三线城市（房价涨幅世界第一，不想吐槽），城市的IT技术相较于北上广深差距太大，自己又买不起房，学历只是大专，自考的远程教育本科又没有含金量，只能不断学习逼迫自身，靠技术去一线城市博得一席之地。</li>
<li>学无止境，百度云存储的内容估计这辈子都学不完了，从前端到后端到服务器到人工智能，内容太多了。经过长时间的思考，暂定以后端技术为主，前端不求精通，能做一些兼职即可，服务器方面目前在研究<code>docker+k8s</code>,公司服务器<code>gogs</code>就是搭建在<code>docker</code>环境下的。接下来深入研究<code>golang</code>，微服务方面。</li>
</ul>
<p>这周看看能不能写服务器部署的一个分享出来，到时候请各位批评指正！</p>
<p>本文将从三个阶段叙述，包含项目的架构、版本工具的选择、代码部署、到安全</p>
<h1>正文</h1>
<h2>第一阶段：刚接手项目</h2>
<p>外包交付之前，是通过<code>ftp</code>的形式上传文件。<br>
交付后到公司战略方向调整后，因为公司业务较多，全国有20多个营业点，每个营业点都有一名前端设计，公司后端只有我一人。前端需要制作页面，供外网访问。</p>
<h3>需要解决的问题：</h3>
<ol>
<li>项目需要重新设计，选择框架？服务器环境如何搭建？</li>
<li>代码安全问题，不希望全国的营业点直接访问到项目源码，如何选型？</li>
<li>全国营业点中有技术较好的前端，如何给与部分网站修改权限？</li>
<li>网站是站群系统，域名需要泛解析，laravel自带的路由文档无法提供解决方案</li>
<li>后台的选型，还有权限等功能的开发</li>
</ol>
<h3>解决方案</h3>
<ol>
<li>因为发现了learnku社区（前身laravel-china.org）,学习了发布的教程，遂选择了laravel。服务器环境使用宝塔面板，定时备份网站和数据库、设置阿里云自动快照。</li>
<li>需要严格控制代码权限，所以选择了svn，创建不同角色，给目录增加对应权限。</li>
<li>借鉴blade模板和织梦的模板标签，开发属于laravel的自定义模板标签。</li>
<li>改写route路由，自己摸索泛解析匹配规则，辅以大量正则判断，不断试错。</li>
<li>后台模板使用<code>ACE</code>，手撸<code>RBAC</code>权限管理，这个实现较为简单，业务逻辑。</li>
</ol>
<h3>不足之处</h3>
<ol>
<li>git比svn更好，但受限于技术，无法搭建。等自身实力达到后肯定要换掉。</li>
<li>对svn功能也不是很了解，区域经常上传大文件，导致项目愈发臃肿。</li>
<li>自写的泛解析站群路由正则太多，文件也较长，不利于后期维护和扩展。</li>
<li>后台功能较少，筛选、统计等新功能开发效率较低。</li>
<li>没有应付高并发的方案、也没有应对网络恶意攻击的解决手段。</li>
</ol>
<p>服务器使用<code>CentOS</code>，采用<code>LNMP</code>，直接用宝塔部署，手动安装<code>svn</code>版本控制工具，通过钩子自动同步代码，svn提交后，线上可以直接看到效果，<code>php+svn</code>就是这么暴力，因为条件受限和技术受限，就没有部署测试环境，所见即所得。</p>
<p>安全方面，laravel自身意见提供了一部分，包括<code>csrf</code>，<code>防SQL注入</code>，<code>端口IP限制</code>，使用阿里云CDN隐藏服务器真实IP等等，都是一些常见的。</p>
<h2>第二阶段</h2>
<p>新项目的使用和内部项目迭代，还有个人经验、技术的提升，此时产生了以下问题：</p>
<h3>需要解决的问题：</h3>
<ol>
<li>不满足于svn的局限，需要选型新的工具。</li>
<li>新项目选型，需要用到队列和定时任务。</li>
<li>服务器访问较大，需要购买多台服务器部署集群。</li>
<li>后台开发耗时较多（因为我们后台功能很多），如何解决？</li>
</ol>
<h3>解决方案</h3>
<ol>
<li>在服务器部署<code>git</code>私有管理器，实现版本控制，<code>svn</code>和<code>git</code>同时存在。</li>
<li>学习laravel课程二，借鉴大佬代码和阅读文档，实现队列和定时任务。</li>
<li>购买阿里云服务器，和负载均衡，使用<code>rsync+sersync</code>监听文件变化，自动同步差异化文件。</li>
<li>使用<code>laravel-admin</code>扩展包，快速生成后台，加上自定义的接口，可以很轻松实现绝大部分业务功能。</li>
</ol>
<h3>不足之处</h3>
<ol>
<li>因为项目人员骤减，只限于办公室的6个人，所以不需要对代码进行权限控制，但总要限制，<code>gitlab</code>可以实现，可惜技术不足，无法满足需求。</li>
<li>服务器部署使用的宝塔面板，方便快捷（全部命令行太麻烦，效率也低），想全部容器化部署，使用<code>k8s</code>，这也是目前能想到的解决方案，受限于技术原因无法实现。下一步学习方向就在此。</li>
<li>网站后台的UI，同事不满意，但自建后台，消耗的成本和时间会很大，目前只能这样。</li>
</ol>
<p>此间碰到过多起安全问题，网站运行受到大量的CC攻击，期间最严重的一次，攻击持续了4天，超过CDN负载，3天访问次数达10亿次以上，QPS峰值5W多，被阿里云CDN拉入沙箱，整个业务完全终止外网访问。</p>
<p>当时可以说人在公司呆了4天，基本天天熬夜到下半夜，受限于技术，通过<code>iftop</code>工具分析流量，只能采取最傻瓜的操作，就是服务器防火墙封锁IP，后因IP太多，直接封锁IP段，但因为对方IP池太深，以失败告终。</p>
<p>服务器方面，<code>opcache</code>缓存开启，<code>php</code>调整进程数，<code>nginx</code>限流开启，数据库增加连接数，数据库读取增加缓存，存入<code>redis</code>，但也只是杯水车薪。</p>
<p>通过不断的查阅资料，给服务器安装了<code>fail2ban</code>，仍然没有解决问题，为此阿里云还专门和我建立了一个钉钉讨论组，他们给的建议就是，花钱上高防服务器，可惜的是因为价格太高，公司领导不允许。不过在不断的分析IP来源中，发现了一个规律，就是流量来源90%以上都是国外的，因此和阿里云技术沟通，看能否帮忙禁国外用户访问，答案是不能。</p>
<p>后来在其他部门同事的帮助下，我们更换了CDN服务提供商，使用百度云CDN，软磨硬泡，拜托百度云技术帮忙封锁国外IP，配合CDN限流和继续封锁IP段，正好在美国的领导通知我国外无法访问网站，流量峰值不断降低至正常状态，此次危机才得以缓解，在次感谢百度云CDN工作人员的帮助。</p>
<p>感谢@MIsakas提供的思路，可以在解析域名的时候把境外线路解析到虚假IP上，具体我还没有试。</p>
<h2>第三阶段</h2>
<p>因为部门方向再次变更，整个服务也需要大概，因为不断阅读社区优秀文章和教程，还有不断的刷github，愈发发现之前代码写的太垃圾，毅然决定重写项目。</p>
<p>正好服务器到期，公司也要更换阿里云账号，所以从购买服务器开始，到网站部署，版本工具的选择等等，算得上截止19年上半年学到的知识都用上了。</p>
<p>首先，服务器安全层面，弃用密码登录，采用<code>ssh</code>秘钥，还有对应一系列的<code>ssh</code>配置，比如超时自动踢出登录，密码隔断自动修改等等，这些阿里云都会提示，对照着修改就好。</p>
<p>因为公司后端就我一个人，所以我是允许root登录的，给端口设置ip限制就可以了。</p>
<h3>服务器</h3>
<p>服务器使用阿里云负载均衡+云ecs</p>
<h3>环境搭建</h3>
<p>环境搭建方面，为了省事，我仍然采用的宝塔面板，限制面板登录端口IP权限。推荐大家linux安装<code>htop</code>，友好性互动的进程查看器，比<code>top</code>命令好用多了。</p>
<h3>版本控制</h3>
<p>代码版本控制，安装<code>docker</code>，使用<code>gogs</code>进行版本控制。因公司业务是所见即所得的，所以不需要测试环境，线下修改直接push推送，触发<code>post-receive</code>钩子，自动同步线上代码。如果条件允许的话肯定要配置测试环境的，而且<code>git</code>分支也要严格控制权限，<code>master</code>分支只允许核心人员推送，合并分支也是。修改bug可以使用<code>dev</code>分支，<code>gogs</code>的web界面也需要设置IP访问权限。</p>
<h3>代码同步</h3>
<p>代码同步方面，仍然使用<code>rsync+sersync</code>，目前受于技术限制，没有发现其他更方便的同步方式</p>
<h3>数据库</h3>
<p>数据库用的<code>mysql8+</code>，多台服务器之间以内网通信，设置独立的账号，分配权限指定数据库名。为了方便，管理员账户对外也指定了IP，数据库对外端口也限制了IP。需要注意的是mysql8.0以上修改了密码加密方式，连接不上的需要新建用户或更换版本。</p>
<h3>后台开发</h3>
<p>使用<a href="https://github.com/z-song/laravel-admin">laravel-admin</a>包，功能很强大，为作者点赞。绝大部分需求的功能都有，加上自定义的接口，可以满足日常后台开发的绝大部分需求。</p>
<h3>缓存服务</h3>
<p>数据缓存使用redis，一样的需要限制IP访问。需要注意的是，redis内网之间访问，IP设置不是127.0.0.1，而是对应的内网IP。至于<code>mysql</code>的优化，社区一堆文章，我这里不做赘述。</p>
<h3>图片等大文件存储</h3>
<p>图片等大文件存储到七牛云或者阿里云OSS，技术达到的话可以自行搭建图片服务器，记得使用<code>https</code>协议</p>
<h3>使用cdn为网站加速</h3>
<p>网站使用<code>cdn</code>加速，隐藏真实IP，否则一旦暴露，<code>ddos</code>攻击小公司根本扛不住。</p>
<p>以上限制端口都可以通过<code>linux</code>防火墙进行设置。</p>
<p>如果并发压力过高，记得开启php的<code>opcache</code>，业务需要的话可以使用<code>swoole</code>。<code>PHP-FPM</code>运行模式可以切换为动态，计算好<code>php</code>的连接数。</p>
<p>上线项目前可以用<code>apache</code>的<code>ab</code>命令进行压测，还可以使用第三方测试工具，比如<code>JMeter</code>等进行压测，详情见<a href="https://learnku.com/courses/ecommerce-advance/6.x/stress-testing-part-one/5886">L06 Laravel 教程 - 电商进阶 ( Laravel 5.8 )</a>。</p>
<h3>使用supervisor托管队列</h3>
<p>队列使用<code>python</code>编写的<code>supervisor</code>进行管理，还可以使用<code>Horizon</code>队列管理工具，记得控制好权限</p>
<p><code>docker</code>环境搭建<code>gogs</code>和<code>rsync+sersync</code>，我会分两篇文章，本周六写好发布。</p>
<h3>API开发</h3>
<p>API接口前期使用的是<code>dingoAPI</code>，后来使用<code>golang</code>的<code>gin</code>框架重写了，最近看<code>laravel6.x</code>自带的<code>Resource</code>，觉得可以不用<code>dingoAPI</code>了。</p>
<p>至于为什么使用<code>golang</code>，因为个人很喜欢<code>go</code>。我写过<code>python</code>，<code>php</code>，都是解释性语言，想换一门编译型的，<code>c++</code>怕短时间入不了门，<code>java</code>又太重，所以选择了<code>go</code>。这里吐槽一下，<code>php</code>的数组比<code>go</code>的map方便了N倍。<br>
感谢@下水道里有只猫，golang带我入门，我是看了他的博客源码才能下手重写项目的。</p>
<h2>建议</h2>
<p>最近学习了<code>laradock</code>，发现是真的好用，docker-compose都配置好了，启动的时候选择对应镜像，方便快捷，一件试部署。<br><img src="https://cdn.learnku.com/uploads/images/201911/08/21295/fIQHqBJv8N.png!large" alt="撸了快 3 年的 Laravel 了，尽量这周分享本人使用的多台服务器集群部署方案"></p>
<p>不过有个坑，就是我习惯直接批量重启容器，导致<code>nginx</code>容器连不上<code>php</code>容器</p>
<pre><code class=" language-php">#我要运行2次，因为容器启动顺序冲突，还经常php容器连不上nginx
docker start $(docker ps -a | awk \'{print $1}\' | tail -n +2)</code></pre>
<p>最好在<code>laradock</code>目录下执行</p>
<pre><code class=" language-php"># 例：docker-compose up -d nginx mysql redis workspace php-worker
docker-compose -d up 容器1 容器2 容器3 ...</code></pre>
<h1>后期学习计划</h1>
<p>至于后期的学习计划，重心在容器化，<code>docker+k8s</code>，还有<code>go</code>的微服务方向。最近对数学起了兴趣，准备明年买几本高数书学习一下🤣。还有明年准备复习英语，这样就可以参与社区的翻译工作了。可惜自己基于ss协议搭建的梯子被封了，只能用电脑查阅文档了。</p>
<blockquote>
<p>生命不息，代码不止</p>
</blockquote>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/fivenull/tags/laravel_58">laravel</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/fivenull/tags/server-deployment_51991">服务器部署</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/fivenull/tags/docker_355">docker</a>
    </div>',
    'created_at' => '2019-11-05 16:28:52',
    'updated_at' => '2019-11-05 16:28:52',
  ),
  11 => 
  array (
    'title' => '[扩展推荐] Laravue —— 漂亮的 Laravel 管理界面',
    'review' => ' 2754',
    'comment' => ' 19',
    'content' => '<h3>介绍</h3>
<p>几个月前我尝试为我的项目寻找新的解决方案, 我已经使用 Vue  构建了一个 单页应用 (使用这个 <a href="https://github.com/PanJiaChen/vue-element-admin">非常棒的框架</a>, 使用 Laravel <a href="https://lumen.laravel.com/">Lumen</a> 作为 API 网关, 使用 Laravel <a href="https://learnku.com/docs/laravel/5.7/passport">Passport</a> 作为 SSO 服务器)。经过几周的工作, 我发现那个框架有一些限制, 尤其是在部署和难以开源方面 (因为涉及许多组件, CORS 设置 ...)。突然有一天我有了一个新的想法:</p>
<blockquote>
<p>为什么我们不用 Laravel 内置的 VueJS 去构建 SPA 仪表板?</p>
</blockquote>
<p>Laravel + VueJS = <a href="https://github.com/tuandm/laravue">Laravue</a></p>
<p>例子: <a href="https://laravue.dev/">https://laravue.dev</a>\\<br>
文档: <a href="https://doc.laravue.dev/">https://doc.laravue.dev</a></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/01/1/uS28pswB0f.png!large" alt="Laravue"></p>
<p><a href="https://github.com/tuandm/laravue">Laravue</a> 是一个受 <a href="https://github.com/PanJiaChen/vue-element-admin">vue-element-admin</a> 启发的漂亮的仪表盘。它提供了所有构建企业应用所必须的组件, 管理员可以控制业务并管理其他人。 我的计划是将 Laravel/Vue 最新的 技术/库/组件 应用于该项目, 并且易于使用. 在这个示例中, API 由 Laravel 提供, 大多数 API 都是假的 - 但是易于实现。</p>
<h3>开始</h3>
<pre><code class=" language-php"># 使用 composer 克隆项目
composer create-project tuandm/laravue
cd laravue

# 迁移数据 (在 .env 文件设置了数据库信息之后)
php artisan migrate --seed

# 生成 JWT 秘钥
php artisan jwt:secret

# 安装依赖
yarn install

# 构建(开发环境)
yarn run dev # 或者 yarn run watch

# 启动本地服务
php artisan serve
</code></pre>
<h3>下一步</h3>
<ul>
<li>
<p>这个项目正在大力开发中, 还没有被构建为 Laravel 插件(应该是这样)。下一步将会将此项目构建为一个独立的 Laravel 插件, 使得现有的 Laravel 网站可以很好的集成。</p>
</li>
<li>
<p>提供完善的文档和严格的代码规范。PHP/Laravel 有优秀的代码规范 <a href="https://www.php-fig.org/psr/">PSR</a> , VueJS 也有很好的标准 <a href="https://vuejs.org/v2/style-guide/">这里</a> 但这太基础了, 还不够。</p>
</li>
<li>
<p>完善的测试。</p>
</li>
</ul>
<blockquote style="font-size: 0.9em;border: 1px dashed #dce0e4;border-radius: 5px;padding: 13px 25px;">
                                <p style="margin-bottom: 0px;">原文地址：<a href="https://dev.to/tuandm/laravel--vuejs--laravue---a-beautiful-dashboard-for-laravel-3h11">https://dev.to/tuandm/laravel--vuejs--la...</a></p>
                                <p>译文地址：<a href="https://learnku.com/laravel/t/37417">https://learnku.com/laravel/t/37417</a></p>
                            </blockquote>',
    'created_at' => '2019-12-01 10:28:42',
    'updated_at' => '2019-12-01 10:28:42',
  ),
  12 => 
  array (
    'title' => '找接触过 line pay 开发的哦',
    'review' => ' 75',
    'comment' => ' 1',
    'content' => '<p>VX:w1nx1n168<br>
把前面两个1换成i  </p>
<p>xD</p>',
    'created_at' => '2019-12-14 12:59:54',
    'updated_at' => '2019-12-14 13:00:53',
  ),
  13 => 
  array (
    'title' => 'App_key 问题',
    'review' => ' 87',
    'comment' => ' 3',
    'content' => '<p>laravel 5.3版本在新的centos系统上报错<br><img src="https://cdn.learnku.com/uploads/images/201912/14/53681/QQNIF6VFrc.png!large" alt="app_key 问题"><br>
用php artisan config:clear  清除了，也用php artisan key:generate 重新生成了还是不好使，还有其他的办法么，谢谢啦</p>',
    'created_at' => '2019-12-14 14:02:11',
    'updated_at' => NULL,
  ),
  14 => 
  array (
    'title' => '关于 dingoApi 中，获取当前已登录用户的信息的疑问',
    'review' => ' 133',
    'comment' => ' 2',
    'content' => '<p>在用户认证中，可以通过auth（）-&gt;user(),获取到当前的用户信息<br><img src="https://cdn.learnku.com/uploads/images/201912/13/22871/UAbS6NdqnR.png!large" alt="关于dingoApi中，获取当前已登录用户的信息的疑问"><br>
然后我翻到了另一个项目，结果发现那个项目都是通过$this-&gt;user()获取到的当前已登录的信息，</p>
<p>所以想问问看，什么时候才能使用$this-&gt;user()呢？<br>
我对比了两个项目，发现model的代码基本一致（指引用），controller的引用也没有特殊之处。api路由也是保持一致的，所以有点很不理解，为什么差不多的代码，使用起来却不一致呢？<br>
都是laravel5.8  都是dingoAPi</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/laravel/58">laravel</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/dingoapi/33948">dingoapi</a>
    </div>',
    'created_at' => '2019-12-13 18:14:12',
    'updated_at' => NULL,
  ),
  15 => 
  array (
    'title' => '[求职] 昆明 1年 PHP，求点化',
    'review' => ' 1389',
    'comment' => ' 17',
    'content' => '<p>传送门-&gt;<strong>ThinkPHP框架</strong>(<a href="http://www.thinkphp.cn/topic/66993.html" target="_blank">http://www.thinkphp.cn/topic/66993.html</a>)</p>
<h3>个人资料</h3>
<table>
<thead><tr>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
</tr></thead>
<tbody>
<tr>
<td>姓名</td>
<td>发子</td>
<td>邮箱</td>
<td>zhaofa2014@hotmil.com</td>
</tr>
<tr>
<td>学历</td>
<td>大专</td>
<td>年龄</td>
<td>25</td>
</tr>
<tr>
<td>英语水平</td>
<td>B级</td>
<td>教育背景</td>
<td>昆明冶金高等专科学校</td>
</tr>
</tbody>
</table>
<h3>工作经历</h3>
<p>2019年1月-2019年5月昆明云涛科技有限公司|独立完成<br>
在运行<br><a href="https://www.yuntaos.com" target="_blank">https://www.yuntaos.com</a><br>
小程序:云涛科技<br>
网站加密用来https协议后台用了行云海cms加速用了cdn排名靠前<br>
开展相关百度推广企业站制作一整套<br><br>
2019年5月-2019年11月昆明三一一医 院|程序员|独立完成<br>
在运行<br><a href="http://sg5g.311wgk.com/yygh" target="_blank">http://sg5g.311wgk.com/yygh</a><br>
在运行 预约系统<br><a href="https://yyghw.311ebh.com/" target="_blank">https://yyghw.311ebh.com/</a><br>
医院业务.上升30%<br><br>
自学thinkPHP;larave l框架 mysql 数据库和k8s<br>
k8s集群<br><a href="http://k8s.zhaofa.love" target="_blank">http://k8s.zhaofa.love</a>                                        账号<strong>****</strong>密码<strong>****</strong><br>
自学项目宝塔镜像地址<br><a href="http://bt.zhaofa.love" target="_blank">http://bt.zhaofa.love</a>                                           账号<strong>****</strong>密码<strong>****</strong><br>
代码仓库<br><a href="https://gitee.com/zhaofafa/projects" target="_blank">https://gitee.com/zhaofafa/projects</a><br><a href="https://github.com/zhaofa2014" target="_blank">https://github.com/zhaofa2014</a><br>
镜像仓库<br><a href="https://hub.docker.com/u/1872220587" target="_blank">https://hub.docker.com/u/1872220587</a><br><br>
兴趣是最好的老师<br>
永久镜像：1872220587/bt:centos7.6.1810..Bt7.0.12..tp5.1..v1.1..Study<br><a href="http://laravel.zhaofa.love">laravel学习:    laravel.zhaofa.love</a><br><a href="http://tp5.zhaofa.love">thinkPHP5.1学习:    tp5.zhaofa.love</a><br><a href="http://tp6.zhaofa.love">thinkPHP6.0学习:    tp6.zhaofa.love</a><br><a href="http://web.zhaofa.love">前端学习:    web.zhaofa.love</a><br><a href="http://mysql.zhaofa.love">数据库学习:   mysql.zhaofa.love</a><br><a href="http://zhaofa.love">2018.4.10|永久快照|第一次接触这一行，兴趣是最好的老师：zhaofa.love</a><br></p>
<h3>技术栈</h3>
<ul>
<li>laravel6.0</li>
<li>thinkPHP5.1</li>
<li>thinkPHP6.0</li>
<li>mysql</li>
<li>k8s</li>
<li>
<h4>PHP ：</h4>
</li>
<li>对现有流行框架底层较为了解，能够理解框架整体流程，例如 Laravel 中依赖注入、生命周期等</li>
</ul>
<h4>Linux :</h4>

<ul>
<li>
<p>能够编译安装服务器 Nginx、MySQL、PHP、Redis 等软件，并编写对应 service 文件</p>
</li>
<li>
<p>会玩k8s 集群   各个项目环境搭建、优化，搭建内部 Gitlab 系统、CI/CD简单配置</p>
</li>
<li>
<p>掌握基本 shell 语法</p>
</li>
<li>
<p>能够合理规划服务器目录、MySQL 调优、Nginx 调优等<br></p>
<h4>其他</h4>

</li>
<li>
<p>了解域名解析流程、域名 https 配置、CDN 使用</p>
</li>
<li>
<p>了解 AWS、阿里云、腾讯云 等云服务器的功能选型<br></p>
<h3>联系方式</h3>
<p><br>
微信：18887142223<br>
QQ：1872220587 1655592531 1844480921<br>
facebook:18887142223<br>
新浪微博:<a href="https://weibo.com/5504212058/profile?rightmod=1&amp;wvr=6&amp;mod=personnumber" target="_blank">https://weibo.com/5504212058/profile?right...</a></p>
<h3>个人介绍</h3>
<p><img src="http://laravel.zhaofa.love/%E7%AE%80%E5%8E%861.jpg" alt=""></p>
</li>
</ul>',
    'created_at' => '2019-12-09 21:39:56',
    'updated_at' => '2019-12-12 19:05:04',
  ),
  16 => 
  array (
    'title' => '使用 XDebug + Webgrind 进行 PHP 程序性能分析',
    'review' => ' 77',
    'comment' => ' 0',
    'content' => '<h2>准备</h2>
<ul>
<li><a href="https://gleehub.com/program/an-zhuang-xdebug-kuo-zhan.html">安装 XDebug 扩展</a></li>
<li>开启 <code>Profiler</code> 性能跟踪器
<pre><code class="language-ini">;php.ini
xdebug.profiler_enable = 1
xdebug.profiler_enable_trigger = 1</code></pre>
</li>
<li>下载 <a href="https://github.com/jokkedk/webgrind">Webgrind</a>
</li>
</ul>
<h2>Webgrind</h2>
<p>
因为 <code>Profiler</code> 生成的性能记录文件的格式，不是给人看的，所以需要 <code>Webgrind</code> 图形界面的分析工具
</p>

<p>:: tip<br>
Webgrind 本质上是一个 PHP 网站程序</p>
<p>
::
</p>

<h2>使用</h2>
<p>在需要分析的 Url 后面接上 <code>?XDEBUG_PROFILE</code>，例如：<code>http://localhost:8000/?XDEBUG_PROFILE</code></p>
<p>然后刷新 Webgrind 网页，最新的数据就会显示</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/14/22732/A4ug3nAkBk.png!large" alt="图片"></p>
<h2>选项</h2>
<h3>Show 90%</h3>
<p>所有被调用的函数和方法由高到低排序，然后取出耗时比率之和在 90%~100% 之间的前 N 个</p>
<h3>of Auto（newest）</h3>
<p>选择生成的 Profiler 文件，默认是最新一次的 XDebug 分析记录</p>
<h3>in percent</h3>
<p>显示百分比、毫秒或微秒</p>
<h3>四色胶囊条</h3>
<ul>
<li>蓝色：PHP 内置函数</li>
<li>灰色：require/include</li>
<li>绿色：方法</li>
<li>橙色：自定义函数</li>
</ul>
<h3>Invocation count</h3>
<p>表示整个 PHP 页面从载入到执行完毕，函数被调用的总次数</p>
<h3>Total Self Cost</h3>
<p>表示自身从开始到执行完毕所用消耗（不包括其他函数消耗）</p>
<h3>Total Inclusive Cost</h3>
<p>表示自身从开始到执行完毕所用消耗（包括其他函数消耗）</p>
<h3>Calls</h3>
<p>表示自身调用并执行的所有函数/方法名、次数及耗时</p>
<h3>Total Call Cost</h3>
<p>表示被调用执行的总耗时</p>
<h3>Count</h3>
<p>表示被调用执行的次数</p>
<h2>总结</h2>
<p>对公司现后台分析，果然，最耗时的还是数据库部分</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/cnguu/tags/xdebug_1950">Xdebug</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/cnguu/tags/php_28">php</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/cnguu/tags/webgrind_26245">webgrind</a>
    </div>
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <div style="text-align:center;"><a href="https://gleehub.com">我的博客小站</a></div>
<p><img src="https://static.xmt.cn/e3fb719b78a6495ebccc0cf4ddeabf58.png" alt="爱护牙齿"></p>
                                </span>
                            </div>',
    'created_at' => '2019-12-14 13:16:42',
    'updated_at' => '2019-12-14 13:16:42',
  ),
  17 => 
  array (
    'title' => '怎么单独使用 Bootstrap 和 Sass 呢？',
    'review' => ' 785',
    'comment' => ' 4',
    'content' => '<p>比如我现在只需要写前端，然后我想配合bootstrap和sass，要怎么做呢？</p>',
    'created_at' => '2019-12-07 22:20:39',
    'updated_at' => NULL,
  ),
  18 => 
  array (
    'title' => 'PHP7.4 Preload 性能测试',
    'review' => ' 1058',
    'comment' => ' 10',
    'content' => '<h1>PHP7.4 Preload 功能测试</h1>
<blockquote>
<p>PHP7.4已经发布，发布了很多新特性，其中有一项功能比较吸引人，那就是预加载功能，可以将文件提前加载到内存当中，据说可以提升PHP性能，但是究竟是不是能提升，能提升多少，我们可以做一个实验来测试下。</p>
</blockquote>
<pre><code class=" language-php"> 先上github地址     https://github.com/linkkong/php7.4-preload-test</code></pre>
<h2>思路</h2>
<blockquote>
<p>预加载的原理就是将类提前加载到内存中，这种提升在fpm场景下最适合，所以笔者做了以下几个角度的测试。</p>
<ol>
<li>速度测试：比较php7.4预加载、php7.4无预加载、php7.3三种环境下，同一份文件访问的表现</li>
<li>空间测试：也就是上面三种环境下内存使用情况</li>
<li>CPU使用的情况可以忽略，因为下面的测试使用了docker，已经将cpu使用率降低到了25%</li>
</ol>
</blockquote>
<h2>工具</h2>
<ol>
<li>
<p>php项目：</p>
<p>1) 在www目录下面，默认访问的是index.php文件，里面引用了www/Dog目录下的三个文件(增加文件读取操作);<br>
2) 为了验证预加载确实读取类到了内存中，增加了dog类</p>
</li>
<li>
<p>使用docker-compose编排了三个php环境分别是php7.4预编译、php7.4普通、php7.3普通</p>
<pre><code class=" language-php">  php74:
    image: php:7.4-fpm
    volumes:
      - ./www/:/var/www/html/:cached
      - ./php/preload.ini:/usr/local/etc/php/conf.d/preload.ini
    expose:
      - 9000
    deploy:
      resources:
        limits:
          cpus: \'0.25\'
          memory: 150M
  php741:
    image: php:7.4-fpm
    volumes:
      - ./www/:/var/www/html/:cached
    expose:
      - 9000
    deploy:
      resources:
        limits:
          cpus: \'0.25\'
          memory: 150M
  php73:
    image: php:7.3.9-fpm
    volumes:
      - ./www/:/var/www/html/:cached
    expose:
      - 9000
    deploy:
      resources:
        limits:
          cpus: \'0.25\'
          memory: 150M</code></pre>
<p>预加载比普通多了一个预加载的配置文件，把www/Dog里的文件进行了opcache_compile_file</p>
<p>参考php/preload.ini和www/preload.php</p>
</li>
<li>
<p>增加nginx配置，参考nginx/conf.d/default.conf</p>
<table>
<thead><tr>
<th>环境</th>
<th>Host</th>
</tr></thead>
<tbody>
<tr>
<td>php7.4预加载</td>
<td><a href="http://localhost:8000/" target="_blank">http://localhost:8000/</a></td>
</tr>
<tr>
<td>php7.4无加载</td>
<td><a href="http://localhost:8001/" target="_blank">http://localhost:8001/</a></td>
</tr>
<tr>
<td>php7.3普通</td>
<td><a href="http://localhost:8002/" target="_blank">http://localhost:8002/</a></td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2>测试</h2>
<blockquote>
<p>打开2个窗口，分别执行下面的命令，不要关闭</p>
</blockquote>
<pre><code class=" language-php">      //监控docker容器的cpu使用和内存使用
      docker stats --format "table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}"

      //启动所有容器，必须使用--compatibility参数，否则CPU内存限制无效
      docker-compose --compatibility up
</code></pre>
<p>运行起环境后可以看到，php74_1是预加载环境，php741_1是无预加载环境，php73_1是php7.3环境，php7.4预加载环境已经比无预加载环境多使用了0.08Mib内存，至于是不是已经预加载了类，还不能下结论<br><img src="https://cdn.learnku.com/uploads/images/201912/11/31012/C092cGg7GK.png!large" alt="PHP7.4 Preload 性能测试"><br>
下面采用ab来进行简单的压测，并用每秒请求数来进行对比</p>
<pre><code class=" language-php">      ab -c 10 -n 1000 http://localhost:8000/</code></pre>
<h3>测试index.php</h3>
<blockquote>
<p>测试7.4预加载、7.4无预加载、7.3三种环境的表现</p>
</blockquote>
<table>
<thead><tr>
<th>环境和地址</th>
<th>第1次</th>
<th>第2次</th>
<th>第3次</th>
<th>第4次</th>
<th>第5次</th>
</tr></thead>
<tbody>
<tr>
<td>7.4预加载；<a href="http://localhost:8000/" target="_blank">http://localhost:8000/</a>
</td>
<td>268</td>
<td>367</td>
<td>410</td>
<td>345</td>
<td>359</td>
</tr>
<tr>
<td>7.4无预加载；<a href="http://localhost:8001/" target="_blank">http://localhost:8001/</a>
</td>
<td>153</td>
<td>180</td>
<td>160</td>
<td>137</td>
<td>190</td>
</tr>
<tr>
<td>7.3；<a href="http://localhost:8002/" target="_blank">http://localhost:8002/</a>
</td>
<td>154</td>
<td>110</td>
<td>126</td>
<td>134</td>
<td>131</td>
</tr>
</tbody>
</table>
<h3>测试dog.php</h3>
<blockquote>
<p>dog.php包含了Dog文件夹下的内容，主要测试dog类，是否已经在内存中。用curl访问即可，或者浏览器打开</p>
</blockquote>
<table>
<thead><tr>
<th>环境和地址</th>
<th>运行结果</th>
</tr></thead>
<tbody>
<tr>
<td>7.4预加载；<a href="http://localhost:8000/dog.php" target="_blank">http://localhost:8000/dog.php</a>
</td>
<td>Cannot declare interface AnimalInterface, because the name is already in use in <b>/var/www/html/dog.php</b>
</td>
</tr>
<tr>
<td>7.4无预加载；<a href="http://localhost:8001/dog.php" target="_blank">http://localhost:8001/dog.php</a>
</td>
<td>It is runningWang! Wang!</td>
</tr>
<tr>
<td>7.3；<a href="http://localhost:8002/dog.php" target="_blank">http://localhost:8002/dog.php</a>
</td>
<td>It is runningWang! Wang!</td>
</tr>
</tbody>
</table>
<h3>测试cat.php</h3>
<blockquote>
<p>cat.php包含cat类，就是将dog类改了下名字全部放到了cat.php文件中，减少文件读写；主要测试在文件读写次数一致的情况下程序的表现</p>
</blockquote>
<table>
<thead><tr>
<th>环境和地址</th>
<th>第1次</th>
<th>第2次</th>
<th>第3次</th>
<th>第4次</th>
<th>第5次</th>
</tr></thead>
<tbody>
<tr>
<td>7.4预加载；<a href="http://localhost:8000/cat.php" target="_blank">http://localhost:8000/cat.php</a>
</td>
<td>334</td>
<td>305</td>
<td>337</td>
<td>395</td>
<td>366</td>
</tr>
<tr>
<td>7.4无预加载；<a href="http://localhost:8001/cat.php" target="_blank">http://localhost:8001/cat.php</a>
</td>
<td>282</td>
<td>201</td>
<td>221</td>
<td>213</td>
<td>269</td>
</tr>
<tr>
<td>7.3；<a href="http://localhost:8002/cat.php" target="_blank">http://localhost:8002/cat.php</a>
</td>
<td>219</td>
<td>247</td>
<td>216</td>
<td>295</td>
<td>254</td>
</tr>
</tbody>
</table>
<h2>总结</h2>
<ol>
<li>php7.4开启预加载，性能确实提升了很多，原因就是大幅度减少了文件读取的时间</li>
<li>未开启预加载的情况下，php7.3和php7.4性能差距不大</li>
<li>php7.4开启了预加载后，但是并没有预加载特定文件(Cat类)性能居然也有提升，原因还不得而知???</li>
<li>从第二个测试来看php7.4开启预加载之后，类确实加载到了内存中，这就是提升效率的关键，但是在实际项目中，这个特性可能会因为不熟悉特性重复定义类导致项目报错挂掉(潜在的风险)</li>
<li>没有做关于laravel的测试，因为不想做了，原理差不多</li>
<li>在实际应用中，应该对经常使用的类进行热加载，而不要全部加载，参考下面第二个文献</li>
</ol>
<hr>
<h2>最终还是做了Laravel的测试，见图</h2>
<blockquote>
<p>laravel项目是6.5版本，只修改了route/web.php，把默认返回值改成了一个json，其他均未修改</p>
</blockquote>
<p>貌似php7.4只要开启preload，不需要配置preload文件也能加快访问速度(原理未知，可能是自动缓存了，如果是自动缓存，那么后期更新项目就需要重启fpm，不然会有问题)，所以我在www目录下面放入了一个laravel项目，然后用ab 进行了压测，压测结果特别低是因为对容器的CPU和内存做了限制。</p>
<p>从2，3图来看，没有开启preload的php7.4与php7.3性能相差无几，但是开启了preload的php7.4，提升还是很明显的，降低了非常多的文件读取性能消耗</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/31012/obDKSkNARD.png!large" alt="PHP7.4 Preload 性能测试"></p>
<hr>
<h2>Laravel第二次测试</h2>
<blockquote>
<p>经过韩天峰大佬指正，php7.3和php7.4也应该同时开启opcache，上面的实验提升很大其实是opcache的功劳。</p>
</blockquote>
<p><img src="https://cdn.learnku.com/uploads/images/201912/12/31012/dDZyyEixMe.png!large" alt="PHP7.4 Preload 性能测试"></p>
<p>对laravel的vendor/laravel文件进行了preload，再次做了实验，得到如上的数据，相比较两个php7.4是否开启preload还是有差距的，但是php7.3+opcache的实验数据居然跟php7.4+preload性能接近，这个还有点想不通，需要进一步测试。也可能是laravel框架和php7.4并不适配，亦或是opcache开启的参数没有调优；</p>
<h3>存在的问题</h3>
<ol>
<li>php7.3+opcache的实验数据居然跟php7.4+preload性能接近</li>
</ol>
<h3>可以改进的地方</h3>
<ol>
<li>fpm容器没有调优，没有设置fpm连接数等</li>
<li>opcache参数没有调优，只有 opcache.enable = 1;opcache.enable_cli = 1</li>
<li>没有测试数据库链接等场景，也没有评测其他框架</li>
</ol>
<h3>最后</h3>
<p>php7.4开启preload的性能依据官方评测，提升在10%左右，其实并不是很大了，相对开启opcache，收益较小，而且还跟缓存的文件有关。所以这个实验也证明了，php7以上的版本，请务必开启opcache，因为带来的提升真的很大。</p>
<h2>参考文献</h2>
<ol>
<li><a href="https://medium.com/swlh/composer-how-it-should-preload-in-php-7-4-3f8d19fda40">Composer: How it should preload in PHP 7.4</a></li>
<li><a href="https://github.com/composer/composer/issues/7777#issuecomment-440268416">国外同行做的测试，可能是基于laravel</a></li>
<li><a href="https://stitcher.io/blog/preloading-in-php-74">Preloading in PHP 7.4</a></li>
<li><a href="https://blog.yowko.com/docker-compose-3-cpu-memory-limit/">在 Docker Compose file 3 下限制 CPU 與 Memory</a></li>
</ol>
<div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/Lingkong/tags/php_28">php</a>
    </div>',
    'created_at' => '2019-12-11 17:14:37',
    'updated_at' => '2019-12-11 17:14:37',
  ),
  19 => 
  array (
    'title' => '老死机带你用 PHP 实现数据结构之二叉树',
    'review' => ' 454',
    'comment' => ' 4',
    'content' => '<h2>目的</h2>
<p>根据我在这段时间的观察，很多人不懂一些基本的数据结构，所以今天在这里，我不准备讲Laravel的相关知识，而是来一点儿数据结构知识的科普：<strong>二叉树</strong>。代码我已经上传到了码云<a href="https://gitee.com/obamajs/php-tree">php-tree</a>，希望大家能够下载下来。下面的讲解都是根据代码来的，仔细阅读。代码可能不是那么容易理解，没关系，我在这篇博文的后面会给大家仔细的讲解。</p>
<h2>二叉树的起源</h2>
<p>关于到底是谁发明了二叉树，已经无从得知了，反正历史十分悠久，之所以二叉树会存在，是为了解决线性搜索耗费时间的问题，但是因为二叉树的极端情况（有可能演变为链表），所以二叉树在生产环境下基本没有使用，但是二叉树衍生除了许多其它的变种，比如 红黑树（Red-Black-Tree）， 红黑树的应用无处不在（操作系统，标准库等等），但是要想理解这些变种，基本的二叉树原理，你是必须要知道的。</p>
<h2>二叉树的定义</h2>
<p>二叉树的定义很简单，如下：</p>
<ol>
<li>每一个节点，有且最多只有2个子节点。</li>
<li>每一个节点的左子节点的值小于当前节点的值，当前节点的值小于右子节点的值。</li>
</ol>
<p>定义很简单，没错，就是这么简单，希望大家记住。</p>
<h2>二叉树的操作</h2>
<p>今天我要讲的是二叉树的插入和删除操作，因为这是它的核心操作，请大家仔细理解。</p>
<h2>代码结构</h2>
<p>博文的开头，我已经给出了代码的地址，下载是必须的，代码结构如下所示：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/6vhuh9fCZM.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/k3Mjib6ElN.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>每个文件的作用我已经给大家标出来了，这里我还要给大家简要的介绍一下没各类的基本属性。</p>
<p>二叉树的每一个节点都是Node类，这个类很简单，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/AqsL2OalVl.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>各个属性的含义，我都给大家标出来了，就不再说了，NodeComparator是一个接口，所有的<strong>结点比较器</strong>（如果比较两个结点的大小）都应该实现NodeComparator结构，NodeComparator接口定义如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/j3xv6PhMxF.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>最后是BinaryTree类了，这个类有点儿复杂，其它的操作在本篇博文的后面，我们在这里只看它的基础属性：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/skxzRjVyKp.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>关于如何实现自己的结点比较器，我在test.php文件中有给大家演示，下面我贴出来：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/o3g142mtg3.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>上面简要的介绍了基本类的一些作用，下面开始深入二叉树的插入和删除操作。</p>
<h2>二叉树的插入</h2>
<p>在阅读下面的代码前，我希望，你已经理解了二叉树的定义，废话不多说。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/4Bbwbkx5Il.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>因为插入操作不是那么复杂，所以这里直接贴出了所有的代码，<br>
Node::create方法创建了一个Node类的对象，首先判断根节点root_node是否为空，如果为空的话，那么直接设置根节点就可以了，如果不为空的话，那么就需要从根节点遍历整棵树，这里提醒大家，记住二叉树的定义，这里所有的一切都是以这个为依据，BinaryTree的compare方法用于比较2个Node节点的大小，实现如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/8kU23ldRFu.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>这个很简单，不多说，compare方法比较当前结点node和将要插入的结点new_node的大小值，如果node的值大于new_node的值，也就是说new_node会插入到node的左子树中，此时我们判断node是否存在左子节点，判断方法就是node-&gt;getLeftNode方法，如果存在的话，我们直接把左子节点赋值给node变量，这样下次迭代就是以左子节点为判断依据，也就是说下次迭代的时候，node就是当前迭代node的左子节点，如果不存在的话，那么也就是说new_node直接插入作为node节点的左子树。如果当前节点小于new_node的值的话，也就是说new_node会插入到当前迭代节点的右子树中，这里首先判断，当前节点的右子节点是否存在，如果不存在的话，new_node节点直接作为它的当前node节点的右子节点即可，如果存在的话，那么我们就需要继续迭代整棵二叉树，只不过下次迭代的node节点为当前node节点的右子节点，如此反复，直到找到满足条件的节点。</p>
<h2>二叉树的删除</h2>
<p>不管是二叉树，还是它的衍生树，删除操作都是极其麻烦的，因为情况实在是太多了，下面我们一一分析：</p>
<p>删除操作位于BinaryTree的delete方法中，如下:</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/TqUxFsjy9Z.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>在分析代码之前，我先给大家分析删除的所有情况：</p>
<p>A. <strong>二叉树为空，那么删除操作，就直接执行完毕了</strong>。</p>
<p><strong>B. 被删除的节点没有子节点，也就是下图所展示的情况</strong>：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/sXv1NGMlRW.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>如果一个节点没有子节点，那么这个节点要么是根节点，要么是叶子节点，分别如上图所示的情况1和情况2，这种情况很简单。</p>
<p><strong>C.被删除的节点有且只有一个子节点，此时的所有情况如下所示</strong>：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/Wgs3DuVYWF.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<ol>
<li>情况3：被删除的节点是根节点，并且它的左子节点是存在的。</li>
<li>情况4：被删除节点是根节点，并且它的右子节点是存在。</li>
<li>情况5：被删除结点不是根节点，并且它的左子节点是存在的，同时被删除节点是它父节点的右子节点。</li>
<li>情况6：被删除结点不是根节点，并且它的左子节点是存在的，同时被删除节点是它父节点的左子节点。</li>
<li>情况7：被删除结点不是根节点，并且它的右子节点是存在的，同时被删除节点是它父节点的左子节点。</li>
<li>情况8：被删除结点不是根节点，并且它的右子节点是存在的，同时被删除节点是它父节点的右子节点。</li>
</ol>
<p><strong>D：被删除结点有2个子节点，此时，情况有点儿复杂，如下：</strong></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/0aYgqANXDQ.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<ol>
<li>情况9：被删除节点是根节点，并且被删除节点的右子节点没有左子节点。</li>
<li>情况10：被删除节点不是根节点，并且被删除节点是父节点的右子节点。</li>
<li>情况11：被删除节点不是根节点，并且被删除节点是父节点的左子节点。</li>
<li>情况12：被删除节点不是根节点，并且被删除节点是父节点的右子节点，并且被删除节点的右子节点有左子节点。</li>
<li>情况13：被删除节点不是根节点，并且被删除节点是父节点的左子节点，并且被删除节点的右子节点有左子节点。</li>
<li>情况14：被删除节点是根节点，并且被删除节点的右子节点有左子节点。</li>
</ol>
<p>上面我们分析了二叉树删除的所有情况，接下来我会根据分析情况对代码进行解析。</p>
<h2>代码分析</h2>
<p>我们现在分析的重点是Binarytree的delete方法，要执行删除操作，必须先找到需要删除的结点。</p>
<h3>寻找删除的结点</h3>
<p>寻找删除结点的过程和插入结点的过程是一样的，只不过compare的结果为0才算是找到了目标删除结点，简化代码为：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/qHSMo7KFN7.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>这部分代码和插入是一样的，从根节点遍历整棵树，直到找到compare为0的结点，相信大家如果理解了之前所说的插入，那么这里也应该理解了。</p>
<h3>删除目标节点</h3>
<p>删除的代码，我们分几个模块分析，<strong>首先被删除结点没有子节点</strong>：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/3NymXdGwO7.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p><strong>下面是被删除节点只有一个子节点</strong>：<br><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/Q2R9E1LIzT.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>接下来是被删除结点存在2个子节点：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/vb0CUvztdS.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<p>代码的流程和上面的分析一一对应，如果你看懂了我上面的分析，代码肯定没有问题，好了，测试文件如下所示：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/39566/oynmM054Jv.png!large" alt="老死机带你用PHP实现数据结构之二叉树"></p>
<h2>总结</h2>
<p>请原谅，因为在贴出代码之前，我已经列举出了二叉树删除的所有情况，所以后面没有再仔细的分析代码，你只要看懂我上面的实例图片，看懂代码，完全不是问题，如果你遇到困难，请加qq群：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201911/22/39566/LKCnzcs2gF.png!large" alt=""></p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/13249808562/tags/php_28">php</a>
    </div>
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <p>如果有不懂的地方，可以加我的qq：1174332406，或者是微信:itshardjs</p>
                                </span>
                            </div>',
    'created_at' => '2019-12-13 14:30:04',
    'updated_at' => '2019-12-13 14:30:04',
  ),
  20 => 
  array (
    'title' => 'migrate:rollback 时 dropForeign 抛出的异常解决方案',
    'review' => ' 104',
    'comment' => ' 0',
    'content' => '<h2>① 过程 ：</h2>
<blockquote>
<p>我的环境 Window 10 x64 &amp; Homestead 8 &amp; Laravel 6.x</p>
</blockquote>
<pre><code class=" language-php"> php artisan make:migration test_drop_foreigns</code></pre>
<pre><code class=" language-php">&lt;?php

use Illuminate\\Database\\Migrations\\Migration;
use Illuminate\\Database\\Schema\\Blueprint;
use Illuminate\\Support\\Facades\\Schema;

class TestDropForeigns extends Migration
{
    /**
     * Run the migrations.
     *
     * [@return](https://learnku.com/users/31554) void
     */
    public function up()
    {
        Schema::create(\'test_a\', function (Blueprint $table) {
            $table-&gt;bigIncrements(\'id\');
            $table-&gt;bigInteger(\'b_id\')-&gt;unsigned()-&gt;nullable()-&gt;index();//table b id index
            $table-&gt;timestamps();
        });

        Schema::create(\'test_b\', function (Blueprint $table) {
            $table-&gt;bigIncrements(\'id\');
            $table-&gt;string(\'title\')-&gt;nullable();
            $table-&gt;timestamps();
        });

        Schema::table(\'test_a\', function ($table) {
            $table-&gt;foreign(\'b_id\')-&gt;references(\'id\')-&gt;on(\'test_b\');
        });
    }

    /**
     * Reverse the migrations.
     *
     * [@return](https://learnku.com/users/31554) void
     */
    public function down()
    {
        Schema::table(\'test_a\', function ($table) {
            $table-&gt;dropForeign(\'b_id\');
        });
    }
}</code></pre>
<pre><code class=" language-php">php artisan migrate
php artisan migrate:rollback</code></pre>
<h4>你可以得到以下错误</h4>
<pre><code class=" language-php">Rolling back: 2019_12_14_023746_test_drop_foreigns
Illuminate\\Database\\QueryException  : SQLSTATE[42000]: Syntax error or access violation: 1091 Can\'t DROP \'b_id\'; check that column/key exists (SQL: alter table `test_a` drop foreign key `b_id`)</code></pre>
<h2>② 怎么解决</h2>
<blockquote>
<p>讲以下代码</p>
</blockquote>
<pre><code class=" language-php">$table-&gt;dropForeign(\'b_id\');</code></pre>
<blockquote>
<p>改成</p>
</blockquote>
<p>···<br>
$table-&gt;dropForeign([\'b_id\']);<br>
···</p>
<blockquote>
<p>清空数据库后重新执行执行</p>
</blockquote>
<pre><code class=" language-php">php artisan migrate
php artisan migrate:rollback</code></pre>
<blockquote>
<p>错误没有了！</p>
</blockquote>
<h2>③ 复数 dropForeign</h2>
<pre><code class=" language-php">$table-&gt;dropForeign([\'b_id\']);
$table-&gt;dropForeign([\'c_id\']);
$table-&gt;dropForeign([\'d_id\']);</code></pre>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/nckffz/tags/schema_767">schema</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/nckffz/tags/dropforeign_52341">dropForeign</a>
    </div>',
    'created_at' => '2019-12-14 10:45:31',
    'updated_at' => '2019-12-14 10:45:31',
  ),
  21 => 
  array (
    'title' => '求助 1000 并发量所需服务器配置',
    'review' => ' 1283',
    'comment' => ' 13',
    'content' => '<p>求助点：<br>
1.具体服务器几核几G<br>
2.接口域名并发设置大小<br>
3.数据库连接设置大小</p>',
    'created_at' => '2019-12-10 17:04:50',
    'updated_at' => NULL,
  ),
  22 => 
  array (
    'title' => '《L05 Laravel 教程 - 电商实战》发布',
    'review' => ' 34682',
    'comment' => ' 79',
    'content' => '<div class="text-center"><img src="https://cdn.learnku.com/uploads/images/201806/12/1/RAjQ5R8DAS.jpg" width="300" alt="RAjQ5R8DAS.jpg"></div>
<p>本课程核心功能由 Leo 撰写，我负责做一些边角料的工作。<a href="https://learnku.com/users/5320">[@leo](https://learnku.com/users/5320)</a> 个人定位是PHP 架构师、高级运维工程师，有 3 年 Laravel 使用经验，7 年的 PHP 开发经验，对 Laravel 各个模块的实现原理有深入了解。已完成多个电商或与电商相关的正式商业项目并运行良好至今。前百度高级工程师，目前任北京一家电商创业公司的技术负责人。经常混社区的同学，相信对 <a href="https://learnku.com/users/5320">[@leo](https://learnku.com/users/5320)</a> 不会感到陌生。Leo 同时也是 Laravel 社区问答帖的最热心回复者，有 830+ 个回复，大部分回复的是专业的技术问答帖。</p>
<p>课程代号 L05，在这套课程里，我们将一步步带你构建一个功能齐全的 B2C 电商项目 —— Laravel-Shop，功能如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201806/14/1/axbp3OpRZD.jpg?imageView2/2/w/1240/h/0" alt="file"></p>
<p>课程涉及开发的技术知识点如下：</p>
<ul>
<li>Composer autoload 功能的使用姿势；</li>
<li>Laravel Mix 的基本用法；</li>
<li>使用 Laravel 快速构建用户登录、注册功能；</li>
<li>使用 MailHog 调试邮件发送功能；</li>
<li>使用 Laravel 的 Notification 模块发送邮件；</li>
<li>优雅地处理 Laravel 项目中的异常；</li>
<li>事件与监听器的使用；</li>
<li>使用授权策略来控制权限；</li>
<li>使用 overtrue/laravel-lang 来汉化错误信息；</li>
<li>laravel-admin 扩展包的安装与配置；</li>
<li>使用 laravel-admin 快速构建对模型的增删改查功能；</li>
<li>使用 laravel-admin 配置后台用户角色、权限；</li>
<li>商品 SKU 的概念；</li>
<li>使用查询构造器根据用户输入来动态构建查询 SQL；</li>
<li>设置 Laravel 路由顺序的正确姿势；</li>
<li>购物车的设计与实现；</li>
<li>使用闭包来校验用户输入；</li>
<li>订单流水号的生成；</li>
<li>创建订单时保存用户收货地址信息的正确姿势；</li>
<li>代表状态的值应使用常量；</li>
<li>在 Laravel 中使用数据库事务的正确姿势；</li>
<li>高并发下减商品库存的正确姿势；</li>
<li>延迟任务的使用；</li>
<li>使用预加载与延迟预加载解决数据库 N + 1 问题；</li>
<li>通过对业务代码的封装来提高代码的复用性；</li>
<li>yansongda/pay 扩展包的安装与配置；</li>
<li>支付宝沙箱账号的申请与配置；</li>
<li>微信扫码支付的开通与配置；</li>
<li>拉起支付宝、微信支付；</li>
<li>支付的前端回调与后端回调的概念；</li>
<li>在本地开发环境处理支付宝、微信支付后端回调的正确姿势；</li>
<li>二维码的生成；</li>
<li>管理员收到支付订单开始发货；</li>
<li>用户收到商品后确认收货；</li>
<li>用户确认收货后选择退款；</li>
<li>管理员接到退款请求后的拒绝退款；</li>
<li>支付宝、微信支付的退款处理；</li>
<li>优惠券的设计与实现；</li>
<li>laravel-admin 配置的备份与恢复；</li>
<li>常见 Web 项目漏洞类型及在 Laravel 项目中的防御措施。</li>
</ul>
<p>我们沿用 <a href="https://learnku.com/laravel/courses">Laravel 实战课程</a> 的教学方法，利用线索式的行文方式，带你熟悉项目需求分析、开发计划、项目创建、支付接口调试等电商项目的开发流程。</p>
<p>我们的定位是最专业的商业项目开发课程，课程中所教授的技术方案，都是我们在实战中不断积累而来，所以你学到不是一个简单的『玩具项目』，而是一个经受过实战考验的商业解决方案，可以在你的商业项目中大胆使用。</p>
<h2>关于优惠</h2>
<p>很多朋友问有没有优惠，本来就是几十块钱的课程，就是一顿饭的钱。课程作者是高级别的工程师，收入太少请不起高手来讲课，没有驱动力，保证不了质量，所以我们不会有优惠。不过，我们支持邀请好友返利功能。需要优惠价格的同学，可以合理利用此功能，活动规则请阅读 <a href="https://learnku.com/courses/my/referrals">邀请好友活动详情页</a>。</p>
<blockquote>
<p>请注意，为了防止垃圾信息遍布各地，邀请好友的推广链接在本社区内无效。</p>
</blockquote>
<h2>购买课程</h2>
<blockquote>
<p><a href="https://learnku.com/courses/laravel-shop">戳我购买</a></p>
</blockquote>

                        
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" target="_blank" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <hr>
<p>Practice makes perfect.</p>
                                </span>
                            </div>',
    'created_at' => '2018-06-13 20:03:53',
    'updated_at' => '2019-07-22 11:36:19',
  ),
  23 => 
  array (
    'title' => 'Laravel editor.md 支持截图 / 粘贴上传图片',
    'review' => ' 99',
    'comment' => ' 0',
    'content' => '<p>在我们日常网站搭建中，很多时候都会使用到富文本编辑器，比如比较常用的百度富文本编辑器，但今天推荐一款富文本编辑器<code>editor.md</code>,这个编辑器贼好用，而且插件开发非常方便，但就是文档支持不好o(╥﹏╥)o。</p>
<p>官网：<a href="https://pandao.github.io/editor.md/examples/" title="https://pandao.github.io/editor.md/examples/" target="_blank">https://pandao.github.io/editor.md/example...</a></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/14/49214/M2ODGlnSkX.png!large" alt=""></p>
<p>下面进入正题：</p>
<ul>
<li>
<p>该文章仅供参考。用于开发环境时可根据自己需要进行修改。</p>
</li>
<li>
<p>插件使用方法：使用截图工具截图保存之后，在编辑器里面粘贴/(ctrl+v)就可以实现自动上传图片了。</p>
</li>
</ul>
<h2>1. 创建插件文件</h2>
<p>在<code>editormd/plugins/</code>目录下创建<code>image-handle-paste/image-handle-paste.js</code>文件。</p>
<h2>2.插件内容</h2>
<p>插件里面的方法大体逻辑是将粘贴板的图片添加到一个FormData里面，然后使用ajax进行提交上传的，上传完成调编辑器自带的图片dialog进行插入。里面预留了blob对象和base64格式的图片方法，根据自己需求自取。</p>
<pre><code class="language-javascript">/*!
 * editormd图片粘贴上传插件
 *
 * @file   image-handle-paste.js
 * @author zhangkaixing
 * @date   2019-09-23
 * @link   https://www.codehui.net
 */

(function() {

    var factory = function (exports) {
        var $            = jQuery;           // if using module loader(Require.js/Sea.js).
        var pluginName   = "image-handle-paste";  // 定义插件名称

        //图片粘贴上传方法
        exports.fn.imagePaste = function() {
            var _this       = this;
            var cm          = _this.cm;
            var settings    = _this.settings;
            var editor      = _this.editor;
            var classPrefix = _this.classPrefix;
            var id       = _this.id;

            if(!settings.imageUpload || !settings.imageUploadURL){
                console.log(\'你还未开启图片上传或者没有配置上传地址\');
                return false;
            }

            //监听粘贴板事件
            $(\'#\' + id).on(\'paste\', function (e) {

                var items = (e.clipboardData || e.originalEvent.clipboardData).items;

                //判断图片类型
                if (items &amp;&amp; items[0].type.indexOf(\'image\') &gt; -1) {

                    var file = items[0].getAsFile();

                    /*生成blob
                    var blobImg = URL.createObjectURL(file);
                    */

                    /*base64
                    var reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = function (e) {
                        var base64Img = e.target.result //图片的base64
                    }
                    */

                    // 创建FormData对象进行ajax上传
                    var forms = new FormData(document.forms[0]); //Filename
                    forms.append(classPrefix + "image-file", file, "file_"+Date.parse(new Date())+".png"); // 文件

                    //调用imageDialog插件，弹出对话框
                    _this.executePlugin("imageDialog", "image-dialog/image-dialog");

                    _ajax(settings.imageUploadURL, forms, function(ret){
                        if(ret.success == 1){
                        //数据格式可以自定义，但需要把图片地址写入到该节点里面
                            $("." + classPrefix + "image-dialog").find("input[data-url]").val(ret.url);
                            //cm.replaceSelection("![](" + ret.url  + ")");
                        }
                        console.log(ret.message);
                    })
                }
            })
        };
        // ajax上传图片 可自行处理
        var _ajax = function(url, data, callback) {
            $.ajax({
                "type": \'post\',
                "cache": false,
                "url": url,
                "data": data,
                "processData": false,
                "contentType": false,
                "mimeType": "multipart/form-data",
                success: function(ret){
                    callback(JSON.parse(JSON.parse(ret)));
                },
                error: function (err){
                    console.log(\'请求失败\')
                }
            })
        }
    };

    // CommonJS/Node.js
    if (typeof require === "function" &amp;&amp; typeof exports === "object" &amp;&amp; typeof module === "object")
    {
        module.exports = factory;
    }
    else if (typeof define === "function")  // AMD/CMD/Sea.js
    {
        if (define.amd) { // for Require.js

            define(["editormd"], function(editormd) {
                factory(editormd);
            });

        } else { // for Sea.js
            define(function(require) {
                var editormd = require("./../../editormd");
                factory(editormd);
            });
        }
    }
    else
    {
        factory(window.editormd);
    }

})();</code></pre>
<p>注意：后端接收<code>file</code>方法为<code>$_FILES[\'editormd-image-file\']</code>。</p>
<p>默认返回的数据格式（可以自定义）</p>
<pre><code class="language-json">{
    success : 0 | 1,           // 0 表示上传失败，1 表示上传成功
    message : "提示的信息，上传成功或上传失败及错误信息等。",
    url     : "图片地址"        // 上传成功时才返回
}</code></pre>
<h2>3. 插件的调用</h2>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="zh"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;editormd图片粘贴上传插件&lt;/title&gt;
        &lt;link rel="stylesheet" href="../css/editormd.css" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="test-editormd"&gt;
            &lt;textarea style="display:none;"&gt;&lt;/textarea&gt;
        &lt;/div&gt;
        &lt;script src="js/jquery.min.js"&gt;&lt;/script&gt;
        &lt;script src="../editormd.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript"&gt;
            var testEditor = editormd("test-editormd", {
                path: \'../lib/\',
                imageUpload: true, //开启图片上传
                imageUploadURL: \'/logic/upload\', //图片上传后台地址
                onload: function() {
                    // 引入插件 执行监听方法
                    editormd.loadPlugin("../plugins/image-handle-paste/image-handle-paste", function(){
                        testEditor.imagePaste();
                    });
                }
            });
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/xingkong12138/tags/laravel_58">laravel</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/xingkong12138/tags/editormd_28364">editor.md</a>
    </div>',
    'created_at' => '2019-12-14 09:44:09',
    'updated_at' => '2019-12-14 09:44:09',
  ),
  24 => 
  array (
    'title' => '最近有点迷茫啊，不知道大家的工作模式是咋样的？',
    'review' => ' 984',
    'comment' => ' 22',
    'content' => '<p>进这家公司一年了，但感觉这一年好像基本都是写接口curd，根本没学到啥东西，技术总监是个学java的,碰到一些比较大的问题，基本上他写个程序就完事了，其实我也想对一些比较难的问题稍微自己研究下，但是基本上被催，“还没弄好，是不是出了啥问题了？"然后问题就被他拦过去了，和他交流基本都是反馈问题，也不知道最后问题到底是怎么解决的（有几次问他，看他有点不耐烦，最后就基本闭嘴了）。。。总感觉自己就是个工具人啊！</p>',
    'created_at' => '2019-12-09 16:28:10',
    'updated_at' => NULL,
  ),
  25 => 
  array (
    'title' => '分享一个博客',
    'review' => ' 740',
    'comment' => ' 16',
    'content' => '<p>FantasyCode 是基于Laravel6.0框架和semantic-ui开发的一个个人博客社区网站。前端页面样式风格参考【learnku.com/net】</p>
<ul>
<li>用户认证 —— 注册、登录、退出；</li>
<li>个人中心 —— 用户个人中心，编辑资料</li>
<li>上传图片 —— 修改头像时候上传图片</li>
<li>文章的 列表 发布 修改 删除 评论</li>
<li>文章支持MarkDown语法，参考 learnku.net代码</li>
<li>文章评论 邮件提醒</li>
<li>文章以及用户的搜索</li>
<li>教程撰写发布功能（仅对管理员开放）</li>
</ul>
<p>博客地址:<br><a href="https://www.fantasycode.top" target="_blank">https://www.fantasycode.top</a></p>
<pre><code class=" language-php"> git clone  https://gitee.com/uknowfantasy/FantasyCode.git</code></pre>
<p>页面不是很炫酷，仅作为自己日常笔记使用吧  哈哈</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/11/12860/AAZeI2Jtiw.png!large" alt="分享一个博客系统"></p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/Uknow/tags/laravel_58">laravel</a>
    </div>',
    'created_at' => '2019-12-11 09:42:09',
    'updated_at' => '2019-12-11 09:42:09',
  ),
  26 => 
  array (
    'title' => '请问 Laravel6 的 blade 模板可否停用不运行？',
    'review' => ' 89',
    'comment' => ' 0',
    'content' => '<p>我使用laravel6开发后端，前端仍使用php原生的样板引擎。</p>
<p>发现larvel仍会走blade模板检验这道程序，多走一道程序降低效能，考量拿掉blade模板会让laravel可能发生不可预期的问题，仍想知道有关闭方式否？谢谢。</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/laravel/58">laravel</a>
    </div>',
    'created_at' => '2019-12-14 08:15:54',
    'updated_at' => NULL,
  ),
  27 => 
  array (
    'title' => '磁盘使用 local 驱动，文件存储默认储存在那？',
    'review' => ' 195',
    'comment' => ' 3',
    'content' => '<p>文档中：<code>public 磁盘使用 local 驱动，并且将这些文件存储在 storage/app/public 目录下</code><br>
发开filesystems.php</p>
<pre><code class=" language-php"> \'disks\' =&gt; [

        \'local\' =&gt; [
            \'driver\' =&gt; \'local\',
            \'root\' =&gt; storage_path(\'app\'),

        ],
</code></pre>
<p>默认上传到图片到app下 并不是storage/app/public </p>',
    'created_at' => '2019-12-13 06:59:37',
    'updated_at' => NULL,
  ),
  28 => 
  array (
    'title' => '高并发设计笔记',
    'review' => ' 2250',
    'comment' => ' 2',
    'content' => '<blockquote>
<p>仅提炼课程小结，分享设计思路，有兴趣的也可以去购买学习该门课程 <a href="https://time.geekbang.org/column/intro/230">《高并发系统设计》</a></p>
</blockquote>
<h1>基础篇</h1>
<h2>高并发系统：它的通用设计方法是什么？</h2>
<p>高并发系统设计的三种通用方法：<strong>Scale-out、缓存和异步</strong>。</p>
<p>这三种方法可以在做方案设计时灵活地运用，但它不是具体实施的方案，而是三种思想，在实际运用中会千变万化。</p>
<p>就拿 <strong>Scale-out</strong> 来说，数据库一主多从、分库分表、存储分片都是它的实际应用方案。</p>
<p>需要注意的是，在应对高并发大流量的时候，系统是可以通过增加机器来承担流量冲击的，至于要采用什么样的方案还是要具体问题具体分析。</p>
<h2>架构分层：我们为什么一定要这么做？</h2>
<p>分层架构是软件设计思想的外在体现，是一种实现方式。我们熟知的一些软件设计原则都在分层架构中有所体现。</p>
<p>比方说，<strong>单一职责原则</strong>规定每个类只有单一的功能，在这里可以引申为每一层拥有单一职责，且层与层之间边界清晰；</p>
<p><strong>迪米特法则</strong>原意是一个对象应当对其它对象有尽可能少的了解，在分层架构的体现是数据的交互不能跨层，只能在相邻层之间进行；</p>
<p><strong>开闭原则</strong>要求软件对扩展开放，对修改关闭。它的含义其实就是将抽象层和实现层分离，抽象层是对实现层共有特征的归纳总结，不可以修改，但是具体的实现是可以无限扩展，随意替换的。</p>
<p>掌握这些设计思想会自然而然地明白分层架构设计的妙处，同时也能帮助我们做出更好的设计方案。</p>
<h2>系统设计目标（一）：如何提升系统性能？</h2>
<p>有时候你在遇到性能问题的时候会束手无策，需要强调几点：</p>
<ul>
<li>数据优先，做一个新的系统在上线之前一定要把性能监控系统做好；</li>
<li>掌握一些性能优化工具和方法，这就需要在工作中不断的积累；</li>
<li>计算机基础知识很重要，比如说网络知识、操作系统知识等等，掌握了基础知识才能让你在优化过程中抓住性能问题的关键，也能在性能优化过程中游刃有余。</li>
</ul>
<p>性能优化是一个很大的话题，比方说如何用缓存优化系统的读取性能，如何使用消息队列优化系统的写入性能等等。</p>
<h2>系统设计目标（二）：系统怎样做到高可用？</h2>
<p>从开发和运维角度上来看，提升可用性的方法是不同的：</p>
<p><strong>开发</strong>注重的是如何处理故障，关键词是冗余和取舍。冗余指的是有备用节点，集群来顶替出故障的服务，比如文中提到的故障转移，还有多活架构等等；取舍指的是丢卒保车，保障主体服务的安全。</p>
<p>从<strong>运维角度</strong>来看则更偏保守，注重的是如何避免故障的发生，比如更关注变更管理以及如何做故障的演练。</p>
<p>两者结合起来才能组成一套完善的高可用体系。</p>
<p>需要注意的是，提高系统的可用性有时候是以<strong>牺牲用户体验</strong>或者是<strong>牺牲系统性能</strong>为前提的，也需要大量人力来建设相应的系统，完善机制。所以要把握一个度，不该做过度的优化。</p>
<p>另外，一般的系统或者组件都是追求极致的性能的，那么有没有不追求性能，只追求极致的可用性的呢？</p>
<p>答案是有的。</p>
<p>比如配置下发的系统，它只需要在其它系统启动时提供一份配置即可，所以秒级返回也可，十秒钟也 OK，无非就是增加了其它系统的启动时间而已。但是，它对可用性的要求是极高的，甚至会到六个九，原因是配置可以获取的慢，但是不能获取不到。这个例子说明，可用性和性能有时候是需要做取舍的，但如何取舍就要视不同的系统而定，不能一概而论了。</p>
<h2>系统设计目标（三）：如何让系统易于扩展？</h2>
<p>未做拆分的系统虽然可扩展性不强，但是却足够简单，无论是系统开发还是运行维护都不需要投入很大的精力。</p>
<p>拆分之后，需求开发需要横跨多个系统多个小团队，排查问题也需要涉及多个系统，运行维护上，可能每个子系统都需要有专人来负责，对于团队是一个比较大的考验。</p>
<h1>数据库篇</h1>
<h2>池化技术：如何减少频繁创建数据库连接的性能损耗？</h2>
<p>案列：垂直电商系统中，在遇到数据库查询性能下降的问题时，使用数据库连接池解决了频繁创建连接带来的性能问题，使用线程池提升了并行查询数据库的性能。</p>
<p>其实，连接池和线程池你并不陌生，本章强调的重点是：</p>
<ul>
<li>
<p>池子的最大值和最小值的设置很重要，初期可以依据经验来设置，后面还是需要根据实际运行情况做调整。</p>
</li>
<li>
<p>池子中的对象需要在使用之前预先初始化完成，这叫做池子的预热，比方说使用线程池时就需要预先初始化所有的核心线程。如果池子未经过预热可能会导致系统重启后产生比较多的慢请求。</p>
</li>
<li>
<p>池化技术核心是一种空间换时间优化方法的实践，所以要关注空间占用情况，避免出现空间过度使用出现内存泄露或者频繁垃圾回收等问题。</p>
</li>
</ul>
<h2>数据库优化方案（一）：查询请求增加时，如何做主从分离？</h2>
<p>查询量增加时，可以通过主从分离和一主多从部署抵抗增加的数据库流量的，除了掌握主从复制的技术之外，还需要了解主从分离会带来什么问题以及它们的解决办法。本章明确的要点主要有：</p>
<ol>
<li>主从读写分离以及部署一主多从可以解决突发的数据库读流量，是一种数据库横向扩展的方法；</li>
<li>读写分离后，主从的延迟是一个关键的监控指标，可能会造成写入数据之后立刻读的时候读取不到的情况；</li>
<li>业界有很多的方案可以屏蔽主从分离之后数据库访问的细节，让开发人员像是访问单一数据库一样，包括有像 TDDL、Sharding-JDBC 这样的嵌入应用内部的方案，也有像 Mycat 这样的独立部署的代理方案。</li>
</ol>
<p>其实，我们可以把主从复制引申为存储节点之间互相复制存储数据的技术，它可以实现数据的冗余，以达到备份和提升横向扩展能力的作用。在使用<strong>主从复制</strong>这个技术点时，你一般会考虑两个问题：</p>
<ol>
<li>
<p>主从的一致性和写入性能的权衡，如果要保证所有从节点都写入成功，那么写入性能一定会受影响；如果只写入主节点就返回成功，那么从节点就有可能出现数据同步失败的情况，从而造成主从不一致，而在互联网的项目中，一般会<strong>优先考虑性能</strong>而不是数据的强一致性。</p>
</li>
<li>
<p>主从的延迟问题，很多诡异的读取不到数据的问题都可能会和它有关，如果遇到这类问题不妨先看看主从延迟的数据。</p>
</li>
</ol>
<p>很多组件都会使用到这个技术，比如，<br>
Redis 也是通过主从复制实现读写分离；Elasticsearch 中存储的索引分片也可以被复制到多个节点中；写入到 HDFS 中文件也会被复制到多个 DataNode 中。</p>
<p>只是不同的组件对于复制的一致性、延迟要求不同，采用的方案也不同。不过，这种设计的思想是通用的。</p>
<h2>数据库优化方案（二）：写入数据量增加时，如何实现分库分表？</h2>
<p>总的来说，在面对数据库容量瓶颈和写并发量大的问题时，可以采用<strong>垂直拆分和水平拆分</strong>来解决，不过要注意，这两种方式虽然能够解决问题，但是也会引入诸如查询数据必须带上分区键，列表总数需要单独冗余存储等问题。</p>
<p>而且，需要了解的是在实现分库分表过程中，数据从单库单表迁移多库多表是一件即繁杂又容易出错的事情，而且如果初期没有规划得当，后面要继续增加数据库数或者表数时，还要经历这个迁移的过程。所以，对于分库分表的原则主要有以下几点：</p>
<ol>
<li>如果在性能上没有瓶颈点那么就尽量不做分库分表；</li>
<li>如果要做，就尽量一次到位，比如说 16 库，每个库 64 表就基本能够满足为了几年内你的业务的需求。</li>
<li>很多的 NoSQL 数据库，例如 Hbase，MongoDB 都提供 auto sharding 的特性，如果团队内部对于这些组件比较熟悉，有较强的运维能力，那么也可以考虑使用这些 NoSQL 数据库替代传统的关系型数据库。</li>
</ol>
<p>其实，有很多人并没有真正从根本上搞懂为什么要拆分，拆分后会带来哪些问题，只是一味地学习大厂现有的拆分方法，从而导致问题频出。所以，在使用一个方案解决一个问题的时候一定要弄清楚原理，搞清楚这个方案会带来什么问题，要如何来解决，要知其然也知其所以然，这样才能在解决问题的同时避免踩坑。</p>
<h2>发号器：如何保证分库分表后ID的全局唯一性？</h2>
<p>使用 Snowflake 算法解决分库分表后数据库 ID 的全局唯一的问题，<br>
生成的 ID 需要满足单调递增性，以及要具有一定业务含义的特性。</p>
<p>本章重点在于如何将 Snowflake 算法落地，以及在落地过程中遇到了哪些坑，如何去解决它。</p>
<p>Snowflake 的算法并不复杂，在使用的时候可以不考虑独立部署的问题，先想清楚按照自身的业务场景，需要如何设计 Snowflake 算法中的每一部分占的二进制位数。比如你的业务会部署几个 IDC，应用服务器要部署多少台机器，每秒钟发号个数的要求是多少等等，然后在业务代码中实现一个简单的版本先使用，等到应用服务器数量达到一定规模，再考虑独立部署的问题就可以了。这样可以避免多维护一套发号器服务，减少了运维上的复杂</p>
<h2>NoSQL：在高并发场景下，数据库和NoSQL如何做到互补？</h2>
<p>NoSQL 数据库在性能、扩展性上的优势，以及它的一些特殊功能特性，主要有以下几点：</p>
<ol>
<li>在性能方面，NoSQL 数据库使用一些算法将对磁盘的随机写转换成顺序写，提升了写的性能；</li>
<li>在某些场景下，比如全文搜索功能，关系型数据库并不能高效地支持，需要 NoSQL 数据库的支持；</li>
<li>在扩展性方面，NoSQL 数据库天生支持分布式，支持数据冗余和数据分片的特性。</li>
</ol>
<p>这些都让它成为传统关系型数据库的良好的补充，需要了解的是，NoSQL 可供选型的种类很多，每一个组件都有各自的特点。在做选型的时候需要对它的实现原理有比较深入的了解，最好在运维方面对它有一定的熟悉，这样在出现问题时才能及时找到解决方案。否则，盲目跟从地上了一个新的 NoSQL 数据库，最终可能导致会出了故障无法解决，反而成为整体系统的拖累。</p>
<p>案例：曾经使用 Elasticsearch 作为持久存储，支撑社区的 feed 流功能，初期开发的时候确实很爽，可以针对 feed 中的任何字段做灵活高效地查询，业务功能迭代迅速，代码也简单易懂。可是到了后期流量上来之后，由于缺少对于 Elasticsearch 成熟的运维能力，造成故障频出，尤其到了高峰期就会出现节点不可用的问题，而由于业务上的巨大压力又无法分出人力和精力对 Elasticsearch 深入的学习和了解，最后不得不做大的改造切回熟悉的 MySQL。所以，对于开源组件的使用，不能只停留在只会“hello world”的阶段，而应该对它有足够的运维上的把控能力。</p>
<h1>缓存篇</h1>
<h2>缓存：数据库成为瓶颈后，动态数据的查询要如何加速？</h2>
<p>了解缓存的定义，常见缓存的分类以及缓存的不足。本章主要强调以下几点：</p>
<p>缓存可以有多层，比如上面提到的静态缓存处在负载均衡层，分布式缓存处在应用层和数据库层之间，本地缓存处在应用层。我们需要将请求尽量挡在上层，因为越往下层，对于并发的承受能力越差；</p>
<p>缓存命中率是我们对于缓存最重要的一个监控项，越是热点的数据，缓存的命中率就越高。</p>
<p>还需要理解的是，缓存不仅仅是一种组件的名字，更是一种设计思想，你可以认为任何能够加速读请求的组件和设计方案都是缓存思想的体现。而这种加速通常是通过两种方式来实现：</p>
<ul>
<li>使用更快的介质，比方说课程中提到的内存；</li>
<li>缓存复杂运算的结果，比方说前面 TLB 的例子就是缓存地址转换的结果。</li>
</ul>
<p><strong>在实际工作中碰到“慢”的问题时，缓存就是第一时间需要考虑的。</strong></p>
<h2>缓存的使用姿势（一）：如何选择缓存的读写策略？</h2>
<p>了解缓存使用的几种策略，以及每种策略适用的使用场景是怎样的。本章重点是：</p>
<ol>
<li>
<p>Cache Aside 是我们在使用分布式缓存时最常用的策略，你可以在实际工作中直接拿来使用。</p>
</li>
<li>
<p>Read/Write Through 和 Write Back 策略需要缓存组件的支持，所以比较适合你在实现本地缓存组件的时候使用；</p>
</li>
<li>
<p>Write Back 策略是计算机体系结构中的策略，不过写入策略中的只写缓存，异步写入后端存储的策略倒是有很多的应用场景。</p>
</li>
</ol>
<p>需要注意，以上提到的策略都是标准的使用姿势，在实际开发过程中需要结合实际的业务特点灵活使用甚至加以改造。</p>
<p>这些业务特点包括但不仅限于：整体的数据量级情况，访问的读写比例的情况，对于数据的不一致时间的容忍度，对于缓存命中率的要求等等。<strong>理论结合实践</strong>，具体情况具体分析，才能得到更好的解决方案。</p>
<h2>缓存的使用姿势（二）：缓存如何做到高可用？</h2>
<p>本章重点是：</p>
<p>分布式缓存的高可用方案主要有三种，首先是<strong>客户端方案</strong>，一般也称为 Smart Client。我们通过制定一些数据分片和数据读写的策略，可以实现缓存高可用。这种方案的好处是性能没有损耗，缺点是客户端逻辑复杂且在多语言环境下不能复用。</p>
<p>其次，<strong>中间代理方案</strong>在客户端和缓存节点之间增加了中间层，在性能上会有一些损耗，在代理层会有一些内置的高可用方案，比如 Codis 会使用 Codis Ha 或者 Sentinel。</p>
<p>最后，<strong>服务端方案</strong>依赖于组件的实现，Memcached 就只支持单机版没有分布式和 HA 的方案，而 Redis 在 2.4 版本提供了 Sentinel 方案可以自动进行主从切换。服务端方案会在运维上增加一些复杂度。</p>
<p>总体而言，<strong>分布式缓存的三种方案</strong>各有所长，</p>
<ul>
<li>有些团队可能在开发过程中已经积累了 Smart Client 上的一些经验；而有些团队在 Redis 运维上经验丰富，就可以推进 Sentinel 方案；有些团队在存储研发方面有些积累，就可以推进中间代理层方案，甚至可以自研适合自己业务场景的代理层组件，</li>
</ul>
<p>具体的选择还是要看团队的实际情况而定。</p>
<h2>缓存的使用姿势（三）：缓存穿透了怎么办？</h2>
<p>了解一些解决缓存穿透的方案，可以在发现自己的缓存系统命中率下降时，从中得到一些借鉴的思路。本章重点是：</p>
<ol>
<li>
<p>回种空值是一种最常见的解决思路，实现起来也最简单，如果评估空值缓存占据的缓存空间可以接受，那么可以优先使用这种方案；</p>
</li>
<li>
<p>布隆过滤器会引入一个新的组件，也会引入一些开发上的复杂度和运维上的成本。所以只有在存在海量查询数据库中，不存在数据的请求时才会使用，在使用时也要关注布隆过滤器对内存空间的消耗；</p>
</li>
<li>
<p>对于极热点缓存数据穿透造成的“狗桩效应”，可以通过设置分布式锁或者后台线程定时加载的方式来解决。</p>
</li>
</ol>
<p>除此之外，还需要了解的是，数据库是一个脆弱的资源，它无论是在扩展性、性能还是承担并发的能力上，相比缓存都处于绝对的劣势，所以我们<strong>解决缓存穿透问题的核心目标在于减少对于数据库的并发请求</strong>。了解了这个核心的思想，也许就能在日常工作中找到其他更好的解决缓存穿透问题的方案。</p>
<h2>CDN：静态资源如何加速？</h2>
<p>了解 CDN 对静态资源进行加速的原理和使用的核心技术，本章重点是：</p>
<ol>
<li>DNS 技术是 CDN 实现中使用的核心技术，可以将用户的请求映射到 CDN 节点上；</li>
<li>DNS 解析结果需要做本地缓存，降低 DNS 解析过程的响应时间；</li>
<li>GSLB 可以给用户返回一个离着他更近的节点，加快静态资源的访问速度。</li>
</ol>
<p>作为一个服务端开发人员，我们可能会忽略 CDN 的重要性，对于偶尔出现的 CDN 问题嗤之以鼻，觉得这个不是我们应该关心的内容，这种想法是错的。</p>
<p>CDN 是我们系统的门面，其<strong>缓存的静态数据</strong>，如图片和视频数据的请求量很可能是接口请求数据的几倍甚至更高，一旦发生故障，对于整体系统的影响是巨大的。</p>
<p>另外 <strong>CDN 的带宽</strong>历来是我们研发成本的大头，尤其是目前处于小视频和直播风口上，大量的小视频和直播研发团队都在绞尽脑汁地减少 CDN 的成本。</p>
<p>由此看出，CDN 是我们整体系统至关重要的组成部分，而它作为一种特殊的缓存，其命中率和可用性也是我们服务端开发人员需要重点关注的指标。</p>
<h2>数据的迁移应该如何做？</h2>
<p>本章重点是：</p>
<p>双写的方案是数据库、Redis 迁移的通用方案，你可以在实际工作中直接加以使用。双写方案中最重要的，是通过数据校验来保证数据的一致性，这样就可以在迁移过程中随时回滚；</p>
<p>如果你需要将自建机房的数据迁移到云上，那么也可以考虑使用级联复制的方案，这种方案会造成数据的短暂停写，需要在业务低峰期执行；</p>
<p>缓存的迁移重点，是保证云上缓存的命中率，你可以使用改进版的副本组方式来迁移，在缓存写入的时候，异步写入云上的副本组，在读取时放少量流量到云上副本组，从而又可以迁移部分数据到云上副本组，又能尽量减少穿透给自建机房造成专线延迟的问题。</p>
<p>如果你作为项目的负责人，那么在迁移的过程中，你一定要制定周密的计划：如果是数据库的迁移，那么数据的校验应该是你最需要花费时间来解决的问题。</p>
<p>如果是自建机房迁移到云上，那么专线的带宽一定是你迁移过程中的一个瓶颈点，你需要在迁移之前梳理清楚，有哪些调用需要经过专线，占用带宽的情况是怎样的，带宽的延时是否能够满足要求。你的方案中也需要尽量做到在迁移过程中，同机房的服务，调用同机房的缓存和数据库，尽量减少对于专线带宽资源的占用。</p>
<h1>消息队列篇</h1>
<h2>消息队列：秒杀时如何处理每秒上万次的下单请求？</h2>
<p>本章重点是：</p>
<ul>
<li>削峰填谷是消息队列最主要的作用，但是会造成请求处理的延迟。</li>
<li>异步处理是提升系统性能的神器，但是你需要分清同步流程和异步流程的边界，同时消息存在着丢失的风险，我们需要考虑如何确保消息一定到达。</li>
<li>解耦合可以提升你的整体系统的鲁棒性（Robust）。</li>
</ul>
<p>当然，在使用消息队列之后虽然可以解决现有的问题，但是系统的复杂度也会上升。比如上面提到的业务流程中，</p>
<ul>
<li>同步流程和异步流程的边界在哪里？</li>
<li>消息是否会丢失，是否会重复？</li>
<li>请求的延迟如何能够减少？</li>
<li>消息接收的顺序是否会影响到业务流程的正常执行？</li>
<li>如果消息处理流程失败了之后是否需要补发？</li>
</ul>
<p>后面章节会讲解两个主要问题：一个是如何处理消息的丢失和重复，另一个是如何减少消息的延迟。</p>
<p>引入了消息队列的同时也会引入了新的问题，需要新的方案来解决，这就是系统设计的挑战，也是系统设计独有的魅力。</p>
<h2>消息投递：如何保证消息仅仅被消费一次？</h2>
<p>本章重点是：</p>
<ul>
<li>消息的丢失可以通过生产端的重试、消息队列配置集群模式，以及消费端合理处理消费进度三个方式来解决。</li>
<li>为了解决消息的丢失通常会造成性能上的问题以及消息的重复问题。</li>
<li>通过<strong>保证消息处理的幂等性</strong>可以解决消息的重复问题。</li>
</ul>
<p>并不是说消息丢失一定不能被接受，应该说，在允许消息丢失的情况下，消息队列的性能更好，方案实现的复杂度也最低。比如像是日志处理的场景，日志存在的意义在于排查系统的问题，而系统出现问题的几率不高，偶发的丢失几条日志是可以接受的。</p>
<p>所以方案设计看场景，这是一切设计的原则，不能把所有的消息队列都配置成防止消息丢失的方式，也不能要求所有的业务处理逻辑都要支持幂等性，这样会给开发和运维带来额外的负担。</p>
<h2>消息队列：如何降低消息队列系统中消息的延迟？</h2>
<p>了解如何提升消息队列的性能来降低消息消费的延迟，本章重点是：</p>
<ul>
<li>我们可以使用消息队列提供的工具，或者通过发送监控消息的方式，来监控消息的延迟情况；</li>
<li>横向扩展消费者是提升消费处理能力的重要方式；</li>
<li>选择高性能的数据存储方式，配合零拷贝技术，可以提升消息的消费性能。</li>
</ul>
<p>其实，队列是一种常用的组件，只要涉及到队列，任务的堆积就是一个不可忽视的问题，很多故障都是源于此。</p>
<p>案例：某个故障，前期只是因为数据库性能衰减有少量的慢请求，结果这些慢请求占满了 Tomcat 线程池，导致整体服务的不可用。如果能对 Tomcat 线程池的任务堆积情况有实时地监控，或者说对线程池有一些保护策略，比方说线程全部使用之后丢弃请求，也许就会避免故障的发生。因此实际工作中，只要有队列就要监控它的堆积情况，把问题消灭在萌芽之中。</p>
<h1>续篇</h1>
<p><a href="https://learnku.com/articles/37482">高并发设计笔记（续篇）</a></p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/GetaChan/tags/framework_u6_49223">架构</a>
    </div>',
    'created_at' => '2019-11-23 00:51:25',
    'updated_at' => '2019-11-23 00:51:25',
  ),
  29 => 
  array (
    'title' => '在 Laravel 中使用 TypeScript 、CoffeeScript 、pug 提高开发效率',
    'review' => ' 175',
    'comment' => ' 0',
    'content' => '<p>需要的 <code>npm</code> 包</p>
<pre><code class="language-json">// package.json
"devDependencies": {
   ...
    "coffee-loader": "^0.9.0",
    "coffeescript": "^2.4.1",
    "pug": "^2.0.4",
    "pug-cli": "^1.0.0-alpha6",
    "pug-filters": "^3.1.1",
    "pug-loader": "^2.4.0",
    "resolve-url-loader": "^2.3.1",
    "sass": "^1.15.2",
    "sass-loader": "^7.3.1",
    "typescript": "^3.7.3"
},
"dependencies": {
    ...
    "pug-plain-loader": "^1.0.0",
    "ts-loader": "^6.2.1",
    "vue": "^2.6.10",
    "vue-lazyload": "^1.3.3",
    "vue-router": "^3.1.3"
}</code></pre>
<p>配置 <code>webpack.mix.js</code><br>
(仅在 vue 单文件中使用 CoffeeScript，在其余脚本文件中使用 TypeScript)</p>
<pre><code class=" language-php">mix.webpackConfig({
    module: {
        rules: [
            {
                test: /\\.pug$/,
                oneOf: [
                    {
                        resourceQuery: /^\\?vue/,
                        use: [\'pug-plain-loader\']
                    }
                ]
            },
            {
                test: /\\.scss$/,
                oneOf: [
                    {
                        resourceQuery: /^\\?vue/,
                        use: [\'sass-loader\']
                    }
                ]
            },
            {
                test: /\\.coffee$/,
                oneOf: [
                    {
                        resourceQuery: /^\\?vue/,
                        use: [\'coffee-loader\']
                    }
                ]
            },
            {
                test: /\\.ts?$/,
                loader: \'ts-loader\',
                exclude: /node_modules|vue\\/src/,
                options: {
                    appendTsSuffixTo: [/\\.vue$/]
                },
                exclude: /node_modules/,
            },
        ]
    },
    resolve: {
        extensions: [\'*\', \'.js\', \'.jsx\', \'.vue\', \'.ts\', \'.tsx\',\'.coffee\'],
    },
});

mix.ts(\'resources/js/app.ts\', \'public/js\')
    .sass(\'resources/sass/app.scss\', \'public/css\')
    .version();</code></pre>
<p>添加 <code>tsconfig.json</code> 至项目根</p>
<pre><code class="language-json">{
    "compilerOptions": {
        "module": "commonjs",
        "target": "es5",
        "noImplicitAny": false,
        "sourceMap": true
    }
}</code></pre>
<p>现在你可以在 <code>vue</code> 单文件中这样写了</p>
<pre><code class="language-vue">&lt;template lang="pug"&gt;
    .container {{ text }}
&lt;/template&gt;
&lt;style lang="scss"&gt;
    .container{
        &amp;:hover{
            border:1px solid #fff;
        }
    }
&lt;/style&gt;
&lt;script lang="coffee"&gt;
export default
    data: -&gt; 
        text:\'my text\'
&lt;/script&gt;</code></pre>
<p>GitHub ：<a href="https://github.com/DengSihan/laravel-efficient-front-end">laravel-efficient-front-end</a></p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/dsh964/tags/laravel_58">laravel</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/dsh964/tags/type_1003">type</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/dsh964/tags/coffee_3044">coffee</a>
    </div>',
    'created_at' => '2019-12-13 22:36:48',
    'updated_at' => '2019-12-13 22:36:48',
  ),
  30 => 
  array (
    'title' => '老司机带你深入理解 Laravel 之 Facade',
    'review' => ' 2080',
    'comment' => ' 16',
    'content' => '<h2>前言</h2>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/FbGHz9DsCI.png!large" alt="老司机带你深入理解Laravel之Facade"><br>
时间真的过的很快啊，今天都2019年12月2号了，准确的说，写这篇博客的时间是晚上21点40分，刚从公司加班回来，洗完澡就坐下来写这篇文章了，不知不觉除这篇博客外，我已经写了11篇了，要讲的东西实在是太多了，来日方长。今天要讲的东西，我感觉是兄弟们一直没搞懂的，那就是Laravel中非常重要的Facade，我相信凡是使用Laravel的兄弟，肯定使用过Facade了，很明显，他就是我们今天的主角了。</p>
<h2>阅读建议</h2>
<p>在阅读这篇文章之前，我希望您对Laravel的容器具有一定的使用和了解，如果不熟悉的话，请阅读<a href="https://learnku.com/docs/laravel/6.x/container">Laravel容器</a>，这方面的知识对于理解我今天要讲的东西非常有必要，再次提醒一下各位，这篇博文容量很大，仔细体会消化，希望能有所收获。</p>
<h2>注册Facade</h2>
<p>如果你使用过第三方的composer包，它会提醒你，把它的ServiceProvider和Facade写入到config/app.php文件中，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/hv6qkd2q20.png!large" alt="老司机带你深入理解Laravel之Facade"><br>
当然了，注册Facade和ServiceProvider不止这么一种方式，你感兴趣的话，可以看看官方的文档有很清楚的描述，<a href="https://learnku.com/docs/laravel/6.x/packages#package-discovery">开发第三方Laravel包</a>。</p>
<p>这些东西都没啥可说的，如果我就说这些，也许兄弟们会说，我都知道，你还说个啥？也确实，如果就说这个，我也不好意思了，可是，后面的内容就不那么容易了。</p>

<p>为了给兄弟们讲Facade，我还是大致的给大家讲解一下Laravel的引导过程（只关注与Facade有关的部分），大家都知道Laravel的入口文件为public/index.php，下面的这行代码很关键。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/WIdWkcpzwa.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>那么这个文件干啥了呢？现在我们只关心下面这两行：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/jbCeHpNUjD.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>上面创建了一个Application类的对象，这个类代表了我们当前的应用程序，也是整个Laravel最为核心的类，注意了Application类继承自Container类（这个类就是Laravel容器的核心），所以我们可以在Application类的对象上操作容器的方法，这就是为啥我在这篇博文的开头，提醒大家需要一定的容器的知识。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/e8JvZW20GP.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>上面的这段代码，向容器中添加了一个单例，所以当我们创建Illuminate\\Contracts\\Http\\Kernel::class对象的时候，实际上是创建的App\\Http\\Kernel::class类的对象，这一点极其重要，希望大家一定要记住，这在后面会使用到。</p>
<p>回到index.php文件中，继续看下面这行代码：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/DznKGAb87C.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>Illuminate\\Contracts\\Http\\Kernel::class指向的是谁啊？不就是我们上面说的App\\Http\\Kernel::class，这个文件的位置如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/O7QeWlqogS.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这个Kernel就是我们的目标了，我们打开看一下这个文件：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/CmHC8XRTrU.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这个Kernel类继承自了Illuminate\\Foundation\\Http\\Kernel类，兄弟们记住这一点，后面会使用到，下面我们回到index.php文件中，laravel调用：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/IrAVKwPpM8.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>$kernel的handle方法被调用，通过上面的分析，我们知道这个handle方法属于Illuminate\\Foundation\\Http\\Kernel类的，对于我们分析Facade来说，只有一行代码是关键的，就是下面：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/Y3Cu1aIL2h.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>我们看一下这个方法sendRequestThroughRouter，我们不必关心它的参数$request是啥，它对我们分析当前的目标一点儿关系都没有，这个函数中也只有一行是我们关心的，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/GrkbZu82Bj.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>bootstrap方法很简单，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/eFrc86Pvsx.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这里首先调用bootstrappers方法，这个方法的返回值是一个数组，它的内容如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/WFtA61sDVE.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>上面这个我们只需要关心RegisterFacades类，回到bootstrap方法中，它调用app-&gt;bootstrapWith方法，这里的app是谁呢？他就是Application类的对象，这个对象在整个Laravel的生命周期中是唯一的，因为他是单例的，既然知道这个了，我们看Application对象的bootstrapWith方法。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/8QA5TNK9TE.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>还记得我们的Application类继承自Container类么？所以它可以使用make方法，上面说了，我们当前只关心RegisterFacades这个bootstrapper，所以，我们进入到这个类的bootstrap方法：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/wSYOWBsk6S.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/7hkwzbFGM8.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>因为这篇博文主要给大家讲解Facade的整个实现的，所以我会忽略掉一些细节，关于这些细节，以后我会给大家讲解，但是在这里我会先说明他们的作用。上面这张图，我已经标注了序号，序号1这行代码返回了config/app.php文件的aliases字段值，我们自己的Facade就注册在了这个地方，在这篇博文的开头，我已经给大家说过了。序号2的作用是干啥呢？还记得我开始说的么？当我们开发laravel包的时候，可以让laravel自动加载我们的ServiceProvider和Facade，我们所要做的就是在我们的composer.json中，加入下面的这段：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/04jxdPXDsL.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>上面这个截图，大家应该可以看的很清楚，我就不再详述了，PackageManifest类的作用就是负责自动加载我们在composer.json文件中的ServiceProvider和Facade。这么说大家应该明白了吧。</p>
<p>回到RegisterFacades类的bootstrap方法中，array_merge方法合并1和2的Facade，并把它传递给AliasLoader的getInstance静态方法。<br>
这个getInstance方法返回了一个AliasLoader类的对象，下面我们看它的register方法：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/rRkfRxlrzP.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这个方法很简单，直接调用方法prependToLoaderStack，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/FyQ7iNZw03.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>spl_autoload_register这个方法可能很多人不知道，因为现在都是使用成熟的框架了，简单来说，它的作用就是负责加载我们的类文件的，你有没有好奇过，php是如何找到并加载我们的php类文件的，这当中的功臣就是spl_autoload_register了，如果你不知道它，请参考php的官方文档<a href="https://php.net/manual/en/function.spl-autoload-register.php">spl_autoload_register</a>，它的第一个参数是一个回调方法，作用就是负责加载类文件的，我们的程序中可以多次调用spl_autoload_register方法，也就是说可以注册多个加载函数，关于spl_autoload_register的介绍就这么多了，回到当前的代码中，laravel注册的自动加载函数为AliasLoader对象的load方法，我们看哈：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/oKco4JLOmj.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这个方法我们只需要看标注出来的部分，aliases属性存储着之前解析的所有的Facade，部分截图如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/LfNUDi1DWz.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>之所以我会把部分标出来，是因为我后面会用到，上面的代码中使用到了class_alias方法，这个方法是给一个类取个别名，比如说对于Illuminate\\Support\\Facades\\Route::class这个类，它的别名为Route，为了证实这一点，我们来测试一下，在我们的路由文件中，我们经常这么做：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/1Yvy0w6Vfy.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>注意了我们并没有引入Route这么一个东西，但是为啥php没报错呢？这就是我们上面给Illuminate\\Support\\Facades\\Route::class取了Route这个别名的原因，你可以把class_alias这段代码删除掉，肯定会报错的：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/lh3bVYIhfL.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>你再刷新一下页面，页面报错了，哈哈，就是这么刺激：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/yzwuHCal4v.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<h2>实例分析</h2>
<p>上面分析了Laravel的整个Facade注册的过程，是不是有点儿懵？不要慌，后面还有，任重而道远啊。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/dr7zzTJbhu.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>在Facade注册一节中，我们标注了Route这个Facade，所以这一节，就以它为例来进行讲解，Route类如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/Z6w089idM9.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>所有的Facade都继承自Illuminate\\Support\\Facades\\Facade类，并且都必须实现getFacadeAccessor这个方法，不然会抛出异常的，我们看Route的getFacadeAccessor方法如下，他返回字符串"router"，至于它的作用，我们后面会讲到：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/6oELTZ5OhM.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>为了给大家讲解后面的问题，我写了一个很简单的例子，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/fiNN0t4dnf.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>在路由文件中，我用Route注册了一个路由，这里调用了get方法，但是我们打开Illuminate\\Support\\Facades\\Facade\\Route类，这个方法是不存在的，它的父类也没有，然而我们注意到了Illuminate\\Support\\Facades\\Facade类实现了__callStatic方法，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/rapE2w2pZq.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>callStatic简单来说就是如果你调用某个类的静态方法，但是这个静态方法不存在的话，就会调用这个类的callStatic方法，如果你还是不清楚，可以网上查阅相关资料，这里不再阐述。好了，废话不多说了，我们回到Facade的__callStatic方法中，这个方法首先调用getFacadeRoute方法，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/LaNlgUXuwX.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>看到没，这里就是我上面说的Facade为啥必须实现getFacadeAccessor方法，在当前的实例中，它返回的是 "<strong>router</strong>".。<br>
resolveFacadeInstance方法是啥呢？很简单，但是我还是准备贴出来：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/02/39566/Yex9mI1sJq.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>因为Illuminate\\Support\\Facades\\Facade类是所有的Facade的父类，所以任何的Facade调用静态方法，都会进入到这个方法中，静态属性$resolvedInstance存储着当前所有被解析的Facade对应的实例对象，你要记住任何的Facade后面都有一个对象的，而且这个对象在整个Laravel程序的生命周期中是唯一的，只有这么一个实例，上面标注的1首先检查之前是否已经解析过这么一个对象，如果解析过了，直接返回就是了，这是单例的常见手法。如果之前没有解析过的话，那么代码就会走到2整个地方了，我们知道$app就是全局唯一的Application类对象，它继承了Illuminate\\Container\\Container，而Illuminate\\Container\\Container又实现了接口ArrayAccess，对于ArrayAccess接口不熟悉的同学，可以查阅相关的资料，简单来说，如果你的类实现了ArrayAccess接口，那么你就可以像获取数组元素一样，获取对象的内容而不会出错。<br><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/sZJzRHkYxL.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这个接口有几个方法必须实现，offsetGet方法是其中之一，当你采用数组的写法作用在对象上时，offsetGet会被调用，我们看Illuminate\\Container\\Container类的offsetGet方法，如下</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/Xgv9odvHtp.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>在当前情况下我们获取的是$app[\'router\']，所以这里的参数$key就是"router"，关于容器的make方法，请大家参考文档，非常简单：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/ChVY0bHjqX.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>make是容器暴露给我们获取容器注册内容的少有几个方法，好了，现在我们的疑问是我们什么时候注册了一个"router"这么一个东西，大家如果使用的是phpstorm的话，可以这么做：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/ibRULOC4I0.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>搜索内容为"router"，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/oFIZSJ1SP7.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>通过搜索我们知道，在Illuminate\\Routing\\RoutingServiceProvider这个类中，注册了router的单例，你可能会问，这段代码是啥时候调用的，也就是registerRouter方法是啥时候被调用的，当前的RoutingServiceProvider中的register方法如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/Lx0UMVVXhh.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>那么register方法是怎么被调用的呢？不知道没关系，我细细道来，在之前的laravel框架引导过程中，创建Application类实例的时候，它的构造函数如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/UjmAPVKm5W.png!large" alt="老司机带你深入理解Laravel之Facade"><br>
registerBaseServiceProviders方法如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/Tq1fwL7ev7.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>看见没，这个地方出现了RoutingServiceProvider类对象，我们再进入到Application类的register方法中，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/BOzV661JpE.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>啊哈，register方法被调用了，这个时候名为<strong>router</strong>的单例就被注册了，分析了这些，我们回到RoutingServiceProvider类的registerRouter方法中。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/O1eqJIPmhp.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这里直接返回了Illuminate\\Routing\\Router类的实例，这个实际上就是Laravel全局唯一的路由器对象，路由就是靠它来实现的，分析了这些，我们再一次回到Illuminate\\Support\\Facades\\Facade类的resolveFacadeInstance方法中。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/Txspn04x29.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>这里把解析的实例存储到$resolvedInstance属性中，这样下次就不需要解析了，resolveFacadeInstance方法调用完毕之后，返回到Facade的getFacadeRoot方法中。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/n6GL4fpu4T.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>上面也是直接返回刚才获取到的对象Router实例对象，getFacadeRoot方法调用完毕之后，继续返回到__callStatic方法中。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/NDmJV8Fevg.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<p>红色的代码就是翻译一下就是：</p>
<pre><code class=" language-php"> $router-&gt;get(\'/\',function () {
    echo "Hello World";
})</code></pre>
<p>令人欣喜的是奇迹出现了，Illuminate\\Routing\\Router类有如下的代码：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/03/39566/MmQ5kBpH4o.png!large" alt="老司机带你深入理解Laravel之Facade"></p>
<h2>总结</h2>
<p>Laravel的源代码错综复杂，理解起来不是那么容易，上面给大家标注出了主要的脉络，希望大家仔细体会和理解。不知不觉写完这篇博客已经凌晨40分了，整整三个小时，这效率还可以的哈。如果大家有什么不懂的可以联系我，我有一个qq群，感兴趣的可以加一下，如下：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201911/22/39566/LKCnzcs2gF.png!large" alt=""></p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/13249808562/tags/php_28">php</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/13249808562/tags/laravel_58">laravel</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/13249808562/tags/source-code_0b_52243">源代码</a>
    </div>
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <p>如果有不懂的地方，可以加我的qq：1174332406，或者是微信:itshardjs</p>
                                </span>
                            </div>',
    'created_at' => '2019-12-03 09:13:05',
    'updated_at' => '2019-12-03 09:13:05',
  ),
  31 => 
  array (
    'title' => '微信消息类型判断，为什么表情包是 text?',
    'review' => ' 235',
    'comment' => ' 2',
    'content' => '<pre><code class=" language-php"># Laravel &gt;= 5.8
composer require "overtrue/laravel-wechat:~5.0"</code></pre>
<pre><code class=" language-php">public function serve()
    {
        Log::info(\'request arrived.\'); # 注意：Log 为 Laravel 组件，所以它记的日志去 Laravel 日志看，而不是 EasyWeChat 日志

        $app = app(\'wechat.official_account\');
        $app-&gt;server-&gt;push(function($message) {
            return $message[\'MsgType\'];
        });

        return $app-&gt;server-&gt;serve();
    }</code></pre>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/27889/wV2OdwSsZh.png!large" alt="Laravel"></p>
<p>图片文件类型是image，表情包是text类型，有其他判断方法吗？</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/easywechat/5697">easywechat</a>
    </div>',
    'created_at' => '2019-12-13 11:00:15',
    'updated_at' => NULL,
  ),
  32 => 
  array (
    'title' => 'Alfred Workflow 一键上传图片到 GitHub 返回 Markdown',
    'review' => ' 237',
    'comment' => ' 2',
    'content' => '<h1>Alfred Workflow 一键上传图片到github</h1>
<p>有没有在写markdown时，因为想上传一张图片而苦恼？</p>
<p>现在可以直接截图后将图片上传到github，并且返回markdown格式的图片语法</p>
<blockquote>
<p><a href="https://github.com/sunshinev/markdown-image-upload-github" target="_blank">https://github.com/sunshinev/markdown-imag...</a></p>
</blockquote>
<p><strong>注意</strong>：Pillow模块不支持从剪贴板获取gif图片，所以目前不支持gif上传</p>
<p><img src="https://github.com/sunshinev/remote_pics/raw/master/kapture-alfred.gif" alt="image"></p>
<h2>运行环境</h2>
<p>Alfred + Mac  </p>
<h2>支持图片类型</h2>
<ul>
<li>JPG</li>
<li>PNG</li>
</ul>
<h2>工作原理</h2>
<ol>
<li>使用Alfred热键功能触发Workflow工作流程，执行Python脚本。</li>
<li>使用Pillow模块从剪贴板Clipboard中获取<code>jpg/png</code>图片文件，并且移动到<code>project_path</code>目录下</li>
<li>提交<code>project_path</code>目录下的文件到github仓库</li>
</ol>
<h2>安装</h2>
<p>安装python的Pillow模块</p>
<pre><code class=" language-php">pip install Pillow</code></pre>
<p>下载Alfred的Workflow并打开安装</p>
<p><a href="https://github.com/sunshinev/markdown-image-upload-github/raw/master/alfred_workflow/Markdown%20image%20upload%20github.alfredworkflow">下载Markdown-image-upload-github</a></p>
<h2>配置</h2>
<p>打开Alfred的Workflow配置脚本的变量</p>
<table>
<thead><tr>
<th>配置项</th>
<th>说明</th>
</tr></thead>
<tbody>
<tr>
<td>github_repo</td>
<td>图床仓库名称</td>
</tr>
<tr>
<td>github_username</td>
<td>用户名</td>
</tr>
<tr>
<td>project_path</td>
<td>本地的图床项目路径</td>
</tr>
</tbody>
</table>
<p><strong>注意</strong>：请先确保<code>project_path</code>对应的<code>Github</code>项目可以正常使用git命令操作</p>
<p><img src="https://github.com/sunshinev/remote_pics/raw/master/kapture-alfred2.gif" alt="image"></p>
<h2>上传图片</h2>
<p>上传图片支持两种方式，一种是截取图片到剪贴板、另外一种是直接复制图片文件</p>
<h3>截取图片到剪贴板（微信截图、mac自带截图工具）</h3>
<ol>
<li>截取图片到剪贴板</li>
<li>command+g</li>
</ol>
<h3>复制jpg、png文件</h3>
<ol>
<li>复制图片文件</li>
<li>command+g</li>
</ol>
<h2>Fork 建议</h2>
<h3>能否支持其他git仓库呢？可以的</h3>
<p>因为脚本的上传动作完全是由下面的git命令完成的，推送到远端仓库</p>
<pre><code class="language-python">    # Git
    cmd = \'\'\'
    cd {}
    git add .
    git commit -m \'clipboard\'
    git push\'\'\'.format(self.project_path)</code></pre>
<p>所以我们只需要，保证<code>project_path</code>的仓库是支持git命令即可，比如可以提交到gitLab自己搭建的仓库等。</p>
<h3>能否支持gif图片呢？</h3>
<ol>
<li>目前Pillow不支持gif上传</li>
<li>如果采用<code>Pyobjc</code>的<code>AppKit</code>模块中的<code>NSPasteboard</code>，会受到操作系统版本的影响，可能需要安装最新的Pyobjc</li>
</ol>
<h2>相关资料</h2>
<p><a href="https://www.alfredapp.com/help/workflows/advanced/variables/">Using Variables in Workflows</a></p>
<p><a href="https://www.alfredapp.com/help/workflows/">Overview: What are workflows?</a></p>
<p><a href="https://github.com/kaito-kidd/markdown-image-alfred">《快速上传图片到七牛云空间kaito-kidd/markdown-image-alfred》</a> </p>',
    'created_at' => '2019-12-11 21:11:50',
    'updated_at' => '2019-12-11 21:11:50',
  ),
  33 => 
  array (
    'title' => 'Swoole 学习之基于 Websocket 弹幕的实现',
    'review' => ' 615',
    'comment' => ' 4',
    'content' => '<p><img src="https://cdn.learnku.com/uploads/images/201912/12/26855/lP0VGIWodO.jpeg!large" alt="Swoole 学习之基于 Websocket 弹幕的实现"></p>
<h3>开篇</h3>
<p>基于我上篇关于学习的规划，最近给自己的学习计划就是 <code>Swoole</code> 。然后做一些有趣的 <code>demo</code>。毕竟平常开发除了用用第三方队列，其他时间都是在写同步阻塞的代码。这篇文章基于 <code>Websocket</code> 协议，利用了 <code>Swoole</code> 中的 异步任务 <code>Task</code> 以及 毫秒精度的 <code>Timer</code> 定时器。这些知识点我会在后面的学习中指出。至于 <code>Swoole</code> 的一些介绍，例如启动时开启了哪些进程，线程，他们各自的职责，它的运行流程，我想没有比官方介绍还官方的吧。另外，如果文章哪里写的不对的，请一定慷慨指出。</p>
<h3>谈谈Websocket</h3>
<p>对于 <code>Websocket</code> 协议，这位老哥Dennis_Ritchie这篇文章就写的很好，<a href="https://learnku.com/articles/36471">老司机带你用 PHP 实现 Websocket 协议</a>，文章不能只看，要动手实验，不然你哪知道别人是不是在坑你哈哈哈，其实学习是从模仿开始的，就像社区的课程，不得不说，质量很高，我今年入门  <code>Laravel</code> 的时候就是买的课程，本质上不也是一个模仿学习的过程吗，最后自己再进行一些扩展，简直完美。扯远了...... ,另外为了方便下文，对于 <code>Websocket</code> 我统称 <code>ws</code>。</p>
<p><code>ws</code> 是 H5 规范中的一个部分,为 web 应用程序客户端和服务器端提供全双工的通信方式，它也是新的一种应用层协议。通常它的表现为: <code>ws://echo.websocket.org/?encoding=text HTTP/1.1</code> 可以看出除了最前面的协议名和 <code>HTTP</code> 不同，其他看起来就是一个url地址。</p>
<p><code>ws</code>和<code>http</code> 之间的联系。<br><img src="https://cdn.learnku.com/uploads/images/201912/11/26855/cRwZkRiTRW.jpeg!large" alt="Swoole学习之弹幕实现"></p>
<p><code>ws</code> 的目的是取代 <code>HTTP</code> 在双向通信场景下的使用。首先他们都位于OSI模型中的最高层:应用层。<code>ws</code> 借助 <code>HTTP</code> 完成连接，客户端的握手消息就是一个「普通的，带有Upgrade头的，HTTP Request消息」。对于 <code>HTTP</code> 来说，就是一个你问我答的模式: <code>Request/Response</code>,就算实现了 <code>HTTP</code> 的长连接，它的底层依旧是你问我答。只是保持住了长连接的一条线，是阻塞的 <code>I/O</code>，但是 <code>ws</code> 就不一样了，握手成功之后就是全双工的 TCP 通道，服务器端可以主动的发送消息给客户端。在 <code>ws</code> 出来之前，很多都是使用的轮训来实现实时交互一些业务场景。</p>
<h3>Websocket 和 HTTP 相同点和不同点</h3>
<blockquote>
<p>相同点</p>
<ol>
<li>
<blockquote>
<p>都是基于应用层的协议</p>
</blockquote>
</li>
<li>
<blockquote>
<p>都使用 Request/Response 模式建立连接</p>
</blockquote>
</li>
<li>
<blockquote>
<p>在连接建立过程中，对错误的处理方式相同</p>
</blockquote>
</li>
<li>
<blockquote>
<p>都可以在网络中传输数据</p>
</blockquote>
</li>
</ol>
<p>不同点</p>
<ol>
<li>
<blockquote>
<p>ws 使用 HTTP 建立连接，但是定义了新的一系列头域，这些域在 HTTP 中不会使用</p>
</blockquote>
</li>
<li>
<blockquote>
<p>ws的连接不能通过中间人来进行转发，必须是一个点对点的连接</p>
</blockquote>
</li>
<li>
<blockquote>
<p>ws连接之后，通信的双方都可以随时给另一方发送数据</p>
</blockquote>
</li>
<li>
<blockquote>
<p>ws连接之后，数据的传输是通过桢的形式发送的，不再需要Request</p>
</blockquote>
</li>
</ol>
</blockquote>
<h3>弹幕</h3>
<p>直播不用我说了吧。都懂的吧，在看直播的时候，你可以看到屏幕前各种...好吧，暂且用一个不堪入目来形容评论emmm。用了 <code>ws</code> 那就简单了。客户端发送弹幕，转交给 <code>ws</code> 服务器，<code>ws</code> 服务器做了一些处理，然后再广播给所有在这个直播间的人。也就实现了，边看直播边看评论的这一幕。当然，市面上一些直播应用，基本上在安全方面做了很多功夫，毕竟一个用于生产上的 <code>im</code>，背后一点都不简单。插一句，如果像是聊天室这种对应可能对应到指定的人，可以用 <code>redis</code> 做一些 <code>uid</code> 和 <code>fd</code> 的双向绑定即可。</p>
<h3>效果图</h3>
<p>既然开始了，还是先看看效果图吧,gif文件可能有点大，加载会慢一点。然后再具体说一下实现过程。</p>
<p>发送弹幕(单条)</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/12/26855/Ygq3TNiwtV.gif!large" alt="Swoole 学习之基于 Websocket 弹幕的实现"></p>
<p>发送弹幕(批次)</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/12/26855/6buy2Dbfz5.gif!large" alt="Swoole 学习之基于 Websocket 弹幕的实现"></p>
<p>Task</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/12/26855/JyjgB3WyhM.gif!large" alt="Swoole 学习之基于 Websocket 弹幕的实现"></p>
<h4>服务端代码</h4>
<pre><code class=" language-php">&lt;?php

class WebsocketServer
{
    protected $server;

    public function __construct()
    {
        $this-&gt;server = new \\Swoole\\WebSocket\\Server(\'swoolefor.test\', 9508);
        $this-&gt;server-&gt;set([
            \'worker_num\' =&gt; 4,
            \'task_worker_num\' =&gt; 3,
            \'max_request\' =&gt; 5,
        ]);
        $this-&gt;server-&gt;on(\'open\', [$this, \'onOpen\']);
        $this-&gt;server-&gt;on(\'message\', [$this, \'onMessage\']);
        $this-&gt;server-&gt;on(\'task\', [$this, \'onTask\']);
        $this-&gt;server-&gt;on(\'finish\', [$this, \'onFinish\']);
        $this-&gt;server-&gt;on(\'close\', [$this, \'onClose\']);
        $this-&gt;server-&gt;start();
    }

    public function onOpen($server, $reuqest)
    {
        $this-&gt;server-&gt;task([\'message\' =&gt; "路人: " . $reuqest-&gt;fd . \'上线了\', \'type\' =&gt; 1]);
    }

    public function onMessage($server, $frame)
    {
        $info = json_decode($frame-&gt;data);
        if ($info-&gt;type == 3) {
            $task_id = \\Swoole\\Timer::tick(200, function () use ($info, $frame) {
                return $this-&gt;server-&gt;task([\'message\' =&gt; $frame-&gt;fd . \' 说\' . $info-&gt;message]);
            });
        } else {
            $task_id = $this-&gt;server-&gt;task([\'message\' =&gt; $frame-&gt;fd . \' 说\' . $info-&gt;message]);
        }
        echo "任务id:{$task_id}投递成功!" . PHP_EOL;
    }

    public function onTask($server, $task_id, $from_id, $data)
    {
        foreach ($this-&gt;server-&gt;connections as $fd) {
            if ($this-&gt;server-&gt;isEstablished($fd)) {
                $this-&gt;server-&gt;push($fd, json_encode([\'message\' =&gt; $data[\'message\']]));
            }
        }
        $this-&gt;server-&gt;finish($data);
    }

    public function onFinish($server, $task_id, $data)
    {
        echo \'任务: \' . $task_id . \' 执行完毕\' . PHP_EOL;
    }

    public function onClose($server, $fd)
    {
        $this-&gt;server-&gt;task([\'message\' =&gt; \'路人: \' . $fd . \' 下线了\' . PHP_EOL, \'type\' =&gt; 4]);
    }

}

$demo = new WebsocketServer();
</code></pre>
<p>其实就是一个很简单的 demo。先看构造函数这一块吧</p>
<pre><code class=" language-php">$this-&gt;server = new \\Swoole\\WebSocket\\Server(\'swoolefor.test\', 9508);
        $this-&gt;server-&gt;set([
            \'worker_num\' =&gt; 4,
            \'task_worker_num\' =&gt; 3,
            \'max_request\' =&gt; 5,
        ]);
        $this-&gt;server-&gt;on(\'open\', [$this, \'onOpen\']);
        $this-&gt;server-&gt;on(\'message\', [$this, \'onMessage\']);
        $this-&gt;server-&gt;on(\'task\', [$this, \'onTask\']);
        $this-&gt;server-&gt;on(\'finish\', [$this, \'onFinish\']);
        $this-&gt;server-&gt;on(\'close\', [$this, \'onClose\']);
        $this-&gt;server-&gt;start();</code></pre>
<p>首先实例化一个 <code>ws</code> 服务，<code>Swoole</code> 内置了对 <code>ws</code> 这个服务的支持。通过几行代码就能写出一个异步非阻塞的多进程 <code>ws</code> 服务。简单的介绍一下其他的，一开始的 <code>open</code> 事件名，它的回调是 <code>onOpen</code>，当 <code>ws</code> 客户端与服务器建立连接并完成握手后会回调此函数 。<code>WebSocket\\Server</code> 继承自 <code>Http\\Server</code>，所以 <code>WebSocket\\Server</code> 也可以同时作为 <code>HTTP</code> 服务器。另外，使用了 <code>WebSocket\\Server</code> 服务器，那么 <code>onMessge</code> 回调是必须的。即上面的 <code>$this-&gt;server-&gt;on(\'message\', [$this, \'onMessage\'])</code>。</p>
<p>我们先来看看握手这一块。</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/12/26855/IufxeNnzpe.png!large" alt="Swoole 学习之基于 Websocket 弹幕的实现"></p>
<p>握手成功，最终服务端的响应吗是 101,这里我主要说下在握手过程中起作用的几个 <code>header</code> 域：</p>
<blockquote>
<p>Upgrade：upgrade是HTTP1.1中用于定义转换协议的header域。它表示，如果服务器支持的话，客户端希望使用&gt; &gt; 现有的「网络层」已经建立好的这个「连接（此处是TCP连接）」，切换到另外一个「应用层」（此处是WebSocket）协议。<br>
Connection：HTTP1.1中规定Upgrade只能应用在「直接连接」中，所以带有Upgrade头的HTTP1.1消息必须含有Connection头，因为Connection头的意义就是，任何接收到此消息的人（往往是代理服务器）都要在转发此消息之前处理掉Connection中指定的域（不转发Upgrade域）。如果客户端和服务器之间是通过代理连接的，那么在发送这个握手消息之前首先要发送CONNECT消息来建立直接连接。<br>
Sec-WebSocket-＊：<code>Sec-WebSocket-Version</code> 告诉服务器所使用的 <code>WebSocket Draft</code>(版本协议) ，<code>Sec-WebSocket-Key</code> 用来发送给服务器使用（服务器会使用此字段组装成另一个key值放在握手返回信息里发送客户端。<br>
Origin：作安全使用，防止跨站攻击，浏览器一般会使用这个来标识原始域。</p>
</blockquote>
<p>至于底下的两个事件，其实就是我们的异步任务，这些以及上面的设置参数，我会在后续的文章中说明。所以这里的整个流程就是，不管是连接成功 <code>onOpen</code>，还是发送消息 <code>onMessage</code>, 再或者是关闭连接 <code>onClose</code>，我们的向所有连接的用户推送消息。<code>$this-&gt;server-&gt;connections</code> 就是遍历所有 <code>ws</code> 连接的用户，至于下面的 <code>isEstablished</code> 就是进一步判断是否是正确的 <code>ws</code> 连接，否则可能会推送失败。至于推送的操作，<code>push($fd,$data)</code> ，第一个参数就是客户端的 <code>fd</code>,如果此连接并非 <code>ws</code> 客户端，那么推送将失败。第二个参数就是推送的内容，格式化了数据。第三个参数可以指名发送内容的格式，默认是文本，如果想发送二进制的格式，可以使用 <code>WEBSOCKET_OPCODE_BINARY</code>。然后你可以看到，我们的批量弹幕的实现：</p>
<pre><code class=" language-php">
    public function onMessage($server, $frame)
    {
        $info = json_decode($frame-&gt;data);
        $task_id = $this-&gt;server-&gt;task([\'message\' =&gt; $frame-&gt;fd . \' 说\' . $info-&gt;message, \'type\' =&gt; $info-&gt;type]);
        echo "任务id:{$task_id}投递成功!" . PHP_EOL;
    }

    public function onTask($server, $task_id, $from_id, $data)
    {
        if ($data[\'type\'] == 3) {
            \\Swoole\\Timer::tick(1000, function () use ($data) {
                $this-&gt;sendAll($data);
            });
        } else {
            $this-&gt;sendAll($data);

        }
    }</code></pre>
<p>首先，我是以客户端提交数据的 <code>type</code> 值来确定消息类型的，当 <code>type=3</code> 的时候，就是批量弹幕，那么这里我使用了 <code>Swoole</code> 中提供的牛逼的毫秒精度定时器，所以上面的意思就是当收到客户端的消息，每0.2秒投放一个队列任务，把消息广播给所有的人。至于 <code>Timer</code>，我也会在后续文章中以例题+思考题的形式介绍。并不在本篇文章的范围内。</p>
<p>至于客户端的代码，我就不贴了，代码全上传到 <code>github</code> 了，后续所有的文章都会放到这个仓库里，你可以自己 <code>clone</code> 一份运行，地址在:<a href="https://github.com/wuqinqiang/swooleForYou">Swoole-for-you</a>。</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/Remember/tags/swoole_442">swoole</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/Remember/tags/php_28">php</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/Remember/tags/websocket_2887">websocket</a>
    </div>
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <p>吴亲库里</p>
                                </span>
                            </div>',
    'created_at' => '2019-12-12 08:53:49',
    'updated_at' => '2019-12-12 08:53:49',
  ),
  34 => 
  array (
    'title' => '关于 MySQL，limit 1 的机制问题',
    'review' => ' 271',
    'comment' => ' 6',
    'content' => '<h1>出现的情景</h1>
<p>以下有两条 sql 语句，第一条</p>
<p><code>SELECT * FROM g_1242_award where a_uid = 0 and a_start &lt; 1576215393 and a_awardid in (3,4);</code></p>
<p>查询结果如下</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/6762/WP1lAFqsfO.png!large" alt="关于mysql，limit 1的机制问题"></p>
<p>另外一条</p>
<p><code>SELECT * FROM g_1242_award where a_uid = 0 and a_start &lt; 1576215393 and a_awardid in (3,4) limit 1;</code></p>
<p>查询结果如下</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/6762/zeWeXynDST.png!large" alt="关于mysql，limit 1的机制问题"><br>
可以看到，第一条 sql 查询出来的第一条数据，主键为 <code>2</code> 的数据！</p>
<p><strong>为何增加 <code>limit 1</code> 条件后，会查询出主键为 <code>20</code> 的数据？</strong></p>
<h1>疑问</h1>
<p>从查询出的数据来理解，加了 limit 条件之后，mysql 对 <code>a_award_id</code> 字段进行了排序，然后 取出了第一条数据！这是 mysql 底层做的处理吗？为何是这样的处理呢？</p>',
    'created_at' => '2019-12-13 14:35:17',
    'updated_at' => NULL,
  ),
  35 => 
  array (
    'title' => 'Laravel-Gii Visual code generation tool CRUD + GUI',
    'review' => ' 150',
    'comment' => ' 1',
    'content' => '<h1>Laravel-Gii Visual code generation tool CRUD + GUI</h1>
<p>It is suitable for rapid B-side background development, and generates corresponding Model, Observer, Controller, View, Route and other related project files according to the MySQL table structure.</p>
<p><a href="https://github.com/sunshinev/laravel-gii/blob/master/README_zh_CN.md">中文文档</a><br><img src="https://github.com/sunshinev/remote_pics/raw/master/laravel-gii/gii-model-preview.gif" alt="image"></p>
<p>[TOC]</p>
<h2>Installation</h2>
<h3>Expansion Pack</h3>
<pre><code class=" language-php">Composer require sunshinev/laravel-gii -vvv</code></pre>
<h3>Post</h3>
<blockquote>
<p>This operation will publish assets static files to the public directory</p>
</blockquote>
<pre><code class=" language-php">php artisan vendor: publish</code></pre>
<p>select<br><code>Tag: laravel-gii</code></p>
<h3>Visit</h3>
<p><code>http: [domain]/gii/model</code></p>
<h2>Instructions</h2>
<h3>Generate Model</h3>
<p>Form description</p>
<ol>
<li>Table name (support drop-down selection)</li>
<li>Model class name (want to create model classes, including namespaces)</li>
<li>Parent class of model inheritance (If it is Mongo, it can inherit <code>Jenssegers \\ Mongodb \\ Eloquent \\ Model</code>, MySQL uses<code>Illuminate \\ Database \\ Eloquent \\ Model</code>)</li>
</ol>
<p>The generated file list, blue represents a new file, red represents an existing file but different, and white represents an existing file.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/6570/6GxshFa7lO.jpeg!large" alt="07656dfd51458bb03cb50825aef4fbc01576222008.jpg"></p>
<h3>Generate CRUD</h3>
<p>The creation of CRUD depends on the previously created model.</p>
<p>This operation will also generate:</p>
<ul>
<li>route</li>
<li>controller</li>
<li>views</li>
</ul>
<p>Form description</p>
<ol>
<li>Controller name (including namespace)</li>
<li>The model class created earlier</li>
</ol>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/6570/RsqM5h1Pmq.jpeg!large" alt="85bce766f1a574d97ac931c8b98c29591576222771.jpg"></p>
<h2>Features</h2>
<h4>MySQL list loading</h4>
<p>Pull list from configured MySQL database<br><img src="https://cdn.learnku.com/uploads/images/201912/13/6570/6LdEilNz7j.jpeg!large" alt="135efc4b0abc7a7baf67793fb8de30901576222494.jpg"></p>
<h4>File comparison</h4>
<p>The tool will compare the newly generated file with the existing file, which is convenient for viewing the modified part and controlling the scope of the modification.</p>
<p><img src="https://github.com/sunshinev/remote_pics/raw/master/laravel-gii/gii-generate.gif" alt="image"></p>
<h4>Route Append</h4>
<p>Newly generated pages are automatically appended to the routing configuration file<br><img src="https://cdn.learnku.com/uploads/images/201912/13/6570/V1SjMqb2La.jpeg!large" alt="b58eb0bd955bafea27540d6227e611731576209355.jpg"></p>
<h2>CRUD background effects</h2>
<h4>List</h4>
<p>Includes comprehensive additions, deletions, and changes</p>
<ul>
<li>List</li>
<li>Pagination</li>
<li>Retrieve</li>
<li>Delete + batch delete</li>
<li>Preview</li>
<li>Details</li>
<li>Edit</li>
</ul>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/6570/632PfR26Iv.jpeg!large" alt="a7124e651545e7f462e898ffb37704a41576223115.jpg"></p>
<h4>delete + batch delete</h4>
<p>Cancel button zoom in to prevent accidental deletion</p>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/6570/zplsV5qqnc.jpeg!large" alt="fa926f38e95888fd4a3c3aa055d202f41576223165.jpg"></p>
<h4>Row Preview</h4>
<p><img src="https://github.com/sunshinev/remote_pics/raw/master/0b2b1603c043aec9b5cee84a17e26f291576223207.jpg" alt="0b2b1603c043aec9b5cee84a17e26f291576223207.jpg"></p>
<h4>Edit page</h4>
<p><img src="https://cdn.learnku.com/uploads/images/201912/13/6570/450DY1D6A0.jpeg!large" alt="bc43b30f13de17e0a2a899a59f647d3a1576223248.jpg"></p>
<h2>Suggest</h2>
<h4>What if you want to use Mongo?</h4>
<p>If the Model is generated, the connection configured in the env will be used by default. If you need to adjust, you need to modify the generated Model file.</p>
<pre><code class="language-php">    // if connection is empty, use default connection
    protected $ connection = \'\';</code></pre>
<h4>How do background pages support other components?</h4>
<p>The background page uniformly uses iview as the front-end framework. Currently, all components of iview4 are supported. You can add components directly to the generated blade template file.</p>
<p><a href="https://www.iviewui.com/docs/introduce">iviewuidocument</a></p>
<h4>How to upgrade the iview component of the page?</h4>
<p>The generated CRUD background is based on <a href="https://github.com/sunshinev/laravel-fe-render">laravel-fe-render</a> and [base-fe](<a href="https://github.com/sunshinev/base" target="_blank">https://github.com/sunshinev/base</a> -fe) Two projects, of which <code>base-fe</code> is a package of Vue + iview, as follows:</p>
<pre><code class="language-js">import Vue from \'vue\'
import ViewUI from \'view-design\';
import \'view-design/dist/styles/iview.css\';
Vue.use (ViewUI);</code></pre>
<p>You can Fork the <code>base-fe</code> project, and then upgrade the iview. Place the generated dist directory in the<code>assets</code> directory of the <code>laravel-fe-render</code> project, and then republish it.</p>
<h2>Relevant information</h2>
<p><a href="https://github.com/sunshinev/laravel-fe-render" target="_blank">https://github.com/sunshinev/laravel-fe-re...</a></p>
<p><a href="https://github.com/sunshinev/base-fe" target="_blank">https://github.com/sunshinev/base-fe</a></p>
<p><a href="https://github.com/sunshinev/laravel-gii" target="_blank">https://github.com/sunshinev/laravel-gii</a></p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/sunshinev/tags/gii_664">gii</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/sunshinev/tags/laravel_58">laravel</a>
    </div>',
    'created_at' => '2019-12-13 15:54:17',
    'updated_at' => '2019-12-13 15:54:17',
  ),
  36 => 
  array (
    'title' => 'Eloquent ORM 的模型关联是不是过度设计了',
    'review' => ' 1580',
    'comment' => ' 15',
    'content' => '<p>如题，看了下文档，觉得模型关联这块比预想的要繁杂的多，有一定的阅读和学习成本，而且这样设计丧失了灵活性呀，有点没必要</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/eloquent-orm/10996">Eloquent ORM</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/laravel/58">laravel</a>
    </div>',
    'created_at' => '2019-12-05 17:33:43',
    'updated_at' => NULL,
  ),
  37 => 
  array (
    'title' => 'Laravel5.8.*如何实现多个字段唯一性验证？',
    'review' => ' 617',
    'comment' => ' 9',
    'content' => '<p>表中有3个字段：link_en、link_zh、link_github。都是用来保存 url 的。添加数据的时候如何验证数据库唯一。比如 link_en 里已存在“<a href="https://baidu.com/" target="_blank">https://baidu.com/</a>”， 那么，如果再往 link_zh 字段添加同样的值，则不通过。</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/uniqueness_QK/51670">唯一性</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/zi-duan/51671">字段</a>
    </div>',
    'created_at' => '2019-09-26 11:40:30',
    'updated_at' => NULL,
  ),
  38 => 
  array (
    'title' => 'Laravel 如何使用 vendor 里面的包的？',
    'review' => ' 258',
    'comment' => ' 4',
    'content' => '<p>使用composer require下载了包到vendor目录中，那如何在控制器中使用包呢，<br>
是用require 绝对路径到autoload.php 这种做法吗？</p>',
    'created_at' => '2019-12-13 10:20:27',
    'updated_at' => NULL,
  ),
  39 => 
  array (
    'title' => 'Laravel-S 项目之初体验',
    'review' => ' 2080',
    'comment' => ' 8',
    'content' => '<h4>一、前言</h4>
<p>最近看到社区里很多人都在讨论 <code>Laravel-S</code>，我也去 Github 上查看了一下该项目，其实 <code>Laravel-S</code> 是快速集成 <code>Swoole</code> 到 <code>Laravel</code> 或 <code>Lumen</code>，然后赋予它们更好的性能、更多可能性的一个胶水项目。我今天正好空闲下来，心想还是测试一波，看看性能会不会有提升呢？</p>
<h4>二、创建 Laravel 项目</h4>
<h5>1、新建项目</h5>
<pre><code class=" language-php">laravel new laravel-S</code></pre>
<p>或者使用 </p>
<pre><code class=" language-php">composer create-project laravel/laravel laravel-S --prefer-dist "6.2.*"</code></pre>
<p>进行新建项目</p>
<h5>2、配置好 <code>.env</code> 文件</h5>
<p>配置如下：</p>
<pre><code class=" language-php">APP_NAME=laravel-s
APP_ENV=local
APP_KEY=base64:aQ/ykVTPt/++KGQ27oRw6Y3SeACoCyzJOHaNlSumymY=
APP_DEBUG=true
APP_URL=http://laravel-s.test

LOG_CHANNEL=stack

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel_s
DB_USERNAME=root
DB_PASSWORD=root

BROADCAST_DRIVER=log
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
SESSION_DRIVER=file
SESSION_LIFETIME=120

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_DRIVER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=

PUSHER_APP_ID=
PUSHER_APP_KEY=
PUSHER_APP_SECRET=
PUSHER_APP_CLUSTER=mt1

MIX_PUSHER_APP_KEY="${PUSHER_APP_KEY}"
MIX_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"
</code></pre>
<p><strong>注意：这里主要配置好数据库连接和 <code>APP_URL</code>，其他的配置项，新建项目时默认带有了</strong></p>
<h5>3、配置Nginx服务器</h5>
<p>新建一个 <code>Nginx</code> 配置文件，写入如下配置（这里根据你自己的项目配置，能访问到项目即可）<br>
我的 <code>Nginx</code> 配置文件如下：</p>
<pre><code class=" language-php">server {
        listen 80;
        client_max_body_size 512m;
        root /Users/liangguifeng/www/laravel-S/public;
        index index.php index.html index.htm;
        server_name laravel-s.test;
        location / {
                try_files $uri $uri/ /index.php?$query_string;
        }
        location ~ \\.php$ {
                try_files $uri /index.php =404;
                fastcgi_split_path_info ^(.+\\.php)(/.+)$;
                fastcgi_pass 127.0.0.1:9000;
                fastcgi_index index.php;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                include fastcgi_params;
        }
        location ~ /\\.ht {
                deny all;
        }
}</code></pre>
<h5>4、初次访问我们的项目，如下图，那么基本的配置就完成了</h5>
<p><img src="https://cdn.learnku.com/uploads/images/201911/05/27828/BIUhbO37WU.png!large" alt="Laravel"></p>
<h4>三、安装laravel-S胶水项目到我们的 Laravel 项目上</h4>
<h5>1、通过 <code>Composer</code> 安装</h5>
<pre><code class=" language-php">composer require "hhxsv5/laravel-s:~3.5.0" -vvv</code></pre>
<h5>2、注册 <code>Service Provider</code>（以下两步二选一）。</h5>
<ul>
<li>
<p><code>Laravel</code>: 修改文件<code>config/app.php</code>，<code>Laravel 5.5+支持包自动发现，你应该跳过这步</code></p>
<pre><code class="language-php">\'providers\' =&gt; [
    //...
    Hhxsv5\\LaravelS\\Illuminate\\LaravelSServiceProvider::class,
],</code></pre>
</li>
<li>
<p><code>Lumen</code>: 修改文件<code>bootstrap/app.php</code></p>
<pre><code class="language-php">$app-&gt;register(Hhxsv5\\LaravelS\\Illuminate\\LaravelSServiceProvider::class);</code></pre>
</li>
</ul>
<h5>3、发布配置和二进制文件。</h5>
<pre><code class=" language-php">php artisan laravels publish</code></pre>
<h5>4、运行</h5>
<pre><code class=" language-php">php bin/laravels start</code></pre>
<h5>5、运行成功后如图：</h5>
<p>运行结果：<br><img src="https://cdn.learnku.com/uploads/images/201911/05/27828/JKw1tR5dz9.png!large" alt="Laravel-S 项目之初体验"><br>
访问成功：<br><img src="https://cdn.learnku.com/uploads/images/201911/05/27828/kiZoXvZH4Y.png!large" alt="Laravel-S 项目之初体验"></p>
<h4>四、执行ab压测</h4>
<h5>1、新开一个命令行窗口，测试Nginx服务器下Laravel的并发量：</h5>
<p>命令如下：</p>
<pre><code class=" language-php">ab -n 2000 -c 100 http://laravel-s.test/</code></pre>
<p><strong>注意：上面那个命令一般是我们最常用的的，意思是对 <a href="http://laravel-s.test/" target="_blank">http://laravel-s.test/</a> 的主页发送 2000 个请求 (-n 代表发多少请求) 100 个并发 (-c 代表并发的请求)</strong></p>
<p>测试如图：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201911/05/27828/slLFDNbbOA.png!large" alt="Laravel-S 项目之初体验"></p>
<h5>2、然后继续测试继承laravel-S的laravel</h5>
<p>命令如下：</p>
<pre><code class=" language-php">ab -n 2000 -c 100 http://127.0.0.1:5200/</code></pre>
<p><strong>注意：上面那个命令一般是我们最常用的的，意思是对 <a href="http://laravel-s.test/" target="_blank">http://laravel-s.test/</a> 的主页发送 2000 个请求 (-n 代表发多少请求) 100 个并发 (-c 代表并发的请求)</strong></p>
<p>测试如图：</p>
<p><img src="https://cdn.learnku.com/uploads/images/201911/05/27828/oFgDDnk32g.png!large" alt="Laravel-S 项目之初体验"></p>
<h4>五、结语</h4>
<h5>1、首先我们来看一下这两个数据的对比吧，如下图：</h5>
<p><img src="https://cdn.learnku.com/uploads/images/201911/05/27828/2h7PPSMAwp.png!large" alt="Laravel-S 项目之初体验"><br>
左边是 <code>Nginx</code> 的压测结果，右边是集成 <code>Laravel-S</code> 的laravel压测结果</p>
<h5>2、总结</h5>
<p>从图中我们可以看到，集成了 <code>laravel-S</code> 的 <code>Laravel</code> 框架确实快了很多很多，但是最近看到社区中使用 <code>laravel-S</code> 的用户，碰到了很多问题，但是集成了 <code>Swoole</code> 后速度确实上升了很多，希望 <code>laravel-S</code> 的作者继续去完善，同时大家想要把自己的项目加上 <code>laravel-S</code> 也要慎重考虑，文章到这里就结束了，我也没什么好说的，毕竟我也是个菜鸟，如果文章中有做得不对的地方和写的不对的地方欢迎大家指出！</p>
<h5>3、鸣谢</h5>
<ul>
<li>简单压力测试参考： Fjun <a href="https://learnku.com/articles/4765/simple-primary-stress-test">简单的初级压力测试</a>
</li>
<li>
<code>Laravel-S</code>作者：hhxsv5 <a href="https://github.com/hhxsv5/laravel-s">laravel-s</a>
</li>
</ul>
<div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/liangguifeng/tags/laravel_58">laravel</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/liangguifeng/tags/swoole_442">swoole</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/liangguifeng/tags/nginx_2469">nginx</a>
    </div>
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <p>犯二青年</p>
                                </span>
                            </div>',
    'created_at' => '2019-11-05 10:38:28',
    'updated_at' => '2019-11-05 10:38:28',
  ),
  40 => 
  array (
    'title' => 'nginx 之父被警方带走',
    'review' => ' 480',
    'comment' => ' 4',
    'content' => '<p>这也太吓人了吧。。</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/topics/tags/nginx/2469">nginx</a>
    </div>',
    'created_at' => '2019-12-13 14:08:46',
    'updated_at' => NULL,
  ),
  41 => 
  array (
    'title' => 'MaxWell 数据同步',
    'review' => ' 155',
    'comment' => ' 0',
    'content' => '<h1>使用MaxWell的原因</h1>
<p>由于最近的一个项目需要同步子系统中的数据到主系统上，并且需要在子系统传输上来的数据增加一些额外的信息，所以考虑到了可以使用一些组件来同步数据库中的数据。首先找的是阿里的Canal，但是在实际使用上有一些问题，例如经常性没收到数据变更。寻找了很久也没找到具体的原因（至今不知道为啥，可能我配置有问题），所以转向MaxWell。</p>
<h1>MaxWell介绍</h1>
<p><a href="https://github.com/zendesk/maxwell">MaxWell</a> 是一个能实时读取MySQL二进制日志binlog，并生成 JSON 格式的消息，作为生产者发送给 <code>Kafka</code>，<code>Kinesis</code>、<code>RabbitMQ</code>、<code>Redis</code>、<code>Google Cloud Pub/Sub</code>、文件或其它平台的应用程序。它的常见应用场景有ETL、维护缓存、收集表级别的dml指标、增量到搜索引擎、数据分区迁移、切库binlog回滚方案等。</p>
<h2>环境</h2>
<p>Maxwell 是使用java开发的，所以要先安装java。</p>
<h2>配置mysql</h2>
<p>修改mysql的配置文件<code>my.conf</code>，windows下是<code>my.ini</code>，打开bin-log和修改bin-log的格式</p>
<pre><code class=" language-php">log-bin=master
binlog_format=row</code></pre>
<h2>下载MaxWell</h2>
<p><a href="https://github.com/zendesk/maxwell/releases/download/v1.23.5/maxwell-1.23.5.tar.gz">MaxWell下载链接</a> </p>
<h2>配置MaxWell</h2>
<p>解压后复制一份maxwell的config</p>
<pre><code class=" language-php">cd maxwell

cp config.properites.example config.properites

修改配置文件
vim config.properites</code></pre>
<p>配置文件内容</p>
<pre><code class=" language-php"># tl;dr config
log_level=info

#生产者，我这里使用是的RabbitMQ
producer=rabbitmq

# 数据库信息配置
host=localhost
user=maxwell
password=maxwell

#用debug方便调试
log_level=DEBUG

#RabbitMQ的配置
rabbitmq_host=127.0.0.1
rabbitmq_port=5672
rabbitmq_user=admin
rabbitmq_pass=admin
rabbitmq_virtual_host=/
rabbitmq_exchange=maxwell
rabbitmq_exchange_type=direct
rabbitmq_exchange_durable=true
rabbitmq_exchange_autodelete=false
rabbitmq_routing_key_template=%db%.%table%
rabbitmq_message_persistent=false
rabbitmq_declare_exchange=true
</code></pre>
<h2>运行</h2>
<p>配置好这些之后打开maxwell，当然在此之前要先启动mysql和RabiitMQ</p>
<h3>Linux</h3>
<pre><code class=" language-php">cd ./bin

#config为使用的配置文件，daemon是使用守护进程
./maxwell --config=../config.properites --daemon

#使用的daemon后可在logs目录下看到数据的信息。
tail -f ../logs/MaxwellDaemon.out</code></pre>
<h3>Windows</h3>
<pre><code class=" language-php">java -Dfile.encoding=UTF-8 -Dlog4j.shutdownCallbackRegistry=com.djdch.log4j.StaticShutdownCallbackRegistry -cp ../lib/* com.zendesk.maxwell.Maxwell --config=../config.properties</code></pre>
<h1>数据同步</h1>
<p>MaxWell把数据扔到MQ上后，MQ会通过routing_key分配到相对应的队列上，然后用php去连接MQ去消费这些数据，然后完成数据库间的数据同步。</p>
<h1>结束</h1>
<p>实际运行效果还不错，也没有发生什么问题，总体来说还是挺不错的。</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/carlos/tags/maxwell_52297">maxwell</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/carlos/tags/php_28">php</a>
            <a class="ui label small yellow topic-tag" href="https://learnku.com/blog/carlos/tags/mysql_487">mysql</a>
    </div>',
    'created_at' => '2019-12-13 17:54:34',
    'updated_at' => '2019-12-13 17:54:34',
  ),
  42 => 
  array (
    'title' => '自研钉钉自动打卡神器！从此告别上下班忘打卡，上班迟到！',
    'review' => ' 5198',
    'comment' => ' 8',
    'content' => '<p>12.7 -- 1.0.2 版本更新-------------------</p>
<ol>
<li>优化自动打卡流程。<br>
2.解决部分手机自动登录报密码错误问题。<br>
3.解决部分手机无法进入打卡页面问题。</li>
</ol>
<p><strong>注意：<br>
1.针对没有自动打卡成功问题，建议使用安卓系统7.0以上手机测试。</strong><br><strong>    启动服务后，最好插上电源，尽量不要去操作该手机，否则可能会导致服务被系统回收，无法定时打卡。<br>
2.建议开启钉钉极速打卡。</strong><br><strong>3.同一个手机建议不要多个钉钉账号登录，否则会被钉钉后台开启微笑人脸打卡**</strong>。**</p>
<p>12.1 -- 1.0.1 版本更新-------------------</p>
<p>1.支持无限次打卡时间设置。<br>
2.支持设置时间范围内随机时间打卡。<br>
3.支持设置周六，周天是否允许打卡。<br>
4.适配多种机型自动进入打卡页面自动点击打卡按钮。</p>
<p><strong>注意：<br>
1.针对没有自动打卡成功问题，建议使用安卓系统7.0以上手机测试。</strong><br><strong>    启动服务后，最好插上电源，尽量不要去操作该手机，否则可能会导致服务被系统回收，无法定时打卡。<br>
2.建议开启钉钉极速打卡。</strong></p>
<p>1.0.0版本 -------------------</p>
<p>因为本程序员公司最近打卡要求越来越严！忘记打卡不准再补卡，自己负责！（万恶的资本主义！！！），本猿也是多年的Android开放经验， 一气之下！自己研究开发了钉钉自动打卡方案！<br>
经过我多个机型测试，已正常稳定打卡1个月。（从此上班不怕迟到，老子吃了早餐再上楼！ 下班不用再提心吊胆怕忘了打卡，一天白辛苦了！）<br>
为造福广大同时深受打卡烦恼的，奋战在生活底层的工人阶级同志们，特将该工具开放，希望大家支持！</p>
<p><strong>使用步骤：</strong></p>
<ol>
<li>预留一部安卓手机在公司。<br>
2.下载安装最新版的钉钉和本应用并登陆。<br>
3.设置上班时间，下班时间，钉钉登录账号，登录密码（用于自动登录钉钉，自动打卡）<br>
4.启动服务。</li>
</ol>
<p><strong>主要解决了以下几个难点：</strong><br>
1.实现自动登录钉钉。（让你可以在下班后随时在自己手机登录钉钉，不遗漏工作消息，留在公司的手机钉钉被踢下线后到打卡时间仍可以自动登录）<br>
2.实现自动息屏，无需长期亮屏。（防止被其他人发现）<br>
3.安卓7.0以上实现了完全模拟手势真实打卡过程，完全自动打卡；7.0以下开启极速打卡，也能自动打卡成功。</p>
<p><strong>注意：<br>
1.手机不要设置锁屏密码<br>
2.最好给手机连上充电器，防止没电。<br>
3.首次启动APP请按照提示同意权限，启动服务后登录新设备请输入手机验证码。<br>
4.打卡成功后，弹出的我的考勤常用手机不要绑定，否则手机自动打卡需要人脸识别。</strong></p>
<p><img src="https://attach.52pojie.cn//forum/201912/01/104423d2ka4zu79ngg2lqu.jpg?l" alt=""><img src="https://attach.52pojie.cn//forum/201911/16/203639iu6j0cjrlulkac51.jpg?l" alt=""></p>
<p><strong>下载链接: **</strong><a href="https://pan.baidu.com/s/1KrtbM5Q91WVFiM72JxxTPw" target="_blank">https://pan.baidu.com/s/1KrtbM5Q91WVFiM72J...</a> 提取码: mnq8**</p>

                        <div class="meta" style="margin: 35px 0px;">
    <i class="icon tags"></i>
    </div>',
    'created_at' => '2019-12-07 21:43:01',
    'updated_at' => '2019-12-07 21:43:01',
  ),
  43 => 
  array (
    'title' => '使用 Docker 创建 Lumen 项目',
    'review' => ' 772',
    'comment' => ' 0',
    'content' => '<p>lumen 6需要PHP &gt;= 7.2,我们仍然使用docker进行开发，我制作了一个基于PHP 7.3的镜像，直接拉来用就可以了</p>
<pre><code class="language-bash">docker run -d --name php-apache-dev \\
  --restart=always \\
  -v /home/wwwroot:/app \\
  -p 3000:80 \\
  donjan/php-apache-dev:7.3.10</code></pre>
<p>进入docker</p>
<pre><code class="language-bash">docker exec -it php-apache-dev bash</code></pre>
<p>创建项目</p>
<pre><code class="language-bash">composer create-project --prefer-dist laravel/lumen la-storage</code></pre>
<p>连接public的文件夹到apache</p>
<pre><code class="language-bash">rm -fr /var/www/html &amp;&amp; ln -s /app/la-storage/public /var/www/html</code></pre>
<p>至此我们访问宿主机的3000端口就可以看到安装成功了。</p>
<p><a href="http://192.168.137.200:3000" target="_blank">http://192.168.137.200:3000</a> 显示</p>
<p>Lumen (6.2.0) (Laravel Components ^6.0)</p>
<p>项目源码：<a href="https://github.com/donjan-deng/la-storage" target="_blank">https://github.com/donjan-deng/la-storage</a></p>
<h2><a href="https://learnku.com/articles/37460" target="_blank">博客：《PHP 微服务练兵》系列教程</a></h2>',
    'created_at' => '2019-12-03 11:20:33',
    'updated_at' => '2019-12-03 11:20:33',
  ),
  44 => 
  array (
    'title' => 'Laravel 教程系列书第三本《Laravel 教程实战高级 - 构架 API 服务器》',
    'review' => ' 53578',
    'comment' => ' 93',
    'content' => '<div class="text-center"><img src="https://cdn.learnku.com/uploads/images/201711/15/1/fJ5iqgmd7D.jpg" width="300" alt="fJ5iqgmd7D.jpg"></div>
<h2>系列课程</h2>
<p>本书是 Laravel 教程系列的第三本，前两本分别是：</p>
<ul>
<li>
<a href="https://learnku.com/laravel/t/3383">《Laravel 入门教程 - 从零到部署上线》</a> </li>
<li><a href="https://learnku.com/laravel/t/6592">《Laravel 进阶课程 - 从零开始构建论坛系统》</a></li>
</ul>
<p>本书主要专注于以下开发场景：</p>
<ul>
<li>VueJS 的后端服务器 API 接口开发（使用 JWT 授权）；</li>
<li>App 的后端 API 服务器开发。</li>
</ul>
<h2>涉及技术话题有哪些？</h2>
<p>在第二本进阶课程构建的项目 <a href="https://github.com/summerblue/larabbs">LaraBBS</a> 基础上，我们将一起开发以下功能：</p>
<ul>
<li>RESTFul 的概念及 Github Api 设计分解；</li>
<li>DingoApi 的介绍及安装；</li>
<li>PostMan 的介绍及使用；</li>
<li>用户认证 —— 手机注册、登录、退出；</li>
<li>第三方认证 —— 微信登录、JWT的使用；</li>
<li>用户信息 —— 获取个人信息、上传图片接口、修改个人信息；</li>
<li>话题接口 —— 发布、修改、删除、列表；</li>
<li>话题回复接口 —— 发布、修改、删除、列表；</li>
<li>权限控制 —— 权限列表，角色列表；</li>
<li>资源推荐接口、活跃用户接口；</li>
<li>接口本地化处理；</li>
<li>API 接口错误代码机制；</li>
<li>APNS 消息推送服务器端介绍及实现；</li>
<li>API 测试 —— 单元测试、集成测试、黑盒测试；</li>
<li>快速完成 API 文档；</li>
<li>Passport 认证；</li>
</ul>
<p>通过阅读本教程，你将学到如 RESTFul 设计风格、PostMan 的使用、OAuth 流程，JWT 概念及使用 和 API 开发相关的进阶知识。不仅如此，本书还会对这些基础知识点进行延伸扩展，为你讲解一些在 API 开发中更为专业、实用的技能，如使用微信测试公众号调试 OAuth 流程、图片验证码等。这些知识将为你未来的编程开发奠定下坚实的基础。使你不论是在做自己的个人项目，或是构建一个伟大的商业产品时，都能得心应手。</p>
<h2>目标用户</h2>
<p>本书是系列课程的第三本，如果你是新手，我们强烈建议你先学习过第一本书和第二本以后，再来学习此书。因为本系列课程的设计核心是一步步把你从 Laravel 新手培养为 Laravel 高级工程师，每一本都是一个不同的阶段，所以一些基础知识在前面书籍中讲解过，这此处我们将不会再次浪费篇幅进行讲解。</p>
<p>当然，如果你是有经验的开发者，你也可以选择跳过前面两本来单独阅读此书，对于本书范围内的知识点，我们会仔细讲解。</p>
<h2>关于作者</h2>
<p>本书是 <a href="https://learnku.com/users/1">@Summer</a> 与 <a href="https://learnku.com/users/3995">@liyu001989</a> 合著， <a href="https://learnku.com/users/3995">@liyu001989</a> 是优帆远扬的 API 架构师，高级工程师，有着大量 API 项目的构架经验。</p>
<h2>邀请好友</h2>
<p>另外，现开通邀请好友返利功能。需要更加优惠价格的同学，可以合理利用此功能，活动规则请阅读 <a href="https://learnku.com/courses/my/referrals">邀请好友活动详情页</a>。</p>
<blockquote>
<p>请注意，为了防止垃圾信息遍布各地，邀请好友的推广链接在本社区内无效。</p>
</blockquote>
<h2>购买本书</h2>
<p><a href="https://learnku.com/courses/laravel-advance-training/5.5">戳我购买</a></p>

                        
                                                    <div>
                                <a class="ui popover " data-content="作者署名，你可以在『个人资料』里设置" target="_blank" style="display: block;width: 30px;color: #ccc;margin: 22px 0 8px;"><i class="icon paw" aria-hidden="true"></i></a>
                                <span class="rm-link-color">
                                    <hr>
<p>Practice makes perfect.</p>
                                </span>
                            </div>',
    'created_at' => '2018-01-24 15:42:41',
    'updated_at' => '2018-03-03 16:25:24',
  ),
);